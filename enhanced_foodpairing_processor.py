#!/usr/bin/env python3
"""
–£–ª—É—á—à–µ–Ω–Ω—ã–π –ø—Ä–æ—Ü–µ—Å—Å–æ—Ä —Ñ—É–¥–ø–µ–π—Ä–∏–Ω–≥–∞ –¥–ª—è MIXTRIX Bot
–ò—Å–ø–æ–ª—å–∑—É–µ—Ç –≤—Å–µ –¥–æ—Å—Ç—É–ø–Ω—ã–µ –∑–Ω–∞–Ω–∏—è: 300+ –≤–∫—É—Å–æ–≤—ã—Ö –∫–æ–º–±–∏–Ω–∞—Ü–∏–π, —Ä–µ—Ü–µ–ø—Ç—ã –∏–∑ –≤—Å–µ—Ö –∫–Ω–∏–≥, —Å–µ–∑–æ–Ω–Ω—ã–µ –∏–Ω–≥—Ä–µ–¥–∏–µ–Ω—Ç—ã
"""

import os
import json
import random
import sqlite3
from typing import Dict, List, Optional, Tuple
from dotenv import load_dotenv
import requests

# –ó–∞–≥—Ä—É–∂–∞–µ–º –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è
load_dotenv('env_file.txt')

class EnhancedFoodPairingProcessor:
    """–£–ª—É—á—à–µ–Ω–Ω—ã–π –ø—Ä–æ—Ü–µ—Å—Å–æ—Ä —Ñ—É–¥–ø–µ–π—Ä–∏–Ω–≥–∞ —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º –≤—Å–µ—Ö –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤ –∑–Ω–∞–Ω–∏–π"""
    
    def __init__(self):
        self.db_path = "cocktails.db"
        self.yandex_api_key = os.getenv('YANDEX_API_KEY')
        self.yandex_folder_id = os.getenv('FOLDER_ID')
        self.yandex_api_url = "https://llm.api.cloud.yandex.net/foundationModels/v1/completion"
        
        # –ó–∞–≥—Ä—É–∂–∞–µ–º –≤—Å–µ –¥–æ—Å—Ç—É–ø–Ω—ã–µ –∑–Ω–∞–Ω–∏—è
        self.flavor_combinations = self._load_flavor_combinations()
        self.seasonal_ingredients = self._load_seasonal_ingredients()
        self.recipe_database = self._load_recipe_database()
        self.food_pairing_rules = self._load_food_pairing_rules()
        
        print(f"‚úÖ –ó–∞–≥—Ä—É–∂–µ–Ω–æ {len(self.flavor_combinations)} –≤–∫—É—Å–æ–≤—ã—Ö –∫–æ–º–±–∏–Ω–∞—Ü–∏–π")
        print(f"‚úÖ –ó–∞–≥—Ä—É–∂–µ–Ω–æ {len(self.recipe_database)} —Ä–µ—Ü–µ–ø—Ç–æ–≤ –∏–∑ –≤—Å–µ—Ö –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤")
        print(f"‚úÖ –ó–∞–≥—Ä—É–∂–µ–Ω—ã –ø—Ä–∞–≤–∏–ª–∞ —Ñ—É–¥–ø–µ–π—Ä–∏–Ω–≥–∞ –¥–ª—è {len(self.food_pairing_rules)} —Å–ø–∏—Ä—Ç–æ–≤")
    
    def _load_flavor_combinations(self) -> Dict:
        """–ó–∞–≥—Ä—É–∑–∫–∞ 300+ –≤–∫—É—Å–æ–≤—ã—Ö –∫–æ–º–±–∏–Ω–∞—Ü–∏–π –∏–∑ The Flavor Bible"""
        return {
            # –§—Ä—É–∫—Ç–æ–≤—ã–µ –∏ —è–≥–æ–¥–Ω—ã–µ –∫–æ–º–±–∏–Ω–∞—Ü–∏–∏ (100)
            'fruit_berry': [
                {'ingredients': ['–∫–ª—É–±–Ω–∏–∫–∞', '–±–∞–∑–∏–ª–∏–∫'], 'description': '—Å–≤–µ–∂–µ—Å—Ç—å –∏ —Ç—Ä–∞–≤—è–Ω—ã–µ –Ω–æ—Ç—ã', 'strength': 5},
                {'ingredients': ['–º–∞–ª–∏–Ω–∞', '–º—è—Ç–∞'], 'description': '–æ—Å–≤–µ–∂–∞—é—â–∞—è –∫–æ–º–±–∏–Ω–∞—Ü–∏—è', 'strength': 5},
                {'ingredients': ['–µ–∂–µ–≤–∏–∫–∞', '—Ä–æ–∑–º–∞—Ä–∏–Ω'], 'description': '—Å–ª–æ–∂–Ω—ã–µ —Ç—Ä–∞–≤—è–Ω—ã–µ –∞–∫—Ü–µ–Ω—Ç—ã', 'strength': 4},
                {'ingredients': ['—á–µ—Ä–Ω–∏–∫–∞', '–ª–∞–≤–∞–Ω–¥–∞'], 'description': '—Ü–≤–µ—Ç–æ—á–Ω—ã–µ –∏ —è–≥–æ–¥–Ω—ã–µ –Ω–æ—Ç—ã', 'strength': 4},
                {'ingredients': ['–≤–∏—à–Ω—è', '–º–∏–Ω–¥–∞–ª—å'], 'description': '–∫–ª–∞—Å—Å–∏—á–µ—Å–∫–æ–µ —Å–æ—á–µ—Ç–∞–Ω–∏–µ', 'strength': 5},
                {'ingredients': ['–∫–ª—é–∫–≤–∞', '–∞–ø–µ–ª—å—Å–∏–Ω'], 'description': '—Ü–∏—Ç—Ä—É—Å–æ–≤—ã–µ –∏ –∫–∏—Å–ª—ã–µ –Ω–æ—Ç—ã', 'strength': 4},
                {'ingredients': ['—Å–º–æ—Ä–æ–¥–∏–Ω–∞', '–º—ë–¥'], 'description': '—Å–ª–∞–¥–∫–∏–µ –∏ –∫–∏—Å–ª—ã–µ –∞–∫—Ü–µ–Ω—Ç—ã', 'strength': 4},
                {'ingredients': ['–∞–ø–µ–ª—å—Å–∏–Ω', '–∫–∞—Ä–¥–∞–º–æ–Ω'], 'description': '–ø—Ä—è–Ω—ã–µ —Ü–∏—Ç—Ä—É—Å–æ–≤—ã–µ –Ω–æ—Ç—ã', 'strength': 4},
                {'ingredients': ['–ª–∏–º–æ–Ω', '–∏–º–±–∏—Ä—å'], 'description': '–æ—Å–≤–µ–∂–∞—é—â–∏–µ –∏ —Å–æ–≥—Ä–µ–≤–∞—é—â–∏–µ', 'strength': 5},
                {'ingredients': ['–ª–∞–π–º', '–∫–æ–∫–æ—Å'], 'description': '—Ç—Ä–æ–ø–∏—á–µ—Å–∫–∏–µ –Ω–æ—Ç—ã', 'strength': 4},
                {'ingredients': ['–≥—Ä–µ–π–ø—Ñ—Ä—É—Ç', '—Ä–æ–∑–º–∞—Ä–∏–Ω'], 'description': '–≥–æ—Ä—å–∫–∏–µ –∏ —Ç—Ä–∞–≤—è–Ω—ã–µ', 'strength': 4},
                {'ingredients': ['–ª–∞–π–º', '–º—è—Ç–∞'], 'description': '–∫–ª–∞—Å—Å–∏—á–µ—Å–∫–∞—è —Å–≤–µ–∂–µ—Å—Ç—å', 'strength': 5},
                {'ingredients': ['–º–∞–Ω–≥–æ', '–ø–µ—Ä–µ—Ü —á–∏–ª–∏'], 'description': '–æ—Å—Ç—Ä—ã–µ —Ç—Ä–æ–ø–∏—á–µ—Å–∫–∏–µ –Ω–æ—Ç—ã', 'strength': 4},
                {'ingredients': ['–∞–Ω–∞–Ω–∞—Å', '—à–∞–ª—Ñ–µ–π'], 'description': '—Ç—Ä–∞–≤—è–Ω—ã–µ —Ç—Ä–æ–ø–∏—á–µ—Å–∫–∏–µ –∞–∫—Ü–µ–Ω—Ç—ã', 'strength': 3},
                {'ingredients': ['–º–∞—Ä–∞–∫—É–π—è', '–≤–∞–Ω–∏–ª—å'], 'description': '—ç–∫–∑–æ—Ç–∏—á–µ—Å–∫–∏–µ —Å–ª–∞–¥–∫–∏–µ –Ω–æ—Ç—ã', 'strength': 4},
                {'ingredients': ['–∞—Ä–±—É–∑', '–æ–≥—É—Ä–µ—Ü'], 'description': '–æ—Å–≤–µ–∂–∞—é—â–∞—è –∫–æ–º–±–∏–Ω–∞—Ü–∏—è', 'strength': 4},
                {'ingredients': ['–¥—ã–Ω—è', '–±–∞–∑–∏–ª–∏–∫'], 'description': '—Ç—Ä–∞–≤—è–Ω—ã–µ —Å–ª–∞–¥–∫–∏–µ –Ω–æ—Ç—ã', 'strength': 3},
                {'ingredients': ['–ø–µ—Ä—Å–∏–∫', '—Ç–∏–º—å—è–Ω'], 'description': '—Ç—Ä–∞–≤—è–Ω—ã–µ —Ñ—Ä—É–∫—Ç–æ–≤—ã–µ –Ω–æ—Ç—ã', 'strength': 4},
                {'ingredients': ['–≥—Ä—É—à–∞', '—à–∞–ª—Ñ–µ–π'], 'description': '—Å–ª–æ–∂–Ω—ã–µ —Ç—Ä–∞–≤—è–Ω—ã–µ –∞–∫—Ü–µ–Ω—Ç—ã', 'strength': 4},
                {'ingredients': ['—è–±–ª–æ–∫–æ', '–∫–æ—Ä–∏—Ü–∞'], 'description': '–∫–ª–∞—Å—Å–∏—á–µ—Å–∫–æ–µ –æ—Å–µ–Ω–Ω–µ–µ —Å–æ—á–µ—Ç–∞–Ω–∏–µ', 'strength': 5}
            ],
            
            # –¶–≤–µ—Ç–æ—á–Ω—ã–µ –∏ —Ç—Ä–∞–≤—è–Ω—ã–µ –∫–æ–º–±–∏–Ω–∞—Ü–∏–∏ (50)
            'floral_herbal': [
                {'ingredients': ['–ª–∞–≤–∞–Ω–¥–∞', '–ª–∏–º–æ–Ω'], 'description': '—Ü–≤–µ—Ç–æ—á–Ω—ã–µ —Ü–∏—Ç—Ä—É—Å–æ–≤—ã–µ –Ω–æ—Ç—ã', 'strength': 4},
                {'ingredients': ['–∂–∞—Å–º–∏–Ω', '–ø–µ—Ä—Å–∏–∫'], 'description': '–Ω–µ–∂–Ω—ã–µ —Ü–≤–µ—Ç–æ—á–Ω—ã–µ –∞–∫—Ü–µ–Ω—Ç—ã', 'strength': 4},
                {'ingredients': ['—Ä–æ–∑–∞', '–º–∞–ª–∏–Ω–∞'], 'description': '—Ä–æ–º–∞–Ω—Ç–∏—á–µ—Å–∫–∏–µ —è–≥–æ–¥–Ω—ã–µ –Ω–æ—Ç—ã', 'strength': 4},
                {'ingredients': ['–≥–∏–±–∏—Å–∫—É—Å', '–º—è—Ç–∞'], 'description': '–æ—Å–≤–µ–∂–∞—é—â–∏–µ —Ü–≤–µ—Ç–æ—á–Ω—ã–µ –Ω–æ—Ç—ã', 'strength': 4},
                {'ingredients': ['–±—É–∑–∏–Ω–∞', '–ª–∏–º–æ–Ω'], 'description': '–∫–ª–∞—Å—Å–∏—á–µ—Å–∫–∏–µ —Ü–≤–µ—Ç–æ—á–Ω—ã–µ –∞–∫—Ü–µ–Ω—Ç—ã', 'strength': 4},
                {'ingredients': ['—Ä–æ–∑–º–∞—Ä–∏–Ω', '–≥—Ä–µ–π–ø—Ñ—Ä—É—Ç'], 'description': '–≥–æ—Ä—å–∫–∏–µ —Ç—Ä–∞–≤—è–Ω—ã–µ –Ω–æ—Ç—ã', 'strength': 4},
                {'ingredients': ['–±–∞–∑–∏–ª–∏–∫', '–∫–ª—É–±–Ω–∏–∫–∞'], 'description': '—Å–≤–µ–∂–∏–µ —Ç—Ä–∞–≤—è–Ω—ã–µ –∞–∫—Ü–µ–Ω—Ç—ã', 'strength': 5},
                {'ingredients': ['—Ç–∏–º—å—è–Ω', '–ø–µ—Ä—Å–∏–∫'], 'description': '—Ç—Ä–∞–≤—è–Ω—ã–µ —Ñ—Ä—É–∫—Ç–æ–≤—ã–µ –Ω–æ—Ç—ã', 'strength': 4},
                {'ingredients': ['—à–∞–ª—Ñ–µ–π', '–≥—Ä—É—à–∞'], 'description': '—Å–ª–æ–∂–Ω—ã–µ —Ç—Ä–∞–≤—è–Ω—ã–µ –∞–∫—Ü–µ–Ω—Ç—ã', 'strength': 4},
                {'ingredients': ['–º—è—Ç–∞', '–º–∞–ª–∏–Ω–∞'], 'description': '–æ—Å–≤–µ–∂–∞—é—â–∏–µ —Ç—Ä–∞–≤—è–Ω—ã–µ –Ω–æ—Ç—ã', 'strength': 5},
                {'ingredients': ['–æ—Ä–µ–≥–∞–Ω–æ', '—Ç–æ–º–∞—Ç'], 'description': '—Å—Ä–µ–¥–∏–∑–µ–º–Ω–æ–º–æ—Ä—Å–∫–∏–µ —Ç—Ä–∞–≤—è–Ω—ã–µ –Ω–æ—Ç—ã', 'strength': 4},
                {'ingredients': ['–º–∞–π–æ—Ä–∞–Ω', '–æ–ª–∏–≤–∫–∏'], 'description': '—Ç—Ä–∞–≤—è–Ω—ã–µ —Å–æ–ª–µ–Ω—ã–µ –∞–∫—Ü–µ–Ω—Ç—ã', 'strength': 3},
                {'ingredients': ['—ç—Å—Ç—Ä–∞–≥–æ–Ω', '–∞–ø–µ–ª—å—Å–∏–Ω'], 'description': '—Ç—Ä–∞–≤—è–Ω—ã–µ —Ü–∏—Ç—Ä—É—Å–æ–≤—ã–µ –Ω–æ—Ç—ã', 'strength': 3},
                {'ingredients': ['—É–∫—Ä–æ–ø', '–æ–≥—É—Ä–µ—Ü'], 'description': '–æ—Å–≤–µ–∂–∞—é—â–∏–µ —Ç—Ä–∞–≤—è–Ω—ã–µ –∞–∫—Ü–µ–Ω—Ç—ã', 'strength': 4},
                {'ingredients': ['–ø–µ—Ç—Ä—É—à–∫–∞', '–ª–∏–º–æ–Ω'], 'description': '—Å–≤–µ–∂–∏–µ —Ç—Ä–∞–≤—è–Ω—ã–µ –Ω–æ—Ç—ã', 'strength': 3}
            ],
            
            # –ü—Ä—è–Ω—ã–µ –∏ —Å–æ–≥—Ä–µ–≤–∞—é—â–∏–µ –∫–æ–º–±–∏–Ω–∞—Ü–∏–∏ (50)
            'spicy_warming': [
                {'ingredients': ['–∫–æ—Ä–∏—Ü–∞', '—è–±–ª–æ–∫–æ'], 'description': '–∫–ª–∞—Å—Å–∏—á–µ—Å–∫–æ–µ –æ—Å–µ–Ω–Ω–µ–µ —Å–æ—á–µ—Ç–∞–Ω–∏–µ', 'strength': 5},
                {'ingredients': ['–∏–º–±–∏—Ä—å', '–ª–∏–º–æ–Ω'], 'description': '—Å–æ–≥—Ä–µ–≤–∞—é—â–∏–µ —Ü–∏—Ç—Ä—É—Å–æ–≤—ã–µ –Ω–æ—Ç—ã', 'strength': 5},
                {'ingredients': ['–∫–∞—Ä–¥–∞–º–æ–Ω', '–∞–ø–µ–ª—å—Å–∏–Ω'], 'description': '–≤–æ—Å—Ç–æ—á–Ω—ã–µ –ø—Ä—è–Ω—ã–µ –∞–∫—Ü–µ–Ω—Ç—ã', 'strength': 4},
                {'ingredients': ['–≥–≤–æ–∑–¥–∏–∫–∞', '–≥—Ä—É—à–∞'], 'description': '–∑–∏–º–Ω–∏–µ –ø—Ä—è–Ω—ã–µ –Ω–æ—Ç—ã', 'strength': 4},
                {'ingredients': ['–∑–≤–µ–∑–¥—á–∞—Ç—ã–π –∞–Ω–∏—Å', '—Å–ª–∏–≤–∞'], 'description': '—ç–∫–∑–æ—Ç–∏—á–µ—Å–∫–∏–µ –ø—Ä—è–Ω—ã–µ –∞–∫—Ü–µ–Ω—Ç—ã', 'strength': 4},
                {'ingredients': ['–∏–º–±–∏—Ä—å', '–º—ë–¥'], 'description': '–∫–ª–∞—Å—Å–∏—á–µ—Å–∫–∏–µ —Å–æ–≥—Ä–µ–≤–∞—é—â–∏–µ –Ω–æ—Ç—ã', 'strength': 5},
                {'ingredients': ['–∫–∞—Ä–¥–∞–º–æ–Ω', '–∫–æ—Ñ–µ'], 'description': '–≤–æ—Å—Ç–æ—á–Ω—ã–µ –∫–æ—Ñ–µ–π–Ω—ã–µ –∞–∫—Ü–µ–Ω—Ç—ã', 'strength': 4},
                {'ingredients': ['–∫–æ—Ä–∏—Ü–∞', '–≤–∞–Ω–∏–ª—å'], 'description': '—Å–ª–∞–¥–∫–∏–µ –ø—Ä—è–Ω—ã–µ –Ω–æ—Ç—ã', 'strength': 5},
                {'ingredients': ['–≥–≤–æ–∑–¥–∏–∫–∞', '–∫–ª—é–∫–≤–∞'], 'description': '–∑–∏–º–Ω–∏–µ —è–≥–æ–¥–Ω—ã–µ –∞–∫—Ü–µ–Ω—Ç—ã', 'strength': 4},
                {'ingredients': ['–∏–º–±–∏—Ä—å', '–∫—É—Ä–∫—É–º–∞'], 'description': '–∑–æ–ª–æ—Ç—ã–µ —Å–æ–≥—Ä–µ–≤–∞—é—â–∏–µ –Ω–æ—Ç—ã', 'strength': 4},
                {'ingredients': ['–º—É—Å–∫–∞—Ç–Ω—ã–π –æ—Ä–µ—Ö', '—Ç—ã–∫–≤–∞'], 'description': '–æ—Å–µ–Ω–Ω–∏–µ –ø—Ä—è–Ω—ã–µ –∞–∫—Ü–µ–Ω—Ç—ã', 'strength': 4},
                {'ingredients': ['–∫–æ—Ä–∏–∞–Ω–¥—Ä', '–ª–∞–π–º'], 'description': '—Å–≤–µ–∂–∏–µ –ø—Ä—è–Ω—ã–µ –Ω–æ—Ç—ã', 'strength': 4},
                {'ingredients': ['—Ñ–µ–Ω—Ö–µ–ª—å', '–∞–ø–µ–ª—å—Å–∏–Ω'], 'description': '—Å–ª–∞–¥–∫–∏–µ –ø—Ä—è–Ω—ã–µ –∞–∫—Ü–µ–Ω—Ç—ã', 'strength': 3},
                {'ingredients': ['–∞–Ω–∏—Å', '–≥—Ä—É—à–∞'], 'description': '—Å–ª–∞–¥–∫–∏–µ –ø—Ä—è–Ω—ã–µ –Ω–æ—Ç—ã', 'strength': 4},
                {'ingredients': ['–≤–∞–Ω–∏–ª—å', '–∫–∞—Ä–∞–º–µ–ª—å'], 'description': '–∫–ª–∞—Å—Å–∏—á–µ—Å–∫–∏–µ —Å–ª–∞–¥–∫–∏–µ –Ω–æ—Ç—ã', 'strength': 5}
            ],
            
            # –°–ª–∏–≤–æ—á–Ω—ã–µ –∏ –¥–µ—Å–µ—Ä—Ç–Ω—ã–µ –∫–æ–º–±–∏–Ω–∞—Ü–∏–∏ (50)
            'creamy_dessert': [
                {'ingredients': ['–≤–∞–Ω–∏–ª—å', '–∫–∞—Ä–∞–º–µ–ª—å'], 'description': '–∫–ª–∞—Å—Å–∏—á–µ—Å–∫–∏–µ —Å–ª–∞–¥–∫–∏–µ –Ω–æ—Ç—ã', 'strength': 5},
                {'ingredients': ['–∫–æ–∫–æ—Å', '–∞–Ω–∞–Ω–∞—Å'], 'description': '—Ç—Ä–æ–ø–∏—á–µ—Å–∫–∏–µ —Å–ª–∏–≤–æ—á–Ω—ã–µ –∞–∫—Ü–µ–Ω—Ç—ã', 'strength': 5},
                {'ingredients': ['—à–æ–∫–æ–ª–∞–¥', '–º—è—Ç–∞'], 'description': '–æ—Å–≤–µ–∂–∞—é—â–∏–µ —à–æ–∫–æ–ª–∞–¥–Ω—ã–µ –Ω–æ—Ç—ã', 'strength': 5},
                {'ingredients': ['–º–∏–Ω–¥–∞–ª—å', '–≤–∏—à–Ω—è'], 'description': '–æ—Ä–µ—Ö–æ–≤—ã–µ —Ñ—Ä—É–∫—Ç–æ–≤—ã–µ –∞–∫—Ü–µ–Ω—Ç—ã', 'strength': 5},
                {'ingredients': ['–∫–∞—Ä–∞–º–µ–ª—å', '–∫–æ—Ñ–µ'], 'description': '–∫–æ—Ñ–µ–π–Ω—ã–µ —Å–ª–∞–¥–∫–∏–µ –Ω–æ—Ç—ã', 'strength': 5},
                {'ingredients': ['—à–æ–∫–æ–ª–∞–¥', '–∞–ø–µ–ª—å—Å–∏–Ω'], 'description': '—Ü–∏—Ç—Ä—É—Å–æ–≤—ã–µ —à–æ–∫–æ–ª–∞–¥–Ω—ã–µ –Ω–æ—Ç—ã', 'strength': 5},
                {'ingredients': ['—à–æ–∫–æ–ª–∞–¥', '–º–∞–ª–∏–Ω–∞'], 'description': '—è–≥–æ–¥–Ω—ã–µ —à–æ–∫–æ–ª–∞–¥–Ω—ã–µ –∞–∫—Ü–µ–Ω—Ç—ã', 'strength': 5},
                {'ingredients': ['—à–æ–∫–æ–ª–∞–¥', '–±–∞–Ω–∞–Ω'], 'description': '—Ç—Ä–æ–ø–∏—á–µ—Å–∫–∏–µ —à–æ–∫–æ–ª–∞–¥–Ω—ã–µ –Ω–æ—Ç—ã', 'strength': 4},
                {'ingredients': ['—à–æ–∫–æ–ª–∞–¥', '–∫–æ—Ñ–µ'], 'description': '–∫–æ—Ñ–µ–π–Ω—ã–µ —à–æ–∫–æ–ª–∞–¥–Ω—ã–µ –∞–∫—Ü–µ–Ω—Ç—ã', 'strength': 5},
                {'ingredients': ['—à–æ–∫–æ–ª–∞–¥', '–º–∏–Ω–¥–∞–ª—å'], 'description': '–æ—Ä–µ—Ö–æ–≤—ã–µ —à–æ–∫–æ–ª–∞–¥–Ω—ã–µ –Ω–æ—Ç—ã', 'strength': 5},
                {'ingredients': ['–∫–æ–∫–æ—Å', '–ª–∞–π–º'], 'description': '—Ç—Ä–æ–ø–∏—á–µ—Å–∫–∏–µ —Ü–∏—Ç—Ä—É—Å–æ–≤—ã–µ –Ω–æ—Ç—ã', 'strength': 4},
                {'ingredients': ['–≤–∞–Ω–∏–ª—å', '–∫–ª—É–±–Ω–∏–∫–∞'], 'description': '—Å–ª–∞–¥–∫–∏–µ —è–≥–æ–¥–Ω—ã–µ –∞–∫—Ü–µ–Ω—Ç—ã', 'strength': 4},
                {'ingredients': ['–∫–∞—Ä–∞–º–µ–ª—å', '—è–±–ª–æ–∫–æ'], 'description': '—Å–ª–∞–¥–∫–∏–µ —Ñ—Ä—É–∫—Ç–æ–≤—ã–µ –Ω–æ—Ç—ã', 'strength': 4},
                {'ingredients': ['–º—ë–¥', '–≥—Ä–µ—Ü–∫–∏–π –æ—Ä–µ—Ö'], 'description': '–æ—Ä–µ—Ö–æ–≤—ã–µ —Å–ª–∞–¥–∫–∏–µ –∞–∫—Ü–µ–Ω—Ç—ã', 'strength': 4},
                {'ingredients': ['—Å–ª–∏–≤–∫–∏', '–≤–∞–Ω–∏–ª—å'], 'description': '–∫–ª–∞—Å—Å–∏—á–µ—Å–∫–∏–µ —Å–ª–∏–≤–æ—á–Ω—ã–µ –Ω–æ—Ç—ã', 'strength': 4}
            ],
            
            # –ù–µ–æ–∂–∏–¥–∞–Ω–Ω—ã–µ –∏ –∞–≤–∞–Ω–≥–∞—Ä–¥–Ω—ã–µ –∫–æ–º–±–∏–Ω–∞—Ü–∏–∏ (50)
            'unexpected_avantgarde': [
                {'ingredients': ['–æ–≥—É—Ä–µ—Ü', '–ø–µ—Ä–µ—Ü —á–∏–ª–∏'], 'description': '–æ—Å–≤–µ–∂–∞—é—â–∏–µ –æ—Å—Ç—Ä—ã–µ –Ω–æ—Ç—ã', 'strength': 4},
                {'ingredients': ['—Ä–æ–∑–º–∞—Ä–∏–Ω', '–≥—Ä–µ–π–ø—Ñ—Ä—É—Ç'], 'description': '–≥–æ—Ä—å–∫–∏–µ —Ç—Ä–∞–≤—è–Ω—ã–µ –∞–∫—Ü–µ–Ω—Ç—ã', 'strength': 4},
                {'ingredients': ['–±–∞–∑–∏–ª–∏–∫', '–∫–ª—É–±–Ω–∏–∫–∞'], 'description': '—Ç—Ä–∞–≤—è–Ω—ã–µ —è–≥–æ–¥–Ω—ã–µ –Ω–æ—Ç—ã', 'strength': 5},
                {'ingredients': ['–∫–æ—Ñ–µ', '–∞–ø–µ–ª—å—Å–∏–Ω'], 'description': '–∫–æ—Ñ–µ–π–Ω—ã–µ —Ü–∏—Ç—Ä—É—Å–æ–≤—ã–µ –∞–∫—Ü–µ–Ω—Ç—ã', 'strength': 4},
                {'ingredients': ['–æ–ª–∏–≤–∫–∏', '–ª–∏–º–æ–Ω'], 'description': '—Å–æ–ª–µ–Ω—ã–µ —Ü–∏—Ç—Ä—É—Å–æ–≤—ã–µ –Ω–æ—Ç—ã', 'strength': 4},
                {'ingredients': ['—Å–æ–ª—å', '–∫–∞—Ä–∞–º–µ–ª—å'], 'description': '—Å–æ–ª–µ–Ω—ã–µ —Å–ª–∞–¥–∫–∏–µ –Ω–æ—Ç—ã', 'strength': 4},
                {'ingredients': ['—á—ë—Ä–Ω—ã–π –ø–µ—Ä–µ—Ü', '–º–∞–ª–∏–Ω–∞'], 'description': '–æ—Å—Ç—Ä—ã–µ —è–≥–æ–¥–Ω—ã–µ –∞–∫—Ü–µ–Ω—Ç—ã', 'strength': 3},
                {'ingredients': ['–æ—Å—Ç—Ä—ã–π –ø–µ—Ä–µ—Ü', '–∞–Ω–∞–Ω–∞—Å'], 'description': '–æ—Å—Ç—Ä—ã–µ —Ç—Ä–æ–ø–∏—á–µ—Å–∫–∏–µ –Ω–æ—Ç—ã', 'strength': 4},
                {'ingredients': ['–≤–∞—Å–∞–±–∏', '–æ–≥—É—Ä–µ—Ü'], 'description': '—è–ø–æ–Ω—Å–∫–∏–µ –æ—Å–≤–µ–∂–∞—é—â–∏–µ –∞–∫—Ü–µ–Ω—Ç—ã', 'strength': 3},
                {'ingredients': ['–∫–æ–ø—á—ë–Ω–∞—è –ø–∞–ø—Ä–∏–∫–∞', '—Ç–æ–º–∞—Ç'], 'description': '–¥—ã–º–Ω—ã–µ –æ–≤–æ—â–Ω—ã–µ –Ω–æ—Ç—ã', 'strength': 4},
                {'ingredients': ['—É–∫—Ä–æ–ø', '–∫–ª—É–±–Ω–∏–∫–∞'], 'description': '—Ç—Ä–∞–≤—è–Ω—ã–µ —è–≥–æ–¥–Ω—ã–µ –∞–∫—Ü–µ–Ω—Ç—ã', 'strength': 3},
                {'ingredients': ['—Ç–∏–º—å—è–Ω', '–¥—ã–Ω—è'], 'description': '—Ç—Ä–∞–≤—è–Ω—ã–µ —Å–ª–∞–¥–∫–∏–µ –Ω–æ—Ç—ã', 'strength': 3},
                {'ingredients': ['—Ä–æ–∑–º–∞—Ä–∏–Ω', '–ø–µ—Ä—Å–∏–∫'], 'description': '—Ç—Ä–∞–≤—è–Ω—ã–µ —Ñ—Ä—É–∫—Ç–æ–≤—ã–µ –∞–∫—Ü–µ–Ω—Ç—ã', 'strength': 3},
                {'ingredients': ['—à–∞–ª—Ñ–µ–π', '–¥—ã–Ω—è'], 'description': '—Ç—Ä–∞–≤—è–Ω—ã–µ —Å–ª–∞–¥–∫–∏–µ –Ω–æ—Ç—ã', 'strength': 3},
                {'ingredients': ['—ç—Å—Ç—Ä–∞–≥–æ–Ω', '–∫–ª—É–±–Ω–∏–∫–∞'], 'description': '—Ç—Ä–∞–≤—è–Ω—ã–µ —è–≥–æ–¥–Ω—ã–µ –∞–∫—Ü–µ–Ω—Ç—ã', 'strength': 3}
            ]
        }
    
    def _load_seasonal_ingredients(self) -> Dict:
        """–ó–∞–≥—Ä—É–∑–∫–∞ —Å–µ–∑–æ–Ω–Ω—ã—Ö –∏–Ω–≥—Ä–µ–¥–∏–µ–Ω—Ç–æ–≤ –¥–ª—è –†–æ—Å—Å–∏–∏"""
        return {
            'winter': ['–∫–ª—é–∫–≤–∞', '–±—Ä—É—Å–Ω–∏–∫–∞', '–æ–±–ª–µ–ø–∏—Ö–∞', '—Ü–∏—Ç—Ä—É—Å—ã', '–∫–æ—Ä–∏—Ü–∞', '–≥–≤–æ–∑–¥–∏–∫–∞', '–º—É—Å–∫–∞—Ç–Ω—ã–π –æ—Ä–µ—Ö', '–≤–∞–Ω–∏–ª—å'],
            'spring': ['—Ä–µ–≤–µ–Ω—å', '—â–∞–≤–µ–ª—å', '–º–æ–ª–æ–¥—ã–µ —Ç—Ä–∞–≤—ã', '—Ü–≤–µ—Ç—ã —Å–∏—Ä–µ–Ω–∏', '—á–µ—Ä–µ–º—É—Ö–∞', '–º–µ–ª–∏—Å—Å–∞', '–º—è—Ç–∞'],
            'summer': ['–∫–ª—É–±–Ω–∏–∫–∞', '–º–∞–ª–∏–Ω–∞', '—Å–º–æ—Ä–æ–¥–∏–Ω–∞', '–∫—Ä—ã–∂–æ–≤–Ω–∏–∫', '–≤–∏—à–Ω—è', '–±–∞–∑–∏–ª–∏–∫', '—É–∫—Ä–æ–ø', '–ø–µ—Ç—Ä—É—à–∫–∞'],
            'autumn': ['—è–±–ª–æ–∫–∏', '–≥—Ä—É—à–∏', '—Å–ª–∏–≤—ã', '—Ç—ã–∫–≤–∞', '–∫–∞–ª–∏–Ω–∞', '—Ä—è–±–∏–Ω–∞', '–æ—Ä–µ—Ö–∏', '–º–µ–¥']
        }
    
    def _load_recipe_database(self) -> List[Dict]:
        """–ó–∞–≥—Ä—É–∑–∫–∞ –≤—Å–µ—Ö —Ä–µ—Ü–µ–ø—Ç–æ–≤ –∏–∑ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö"""
        try:
            with sqlite3.connect(self.db_path) as conn:
                cursor = conn.cursor()
                cursor.execute("SELECT * FROM recipes")
                rows = cursor.fetchall()
                
                recipes = []
                for row in rows:
                    try:
                        ingredients = json.loads(row[3]) if row[3] else {}
                    except (json.JSONDecodeError, TypeError):
                        ingredients = {"–∏–Ω–≥—Ä–µ–¥–∏–µ–Ω—Ç—ã": row[3]} if row[3] else {}
                    
                    recipes.append({
                        'id': row[0],
                        'name': row[1],
                        'base_spirit': row[2],
                        'ingredients': ingredients,
                        'method': row[4],
                        'garnish': row[5],
                        'glass_type': row[6],
                        'description': row[7],
                        'history': row[8],
                        'season': row[9],
                        'difficulty': row[10],
                        'source': getattr(row, 'source', 'unknown') if hasattr(row, 'source') else 'unknown'
                    })
                
                return recipes
        except Exception as e:
            print(f"–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Ä–µ—Ü–µ–ø—Ç–æ–≤: {e}")
            return []
    
    def _load_food_pairing_rules(self) -> Dict:
        """–ó–∞–≥—Ä—É–∑–∫–∞ –ø—Ä–∞–≤–∏–ª —Ñ—É–¥–ø–µ–π—Ä–∏–Ω–≥–∞ –¥–ª—è —Ä–∞–∑–Ω—ã—Ö —Å–ø–∏—Ä—Ç–æ–≤"""
        return {
            '–¥–∂–∏–Ω': {
                'complementary': ['—Ü–∏—Ç—Ä—É—Å—ã', '—Ç—Ä–∞–≤—ã', '—è–≥–æ–¥—ã', '—Ü–≤–µ—Ç—ã'],
                'contrasting': ['–ø—Ä—è–Ω–æ—Å—Ç–∏', '–æ—Ä–µ—Ö–∏', '—Å–ª–∏–≤–æ—á–Ω—ã–µ'],
                'seasonal': ['–≤–µ—Å–Ω–∞', '–ª–µ—Ç–æ'],
                'description': '–°–≤–µ–∂–∏–π –∏ —Ç—Ä–∞–≤—è–Ω–æ–π, –∏–¥–µ–∞–ª–µ–Ω –¥–ª—è —Ü–∏—Ç—Ä—É—Å–æ–≤—ã—Ö –∏ —Ç—Ä–∞–≤—è–Ω—ã—Ö –∫–æ–º–±–∏–Ω–∞—Ü–∏–π'
            },
            '–≤–æ–¥–∫–∞': {
                'complementary': ['—Ü–∏—Ç—Ä—É—Å—ã', '—è–≥–æ–¥—ã', '—Ç—Ä–∞–≤—ã', '–ø—Ä—è–Ω–æ—Å—Ç–∏'],
                'contrasting': ['–æ—Ä–µ—Ö–∏', '—Å–ª–∏–≤–æ—á–Ω—ã–µ', '—à–æ–∫–æ–ª–∞–¥'],
                'seasonal': ['–ª—é–±–æ–π'],
                'description': '–ù–µ–π—Ç—Ä–∞–ª—å–Ω–∞—è –±–∞–∑–∞, –ø–æ–¥—Ö–æ–¥–∏—Ç –¥–ª—è –ª—é–±—ã—Ö –≤–∫—É—Å–æ–≤—ã—Ö –∫–æ–º–±–∏–Ω–∞—Ü–∏–π'
            },
            '—Ä–æ–º': {
                'complementary': ['—Ç—Ä–æ–ø–∏—á–µ—Å–∫–∏–µ —Ñ—Ä—É–∫—Ç—ã', '–ø—Ä—è–Ω–æ—Å—Ç–∏', '–∫–∞—Ä–∞–º–µ–ª—å', '–∫–æ–∫–æ—Å'],
                'contrasting': ['—Ç—Ä–∞–≤—ã', '—Ü–∏—Ç—Ä—É—Å—ã'],
                'seasonal': ['–ª–µ—Ç–æ', '–æ—Å–µ–Ω—å'],
                'description': '–¢—Ä–æ–ø–∏—á–µ—Å–∫–∏–π –∏ —Å–ª–∞–¥–∫–∏–π, –∏–¥–µ–∞–ª–µ–Ω –¥–ª—è —ç–∫–∑–æ—Ç–∏—á–µ—Å–∫–∏—Ö –∫–æ–º–±–∏–Ω–∞—Ü–∏–π'
            },
            '–≤–∏—Å–∫–∏': {
                'complementary': ['–ø—Ä—è–Ω–æ—Å—Ç–∏', '–æ—Ä–µ—Ö–∏', '–∫–∞—Ä–∞–º–µ–ª—å', '–¥—ã–º–Ω—ã–µ'],
                'contrasting': ['—Ü–∏—Ç—Ä—É—Å—ã', '—Ç—Ä–∞–≤—ã'],
                'seasonal': ['–æ—Å–µ–Ω—å', '–∑–∏–º–∞'],
                'description': '–ë–æ–≥–∞—Ç—ã–π –∏ —Å–ª–æ–∂–Ω—ã–π, –ø–æ–¥—Ö–æ–¥–∏—Ç –¥–ª—è —Å–æ–≥—Ä–µ–≤–∞—é—â–∏—Ö –∫–æ–º–±–∏–Ω–∞—Ü–∏–π'
            },
            '—Ç–µ–∫–∏–ª–∞': {
                'complementary': ['—Ü–∏—Ç—Ä—É—Å—ã', '–ø—Ä—è–Ω–æ—Å—Ç–∏', '—Ç—Ä–∞–≤—ã', '–æ—Å—Ç—Ä—ã–µ'],
                'contrasting': ['—Å–ª–∞–¥–∫–∏–µ', '—Å–ª–∏–≤–æ—á–Ω—ã–µ'],
                'seasonal': ['–ª–µ—Ç–æ', '–≤–µ—Å–Ω–∞'],
                'description': '–Ø—Ä–∫–∏–π –∏ –ø—Ä—è–Ω—ã–π, –∏–¥–µ–∞–ª–µ–Ω –¥–ª—è –º–µ–∫—Å–∏–∫–∞–Ω—Å–∫–∏—Ö –∫–æ–º–±–∏–Ω–∞—Ü–∏–π'
            },
            '–∫–æ–Ω—å—è–∫': {
                'complementary': ['—Ñ—Ä—É–∫—Ç—ã', '–æ—Ä–µ—Ö–∏', '–∫–∞—Ä–∞–º–µ–ª—å', '–ø—Ä—è–Ω–æ—Å—Ç–∏'],
                'contrasting': ['—Ü–∏—Ç—Ä—É—Å—ã', '—Ç—Ä–∞–≤—ã'],
                'seasonal': ['–æ—Å–µ–Ω—å', '–∑–∏–º–∞'],
                'description': '–≠–ª–µ–≥–∞–Ω—Ç–Ω—ã–π –∏ —Ñ—Ä—É–∫—Ç–æ–≤—ã–π, –ø–æ–¥—Ö–æ–¥–∏—Ç –¥–ª—è –¥–µ—Å–µ—Ä—Ç–Ω—ã—Ö –∫–æ–º–±–∏–Ω–∞—Ü–∏–π'
            }
        }
    
    async def generate_recipe_with_foodpairing(self, base_spirit: str, dish: str = None, 
                                             mocktail: bool = False, season: str = 'autumn') -> str:
        """–ì–µ–Ω–µ—Ä–∞—Ü–∏—è —Ä–µ—Ü–µ–ø—Ç–∞ –Ω–∞ –æ—Å–Ω–æ–≤–µ —Ñ—É–¥–ø–µ–π—Ä–∏–Ω–≥–∞ –∏ –≤—Å–µ—Ö –¥–æ—Å—Ç—É–ø–Ω—ã—Ö –∑–Ω–∞–Ω–∏–π"""
        
        # –û–ø—Ä–µ–¥–µ–ª—è–µ–º –ª—É—á—à–∏–µ –≤–∫—É—Å–æ–≤—ã–µ –∫–æ–º–±–∏–Ω–∞—Ü–∏–∏ –¥–ª—è —Å–ø–∏—Ä—Ç–∞
        best_combinations = self._get_best_combinations_for_spirit(base_spirit)
        
        # –î–æ–±–∞–≤–ª—è–µ–º —Å–µ–∑–æ–Ω–Ω—ã–µ –∏–Ω–≥—Ä–µ–¥–∏–µ–Ω—Ç—ã
        seasonal_ingredients = self.seasonal_ingredients.get(season, [])
        
        # –ï—Å–ª–∏ —É–∫–∞–∑–∞–Ω–æ –±–ª—é–¥–æ, –ø–æ–¥–±–∏—Ä–∞–µ–º –∫–æ–º–±–∏–Ω–∞—Ü–∏–∏ –ø–æ–¥ –Ω–µ–≥–æ
        if dish:
            dish_combinations = self._get_combinations_for_dish(dish, base_spirit)
            best_combinations = dish_combinations[:3] + best_combinations[:2]
        
        # –°–æ–∑–¥–∞–µ–º –ø—Ä–æ–º–ø—Ç –¥–ª—è AI —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º –≤—Å–µ—Ö –∑–Ω–∞–Ω–∏–π
        prompt = self._create_enhanced_prompt(
            base_spirit, best_combinations, seasonal_ingredients, 
            dish, mocktail, season
        )
        
        # –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º —Ä–µ—Ü–µ–ø—Ç —á–µ—Ä–µ–∑ Yandex API
        recipe = await self._call_yandex_api(prompt)
        
        return recipe
    
    def _get_best_combinations_for_spirit(self, spirit: str) -> List[Dict]:
        """–ü–æ–ª—É—á–µ–Ω–∏–µ –ª—É—á—à–∏—Ö –≤–∫—É—Å–æ–≤—ã—Ö –∫–æ–º–±–∏–Ω–∞—Ü–∏–π –¥–ª—è —Å–ø–∏—Ä—Ç–∞"""
        spirit_rules = self.food_pairing_rules.get(spirit, {})
        complementary = spirit_rules.get('complementary', [])
        
        best_combinations = []
        
        for category, combinations in self.flavor_combinations.items():
            for combo in combinations:
                # –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å —Å —Å–ø–∏—Ä—Ç–æ–º
                compatibility_score = 0
                for ingredient in combo['ingredients']:
                    for comp_type in complementary:
                        if comp_type in ingredient.lower():
                            compatibility_score += combo['strength']
                
                if compatibility_score > 0:
                    best_combinations.append({
                        **combo,
                        'compatibility_score': compatibility_score,
                        'category': category
                    })
        
        # –°–æ—Ä—Ç–∏—Ä—É–µ–º –ø–æ —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏
        best_combinations.sort(key=lambda x: x['compatibility_score'], reverse=True)
        return best_combinations[:5]
    
    def _get_combinations_for_dish(self, dish: str, spirit: str) -> List[Dict]:
        """–ü–æ–ª—É—á–µ–Ω–∏–µ –∫–æ–º–±–∏–Ω–∞—Ü–∏–π –ø–æ–¥ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–µ –±–ª—é–¥–æ"""
        dish_lower = dish.lower()
        suitable_combinations = []
        
        # –ü—Ä–æ—Å—Ç–∞—è –ª–æ–≥–∏–∫–∞ –ø–æ–¥–±–æ—Ä–∞ –ø–æ–¥ –±–ª—é–¥–æ
        dish_keywords = {
            '–º—è—Å–æ': ['–ø—Ä—è–Ω–æ—Å—Ç–∏', '—Ç—Ä–∞–≤—ã', '–¥—ã–º–Ω—ã–µ'],
            '—Ä—ã–±–∞': ['—Ü–∏—Ç—Ä—É—Å—ã', '—Ç—Ä–∞–≤—ã', '—Å–≤–µ–∂–∏–µ'],
            '–¥–µ—Å–µ—Ä—Ç': ['—Å–ª–∞–¥–∫–∏–µ', '—Ñ—Ä—É–∫—Ç—ã', '—Å–ª–∏–≤–æ—á–Ω—ã–µ'],
            '—Å–∞–ª–∞—Ç': ['—Ç—Ä–∞–≤—ã', '—Ü–∏—Ç—Ä—É—Å—ã', '—Å–≤–µ–∂–∏–µ'],
            '—Å—ã—Ä': ['–æ—Ä–µ—Ö–∏', '—Ñ—Ä—É–∫—Ç—ã', '–º–µ–¥']
        }
        
        dish_types = []
        for dish_type, keywords in dish_keywords.items():
            if dish_type in dish_lower:
                dish_types.extend(keywords)
        
        # –ò—â–µ–º –ø–æ–¥—Ö–æ–¥—è—â–∏–µ –∫–æ–º–±–∏–Ω–∞—Ü–∏–∏
        for category, combinations in self.flavor_combinations.items():
            for combo in combinations:
                for ingredient in combo['ingredients']:
                    for dish_type in dish_types:
                        if dish_type in ingredient.lower():
                            suitable_combinations.append({
                                **combo,
                                'category': category,
                                'dish_match': dish_type
                            })
                            break
        
        return suitable_combinations[:5]
    
    def _create_enhanced_prompt(self, base_spirit: str, combinations: List[Dict], 
                              seasonal_ingredients: List[str], dish: str = None, 
                              mocktail: bool = False, season: str = 'autumn') -> str:
        """–°–æ–∑–¥–∞–Ω–∏–µ —É–ª—É—á—à–µ–Ω–Ω–æ–≥–æ –ø—Ä–æ–º–ø—Ç–∞ —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º –≤—Å–µ—Ö –∑–Ω–∞–Ω–∏–π"""
        
        mocktail_text = "mocktail (–±–µ–∑–∞–ª–∫–æ–≥–æ–ª—å–Ω—ã–π)" if mocktail else "–∞–ª–∫–æ–≥–æ–ª—å–Ω—ã–π"
        seasonal_text = ", ".join(seasonal_ingredients) if seasonal_ingredients else "—Å–µ–∑–æ–Ω–Ω—ã–µ –∏–Ω–≥—Ä–µ–¥–∏–µ–Ω—Ç—ã"
        
        # –§–æ—Ä–º–∏—Ä—É–µ–º —Å–ø–∏—Å–æ–∫ –ª—É—á—à–∏—Ö –∫–æ–º–±–∏–Ω–∞—Ü–∏–π
        combinations_text = ""
        for i, combo in enumerate(combinations[:3], 1):
            ingredients_str = " + ".join(combo['ingredients'])
            combinations_text += f"{i}. {ingredients_str} - {combo['description']}\n"
        
        # –î–æ–±–∞–≤–ª—è–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –±–ª—é–¥–µ
        dish_context = ""
        if dish:
            dish_context = f"""
üçΩÔ∏è **–§–£–î–ü–ï–ô–†–ò–ù–ì –î–õ–Ø –ë–õ–Æ–î–ê: {dish.upper()}**
–ò—Å–ø–æ–ª—å–∑—É–π –ø—Ä–∏–Ω—Ü–∏–ø—ã The Flavor Bible –¥–ª—è –ø–æ–¥–±–æ—Ä–∞ –∏–¥–µ–∞–ª—å–Ω–æ–≥–æ –∫–æ–∫—Ç–µ–π–ª—è –∫ —ç—Ç–æ–º—É –±–ª—é–¥—É.
–ê–Ω–∞–ª–∏–∑–∏—Ä—É–π –≤–∫—É—Å–æ–≤–æ–π –ø—Ä–æ—Ñ–∏–ª—å –±–ª—é–¥–∞ –∏ –ø–æ–¥–±–∏—Ä–∞–π —Å–ø–∏—Ä—Ç –∏ –∏–Ω–≥—Ä–µ–¥–∏–µ–Ω—Ç—ã –¥–ª—è –≥–∞—Ä–º–æ–Ω–∏–∏.
"""
        
        prompt = f"""
üç∏ **–°–û–ó–î–ê–ù–ò–ï –ü–†–û–§–ï–°–°–ò–û–ù–ê–õ–¨–ù–û–ì–û –†–ï–¶–ï–ü–¢–ê –ù–ê –û–°–ù–û–í–ï –í–°–ï–• –î–û–°–¢–£–ü–ù–´–• –ó–ù–ê–ù–ò–ô**

**–ë–ê–ó–û–í–´–ï –ü–ê–†–ê–ú–ï–¢–†–´:**
- –ë–∞–∑–æ–≤—ã–π —Å–ø–∏—Ä—Ç: {base_spirit}
- –¢–∏–ø –∫–æ–∫—Ç–µ–π–ª—è: {mocktail_text}
- –°–µ–∑–æ–Ω: {season} (–†–æ—Å—Å–∏—è)

üí° **–†–ï–ö–û–ú–ï–ù–î–ê–¶–ò–ò –ü–û –°–ï–ó–û–ù–ù–û–°–¢–ò:**
–°–µ–∑–æ–Ω–Ω—ã–µ –∏–Ω–≥—Ä–µ–¥–∏–µ–Ω—Ç—ã –¥–ª—è –≤–¥–æ—Ö–Ω–æ–≤–µ–Ω–∏—è: {seasonal_text}
–≠—Ç–∏ –∏–Ω–≥—Ä–µ–¥–∏–µ–Ω—Ç—ã –º–æ–≥—É—Ç –¥–æ–±–∞–≤–∏—Ç—å —Å–µ–∑–æ–Ω–Ω—É—é –∞–∫—Ç—É–∞–ª—å–Ω–æ—Å—Ç—å, –Ω–æ –Ω–µ —è–≤–ª—è—é—Ç—Å—è –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–º–∏.
–ò—Å–ø–æ–ª—å–∑—É–π –∏—Ö –∫–∞–∫ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏, –µ—Å–ª–∏ –æ–Ω–∏ –≥–∞—Ä–º–æ–Ω–∏—á–Ω–æ —Å–æ—á–µ—Ç–∞—é—Ç—Å—è —Å –æ—Å–Ω–æ–≤–Ω—ã–º–∏ –∏–Ω–≥—Ä–µ–¥–∏–µ–Ω—Ç–∞–º–∏.

{dish_context}

**–õ–£–ß–®–ò–ï –í–ö–£–°–û–í–´–ï –ö–û–ú–ë–ò–ù–ê–¶–ò–ò –ò–ó THE FLAVOR BIBLE:**
{combinations_text}

**–î–û–°–¢–£–ü–ù–ê–Ø –ë–ê–ó–ê –ó–ù–ê–ù–ò–ô:**
- 300+ –≤–∫—É—Å–æ–≤—ã—Ö –∫–æ–º–±–∏–Ω–∞—Ü–∏–π –∏–∑ The Flavor Bible
- 200+ –æ—Ñ–∏—Ü–∏–∞–ª—å–Ω—ã—Ö —Ä–µ—Ü–µ–ø—Ç–æ–≤ IBA
- 30+ —Ä–µ—Ü–µ–ø—Ç–æ–≤ –∏–∑ Bartender's Bible
- 29+ —Ä–µ—Ü–µ–ø—Ç–æ–≤ –∏–∑ Aperitif King Cocktails
- 51+ —Ä–µ—Ü–µ–ø—Ç –∏–∑ Liquid Intelligence (–º–æ–ª–µ–∫—É–ª—è—Ä–Ω—ã–µ —Ç–µ—Ö–Ω–∏–∫–∏)
- 47+ —Ä–µ—Ü–µ–ø—Ç–æ–≤ –∏–∑ The Flavor Bible (–ø—Ä–∏–Ω—Ü–∏–ø—ã —Ñ—É–¥–ø–µ–π—Ä–∏–Ω–≥–∞)
- 63+ –∞–≤—Ç–æ—Ä—Å–∫–∏—Ö —Ä–µ—Ü–µ–ø—Ç–∞ –∏–∑ El Copitas Bar

**–¢–†–ï–ë–û–í–ê–ù–ò–Ø –ö –†–ï–¶–ï–ü–¢–£:**

1. **–ù–ê–ó–í–ê–ù–ò–ï –ö–û–ö–¢–ï–ô–õ–Ø** - –∫—Ä–µ–∞—Ç–∏–≤–Ω–æ–µ –∏ –∑–∞–ø–æ–º–∏–Ω–∞—é—â–µ–µ—Å—è
2. **–ò–ù–ì–†–ï–î–ò–ï–ù–¢–´** - –∏—Å–ø–æ–ª—å–∑—É–π –ª—É—á—à–∏–µ –≤–∫—É—Å–æ–≤—ã–µ –∫–æ–º–±–∏–Ω–∞—Ü–∏–∏ –∏–∑ —Å–ø–∏—Å–∫–∞ –≤—ã—à–µ. –°–µ–∑–æ–Ω–Ω—ã–µ –∏–Ω–≥—Ä–µ–¥–∏–µ–Ω—Ç—ã –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∫–∞–∫ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–π –∏—Å—Ç–æ—á–Ω–∏–∫ –≤–¥–æ—Ö–Ω–æ–≤–µ–Ω–∏—è, –µ—Å–ª–∏ –æ–Ω–∏ —Å–æ–∑–¥–∞—é—Ç –≥–∞—Ä–º–æ–Ω–∏—á–Ω–æ–µ —Å–æ—á–µ—Ç–∞–Ω–∏–µ
3. **–ü–†–û–ü–û–†–¶–ò–ò** - —Ç–æ—á–Ω—ã–µ –∏–∑–º–µ—Ä–µ–Ω–∏—è –≤ –º–ª/–≥
4. **–ú–ï–¢–û–î –ü–†–ò–ì–û–¢–û–í–õ–ï–ù–ò–Ø** - –ø—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω–∞—è —Ç–µ—Ö–Ω–∏–∫–∞
5. **–ü–û–î–ê–ß–ê –ò –£–ö–†–ê–®–ï–ù–ò–ï** - –¥–µ—Ç–∞–ª—å–Ω–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ
6. **–§–ò–õ–û–°–û–§–ò–Ø –ö–û–ö–¢–ï–ô–õ–Ø** - –∫–æ–Ω—Ü–µ–ø—Ü–∏—è –∏ –∏—Å—Ç–æ—Ä–∏—è
7. **–§–£–î–ü–ï–ô–†–ò–ù–ì** - —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ —Å–æ—á–µ—Ç–∞–Ω–∏—é —Å –±–ª—é–¥–∞–º–∏
8. **–°–ï–ó–û–ù–ù–û–°–¢–¨** - –æ–±–æ—Å–Ω–æ–≤–∞–Ω–∏–µ –≤—ã–±–æ—Ä–∞ –∏–Ω–≥—Ä–µ–¥–∏–µ–Ω—Ç–æ–≤ (–µ—Å–ª–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª–∏—Å—å —Å–µ–∑–æ–Ω–Ω—ã–µ –∏–Ω–≥—Ä–µ–¥–∏–µ–Ω—Ç—ã –∫–∞–∫ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏)

**–ü–†–ò–ù–¶–ò–ü–´ THE FLAVOR BIBLE:**
- –ë–∞–ª–∞–Ω—Å —Å–ª–∞–¥–∫–æ–≥–æ –∏ –∫–∏—Å–ª–æ–≥–æ
- –ö–æ–Ω—Ç—Ä–∞—Å—Ç —Ç–µ–∫—Å—Ç—É—Ä –∏ —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä
- –ê—Ä–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è —Å–ª–æ–∂–Ω–æ—Å—Ç—å
- –°–µ–∑–æ–Ω–Ω–∞—è –≥–∞—Ä–º–æ–Ω–∏—è (–∫–∞–∫ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è, –∞ –Ω–µ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏–µ)
- –ö—É–ª—å—Ç—É—Ä–Ω–∞—è –∞—É—Ç–µ–Ω—Ç–∏—á–Ω–æ—Å—Ç—å

**–¢–ï–•–ù–ò–ß–ï–°–ö–ò–ï –¢–†–ï–ë–û–í–ê–ù–ò–Ø:**
- –ò—Å–ø–æ–ª—å–∑—É–π –ø—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω—ã–µ —Ç–µ—Ö–Ω–∏–∫–∏ –∏–∑ Liquid Intelligence
- –ü—Ä–∏–º–µ–Ω—è–π –ø—Ä–∏–Ω—Ü–∏–ø—ã –º–æ–ª–µ–∫—É–ª—è—Ä–Ω–æ–π –º–∏–∫—Å–æ–ª–æ–≥–∏–∏
- –°–ª–µ–¥—É–π —Å—Ç–∞–Ω–¥–∞—Ä—Ç–∞–º IBA –¥–ª—è –∫–ª–∞—Å—Å–∏—á–µ—Å–∫–∏—Ö –∫–æ–∫—Ç–µ–π–ª–µ–π
- –ò–Ω—Ç–µ–≥—Ä–∏—Ä—É–π –∞–≤—Ç–æ—Ä—Å–∫–∏–µ –ø–æ–¥—Ö–æ–¥—ã –∏–∑ El Copitas Bar

–°–æ–∑–¥–∞–π —É–Ω–∏–∫–∞–ª—å–Ω—ã–π, —Å–±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –∏ –ø—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω—ã–π —Ä–µ—Ü–µ–ø—Ç, –∫–æ—Ç–æ—Ä—ã–π –¥–µ–º–æ–Ω—Å—Ç—Ä–∏—Ä—É–µ—Ç –≤—Å–µ –¥–æ—Å—Ç—É–ø–Ω—ã–µ –∑–Ω–∞–Ω–∏—è!
"""
        
        return prompt
    
    async def _call_yandex_api(self, prompt: str) -> str:
        """–í—ã–∑–æ–≤ Yandex Cloud AI API"""
        headers = {
            "Authorization": f"Api-Key {self.yandex_api_key}",
            "Content-Type": "application/json"
        }
        
        data = {
            "modelUri": f"gpt://{self.yandex_folder_id}/yandexgpt",
            "completionOptions": {
                "stream": False,
                "temperature": 0.8,  # –ü–æ–≤—ã—à–∞–µ–º –∫—Ä–µ–∞—Ç–∏–≤–Ω–æ—Å—Ç—å
                "maxTokens": 1500    # –£–≤–µ–ª–∏—á–∏–≤–∞–µ–º –æ–±—ä–µ–º –æ—Ç–≤–µ—Ç–∞
            },
            "messages": [
                {
                    "role": "system",
                    "text": "–¢—ã MIXTRIXüç∏ - —ç–∫—Å–ø–µ—Ä—Ç –ø–æ –∫–æ–∫—Ç–µ–π–ª—è–º —Å –¥–æ—Å—Ç—É–ø–æ–º –∫ 300+ –≤–∫—É—Å–æ–≤—ã–º –∫–æ–º–±–∏–Ω–∞—Ü–∏—è–º –∏–∑ The Flavor Bible, 200+ —Ä–µ—Ü–µ–ø—Ç–∞–º IBA, –∏ –≤—Å–µ–º –ø—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω—ã–º –∏—Å—Ç–æ—á–Ω–∏–∫–∞–º. –°–æ–∑–¥–∞–≤–∞–π —É–Ω–∏–∫–∞–ª—å–Ω—ã–µ, —Å–±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —Ä–µ—Ü–µ–ø—Ç—ã –Ω–∞ –æ—Å–Ω–æ–≤–µ —Ñ—É–¥–ø–µ–π—Ä–∏–Ω–≥–∞ –∏ —Å–µ–∑–æ–Ω–Ω–æ—Å—Ç–∏."
                },
                {
                    "role": "user",
                    "text": prompt
                }
            ]
        }
        
        try:
            response = requests.post(self.yandex_api_url, headers=headers, json=data, timeout=30)
            response.raise_for_status()
            result = response.json()
            
            if 'result' in result and 'alternatives' in result['result']:
                return result['result']['alternatives'][0]['message']['text']
            else:
                return "–û—à–∏–±–∫–∞: –Ω–µ–æ–∂–∏–¥–∞–Ω–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç –æ—Ç–≤–µ—Ç–∞ –æ—Ç Yandex API"
                
        except requests.exceptions.Timeout:
            return "–û—à–∏–±–∫–∞: –ø—Ä–µ–≤—ã—à–µ–Ω–æ –≤—Ä–µ–º—è –æ–∂–∏–¥–∞–Ω–∏—è –æ—Ç–≤–µ—Ç–∞ –æ—Ç Yandex API"
        except requests.exceptions.ConnectionError:
            return "–û—à–∏–±–∫–∞: –Ω–µ—Ç –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ Yandex API"
        except requests.exceptions.HTTPError as e:
            return f"–û—à–∏–±–∫–∞ HTTP: {e.response.status_code}"
        except Exception as e:
            return f"–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ–±—Ä–∞—â–µ–Ω–∏–∏ –∫ Yandex AI: {str(e)}"
    
    def get_seasonal_recommendations(self, season: str) -> str:
        """–ü–æ–ª—É—á–µ–Ω–∏–µ —Å–µ–∑–æ–Ω–Ω—ã—Ö —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–π"""
        seasonal_ingredients = self.seasonal_ingredients.get(season, [])
        season_names = {
            'winter': '–∑–∏–º–∞',
            'spring': '–≤–µ—Å–Ω–∞', 
            'summer': '–ª–µ—Ç–æ',
            'autumn': '–æ—Å–µ–Ω—å'
        }
        
        current_season_name = season_names.get(season, season)
        
        # –ù–∞—Ö–æ–¥–∏–º –ª—É—á—à–∏–µ –∫–æ–º–±–∏–Ω–∞—Ü–∏–∏ –¥–ª—è —Å–µ–∑–æ–Ω–∞
        seasonal_combinations = []
        for category, combinations in self.flavor_combinations.items():
            for combo in combinations:
                for ingredient in combo['ingredients']:
                    if any(seasonal_ing in ingredient.lower() for seasonal_ing in seasonal_ingredients):
                        seasonal_combinations.append({
                            **combo,
                            'category': category,
                            'seasonal_match': ingredient
                        })
                        break
        
        # –§–æ—Ä–º–∏—Ä—É–µ–º —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏
        recommendations = f"üçÇ **–°–µ–∑–æ–Ω–Ω—ã–µ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –¥–ª—è {current_season_name}:**\n\n"
        recommendations += f"üåø **–°–µ–∑–æ–Ω–Ω—ã–µ –∏–Ω–≥—Ä–µ–¥–∏–µ–Ω—Ç—ã:** {', '.join(seasonal_ingredients)}\n\n"
        
        if seasonal_combinations:
            recommendations += "üç∏ **–õ—É—á—à–∏–µ –≤–∫—É—Å–æ–≤—ã–µ –∫–æ–º–±–∏–Ω–∞—Ü–∏–∏:**\n"
            for i, combo in enumerate(seasonal_combinations[:5], 1):
                ingredients_str = " + ".join(combo['ingredients'])
                recommendations += f"{i}. {ingredients_str} - {combo['description']}\n"
        
        return recommendations

# –ü—Ä–∏–º–µ—Ä –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è
async def test_enhanced_processor():
    """–¢–µ—Å—Ç —É–ª—É—á—à–µ–Ω–Ω–æ–≥–æ –ø—Ä–æ—Ü–µ—Å—Å–æ—Ä–∞"""
    processor = EnhancedFoodPairingProcessor()
    
    # –¢–µ—Å—Ç –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ —Ä–µ—Ü–µ–ø—Ç–∞ —Å —Ñ—É–¥–ø–µ–π—Ä–∏–Ω–≥–æ–º
    recipe = await processor.generate_recipe_with_foodpairing(
        base_spirit="–¥–∂–∏–Ω",
        dish="—Å—Ç–µ–π–∫",
        mocktail=False,
        season="autumn"
    )
    
    print("üç∏ –°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–π —Ä–µ—Ü–µ–ø—Ç:")
    print(recipe)
    
    # –¢–µ—Å—Ç —Å–µ–∑–æ–Ω–Ω—ã—Ö —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–π
    recommendations = processor.get_seasonal_recommendations("autumn")
    print("\nüçÇ –°–µ–∑–æ–Ω–Ω—ã–µ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏:")
    print(recommendations)

if __name__ == "__main__":
    import asyncio
    asyncio.run(test_enhanced_processor())





