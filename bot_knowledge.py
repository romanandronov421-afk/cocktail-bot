#!/usr/bin/env python3
# -*- coding: utf-8 -*-

import os
import asyncio
import sys
import random
import json
from aiogram import Bot, Dispatcher, types
from aiogram.filters import Command
from aiogram.types import InlineKeyboardMarkup, InlineKeyboardButton
from dotenv import load_dotenv
import requests
import json
from datetime import datetime

print("=== –ó–∞–ø—É—Å–∫ MixMatrix Bot (–ë–∞–∑–∞ –∑–Ω–∞–Ω–∏–π) ===")

# –ó–∞–≥—Ä—É–∂–∞–µ–º –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è
print("–ó–∞–≥—Ä—É–∂–∞–µ–º –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è...")
try:
    load_dotenv('env_file.txt')
    print("‚úì –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è –∑–∞–≥—Ä—É–∂–µ–Ω—ã")
except Exception as e:
    print(f"‚úó –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö: {e}")
    try:
        load_dotenv('environment.env')
        print("‚úì –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è –∑–∞–≥—Ä—É–∂–µ–Ω—ã –∏–∑ environment.env")
    except:
        print("‚úó –ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è")
        sys.exit(1)

# –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞–ª–∏—á–∏–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã—Ö –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö
print("–ü—Ä–æ–≤–µ—Ä—è–µ–º –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è...")
if not os.getenv('TELEGRAM_BOT_TOKEN'):
    print("‚ùå –û—à–∏–±–∫–∞: TELEGRAM_BOT_TOKEN –Ω–µ –Ω–∞–π–¥–µ–Ω –≤ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è")
    sys.exit(1)

if not os.getenv('YANDEX_API_KEY'):
    print("‚ùå –û—à–∏–±–∫–∞: YANDEX_API_KEY –Ω–µ –Ω–∞–π–¥–µ–Ω –≤ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è")
    sys.exit(1)

if not os.getenv('FOLDER_ID'):
    print("‚ùå –û—à–∏–±–∫–∞: FOLDER_ID –Ω–µ –Ω–∞–π–¥–µ–Ω –≤ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è")
    sys.exit(1)

print("‚úì –í—Å–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –Ω–∞–π–¥–µ–Ω—ã")

# –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –±–æ—Ç–∞
print("–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º –±–æ—Ç–∞...")
try:
    bot = Bot(token=os.getenv('TELEGRAM_BOT_TOKEN'))
    dp = Dispatcher()
    print("‚úì –ë–æ—Ç –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω")
except Exception as e:
    print(f"‚ùå –û—à–∏–±–∫–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ –±–æ—Ç–∞: {e}")
    sys.exit(1)

# –°–µ–∑–æ–Ω–Ω—ã–µ –∏–Ω–≥—Ä–µ–¥–∏–µ–Ω—Ç—ã –¥–ª—è –†–æ—Å—Å–∏–∏ —Å –∞–ª–∫–æ–≥–æ–ª—å–Ω—ã–º–∏ —Å–æ—á–µ—Ç–∞–Ω–∏—è–º–∏
SEASONAL_INGREDIENTS = {
    'winter': ['–∫–ª—é–∫–≤–∞', '–±—Ä—É—Å–Ω–∏–∫–∞', '–æ–±–ª–µ–ø–∏—Ö–∞', '—Ü–∏—Ç—Ä—É—Å—ã', '–∫–æ—Ä–∏—Ü–∞', '–≥–≤–æ–∑–¥–∏–∫–∞', '–º—É—Å–∫–∞—Ç–Ω—ã–π –æ—Ä–µ—Ö', '–≤–∞–Ω–∏–ª—å'],
    'spring': ['—Ä–µ–≤–µ–Ω—å', '—â–∞–≤–µ–ª—å', '–º–æ–ª–æ–¥—ã–µ —Ç—Ä–∞–≤—ã', '—Ü–≤–µ—Ç—ã —Å–∏—Ä–µ–Ω–∏', '—á–µ—Ä–µ–º—É—Ö–∞', '–º–µ–ª–∏—Å—Å–∞', '–º—è—Ç–∞'],
    'summer': ['–∫–ª—É–±–Ω–∏–∫–∞', '–º–∞–ª–∏–Ω–∞', '—Å–º–æ—Ä–æ–¥–∏–Ω–∞', '–∫—Ä—ã–∂–æ–≤–Ω–∏–∫', '–≤–∏—à–Ω—è', '–±–∞–∑–∏–ª–∏–∫', '—É–∫—Ä–æ–ø', '–ø–µ—Ç—Ä—É—à–∫–∞'],
    'autumn': ['—è–±–ª–æ–∫–∏', '–≥—Ä—É—à–∏', '—Å–ª–∏–≤—ã', '—Ç—ã–∫–≤–∞', '–∫–∞–ª–∏–Ω–∞', '—Ä—è–±–∏–Ω–∞', '–æ—Ä–µ—Ö–∏', '–º–µ–¥']
}

# –î–µ—Ç–∞–ª—å–Ω–∞—è —Ç–∞–±–ª–∏—Ü–∞ —Å–µ–∑–æ–Ω–Ω–æ—Å—Ç–∏ —Ñ—Ä—É–∫—Ç–æ–≤ –∏ —è–≥–æ–¥ —Å –∞–ª–∫–æ–≥–æ–ª—å–Ω—ã–º–∏ —Å–æ—á–µ—Ç–∞–Ω–∏—è–º–∏
FRUIT_SEASONALITY_TABLE = {
    '–º–∞–ª–∏–Ω–∞': {
        'alcohol': ['G', 'V', 'R'],  # –î–∂–∏–Ω, –í–æ–¥–∫–∞, –†–æ–º
        'season': ['–∏—é–ª—å', '–∞–≤–≥—É—Å—Ç', '—Å–µ–Ω—Ç—è–±—Ä—å'],
        'description': '—Å–ª–∞–¥–∫–∏–µ —è–≥–æ–¥–Ω—ã–µ –Ω–æ—Ç—ã'
    },
    '—Å–º–æ—Ä–æ–¥–∏–Ω–∞_—á–µ—Ä–Ω–∞—è': {
        'alcohol': ['G', 'V', 'R'],
        'season': ['–∏—é–ª—å', '–∞–≤–≥—É—Å—Ç'],
        'description': '—Ç–µ—Ä–ø–∫–∏–µ —è–≥–æ–¥–Ω—ã–µ –Ω–æ—Ç—ã'
    },
    '—Å–º–æ—Ä–æ–¥–∏–Ω–∞_–∫—Ä–∞—Å–Ω–∞—è': {
        'alcohol': ['G', 'V', 'R'],
        'season': ['–∏—é–ª—å', '–∞–≤–≥—É—Å—Ç'],
        'description': '–∫–∏—Å–ª—ã–µ —è–≥–æ–¥–Ω—ã–µ –Ω–æ—Ç—ã'
    },
    '—Å–ª–∏–≤–∞': {
        'alcohol': ['W', 'B'],  # –í–∏—Å–∫–∏, –ë—Ä–µ–Ω–¥–∏
        'season': ['–∞–≤–≥—É—Å—Ç', '—Å–µ–Ω—Ç—è–±—Ä—å'],
        'description': '—Å–ª–∞–¥–∫–∏–µ —Ñ—Ä—É–∫—Ç–æ–≤—ã–µ –Ω–æ—Ç—ã'
    },
    '–∞–±—Ä–∏–∫–æ—Å': {
        'alcohol': ['W', 'B'],
        'season': ['–∏—é–Ω—å', '–∏—é–ª—å', '–∞–≤–≥—É—Å—Ç'],
        'description': '—Å–ª–∞–¥–∫–∏–µ —Ç—Ä–æ–ø–∏—á–µ—Å–∫–∏–µ –Ω–æ—Ç—ã'
    },
    '–≤–∏—à–Ω—è': {
        'alcohol': ['G', 'V', 'R'],
        'season': ['–∏—é–Ω—å', '–∏—é–ª—å'],
        'description': '—Å–ª–∞–¥–∫–∏–µ –≤–∏—à–Ω–µ–≤—ã–µ –Ω–æ—Ç—ã'
    },
    '—á–µ—Ä–µ—à–Ω—è': {
        'alcohol': ['G', 'V', 'R'],
        'season': ['–º–∞–π', '–∏—é–Ω—å'],
        'description': '—Å–ª–∞–¥–∫–∏–µ —Ä–∞–Ω–Ω–∏–µ –Ω–æ—Ç—ã'
    },
    '–≥—Ä–∞–Ω–∞—Ç': {
        'alcohol': ['V', 'R'],  # –í–æ–¥–∫–∞, –†–æ–º
        'season': ['–æ–∫—Ç—è–±—Ä—å', '–Ω–æ—è–±—Ä—å'],
        'description': '—Ç–µ—Ä–ø–∫–∏–µ —ç–∫–∑–æ—Ç–∏—á–µ—Å–∫–∏–µ –Ω–æ—Ç—ã'
    },
    '–∫–ª—é–∫–≤–∞': {
        'alcohol': ['V', 'R'],  # –í–æ–¥–∫–∞, –†–æ–º
        'season': ['—Å–µ–Ω—Ç—è–±—Ä—å', '–æ–∫—Ç—è–±—Ä—å', '–Ω–æ—è–±—Ä—å'],
        'description': '–∫–∏—Å–ª—ã–µ –∑–∏–º–Ω–∏–µ –Ω–æ—Ç—ã'
    },
    '–º–∞–Ω–¥–∞—Ä–∏–Ω—ã': {
        'alcohol': ['G', 'V'],  # –î–∂–∏–Ω, –í–æ–¥–∫–∞
        'season': ['–Ω–æ—è–±—Ä—å', '–¥–µ–∫–∞–±—Ä—å'],
        'description': '—Å–ª–∞–¥–∫–∏–µ —Ü–∏—Ç—Ä—É—Å–æ–≤—ã–µ –Ω–æ—Ç—ã'
    },
    '–ø–µ—Ä—Å–∏–∫–∏': {
        'alcohol': ['W', 'B'],  # –í–∏—Å–∫–∏, –ë—Ä–µ–Ω–¥–∏
        'season': ['–∏—é–ª—å', '–∞–≤–≥—É—Å—Ç', '—Å–µ–Ω—Ç—è–±—Ä—å'],
        'description': '—Å–ª–∞–¥–∫–∏–µ –ª–µ—Ç–Ω–∏–µ –Ω–æ—Ç—ã'
    },
    '–∞–π–≤–∞': {
        'alcohol': ['W', 'B'],  # –í–∏—Å–∫–∏, –ë—Ä–µ–Ω–¥–∏
        'season': ['–æ–∫—Ç—è–±—Ä—å', '–Ω–æ—è–±—Ä—å'],
        'description': '—Ç–µ—Ä–ø–∫–∏–µ –æ—Å–µ–Ω–Ω–∏–µ –Ω–æ—Ç—ã'
    },
    '–ª–∏–º–æ–Ω': {
        'alcohol': ['G', 'V'],  # –î–∂–∏–Ω, –í–æ–¥–∫–∞
        'season': ['—è–Ω–≤–∞—Ä—å', '–¥–µ–∫–∞–±—Ä—å'],
        'description': '–∫–∏—Å–ª—ã–µ —Ü–∏—Ç—Ä—É—Å–æ–≤—ã–µ –Ω–æ—Ç—ã'
    },
    '–≥—Ä—É—à–∞': {
        'alcohol': ['W', 'B'],  # –í–∏—Å–∫–∏, –ë—Ä–µ–Ω–¥–∏
        'season': ['—Å–µ–Ω—Ç—è–±—Ä—å', '–æ–∫—Ç—è–±—Ä—å'],
        'description': '—Å–ª–∞–¥–∫–∏–µ –æ—Å–µ–Ω–Ω–∏–µ –Ω–æ—Ç—ã'
    },
    '–∫–ª—É–±–Ω–∏–∫–∞': {
        'alcohol': ['G', 'V', 'R'],  # –î–∂–∏–Ω, –í–æ–¥–∫–∞, –†–æ–º
        'season': ['–º–∞–π', '–∏—é–Ω—å'],
        'description': '—Å–ª–∞–¥–∫–∏–µ –≤–µ—Å–µ–Ω–Ω–∏–µ –Ω–æ—Ç—ã'
    },
    '—è–±–ª–æ–∫–∏': {
        'alcohol': ['W', 'B'],  # –í–∏—Å–∫–∏, –ë—Ä–µ–Ω–¥–∏
        'season': ['—Å–µ–Ω—Ç—è–±—Ä—å', '–æ–∫—Ç—è–±—Ä—å'],
        'description': '—Å–ª–∞–¥–∫–∏–µ –æ—Å–µ–Ω–Ω–∏–µ –Ω–æ—Ç—ã'
    },
    '–∫—Ä—ã–∂–æ–≤–Ω–∏–∫': {
        'alcohol': ['G', 'V', 'R'],  # –î–∂–∏–Ω, –í–æ–¥–∫–∞, –†–æ–º
        'season': ['–∏—é–ª—å', '–∞–≤–≥—É—Å—Ç', '—Å–µ–Ω—Ç—è–±—Ä—å'],
        'description': '–∫–∏—Å–ª—ã–µ –ª–µ—Ç–Ω–∏–µ –Ω–æ—Ç—ã'
    },
    '—á–µ—Ä–Ω–æ–ø–ª–æ–¥–∫–∞': {
        'alcohol': ['W', 'B'],  # –í–∏—Å–∫–∏, –ë—Ä–µ–Ω–¥–∏
        'season': ['—Å–µ–Ω—Ç—è–±—Ä—å', '–æ–∫—Ç—è–±—Ä—å'],
        'description': '—Ç–µ—Ä–ø–∫–∏–µ –æ—Å–µ–Ω–Ω–∏–µ –Ω–æ—Ç—ã'
    },
    '—Ä—è–±–∏–Ω–∞': {
        'alcohol': ['W', 'B'],  # –í–∏—Å–∫–∏, –ë—Ä–µ–Ω–¥–∏
        'season': ['—Å–µ–Ω—Ç—è–±—Ä—å', '–æ–∫—Ç—è–±—Ä—å', '–Ω–æ—è–±—Ä—å'],
        'description': '—Ç–µ—Ä–ø–∫–∏–µ –∑–∏–º–Ω–∏–µ –Ω–æ—Ç—ã'
    },
    '–Ω–µ–∫—Ç–∞—Ä–∏–Ω': {
        'alcohol': ['W', 'B'],  # –í–∏—Å–∫–∏, –ë—Ä–µ–Ω–¥–∏
        'season': ['–∏—é–ª—å', '–∞–≤–≥—É—Å—Ç', '—Å–µ–Ω—Ç—è–±—Ä—å'],
        'description': '—Å–ª–∞–¥–∫–∏–µ –ª–µ—Ç–Ω–∏–µ –Ω–æ—Ç—ã'
    }
}

# –†–∞—Å—à–∏—Ñ—Ä–æ–≤–∫–∞ –∫–æ–¥–æ–≤ –∞–ª–∫–æ–≥–æ–ª—è
ALCOHOL_CODES = {
    'G': '–¥–∂–∏–Ω',
    'V': '–≤–æ–¥–∫–∞', 
    'R': '—Ä–æ–º',
    'W': '–≤–∏—Å–∫–∏',
    'T': '—Ç–µ–∫–∏–ª–∞',
    'B': '–±—Ä–µ–Ω–¥–∏'
}

# –°–∏—Å—Ç–µ–º–∞ –æ–ø–∏—Å–∞–Ω–∏—è –≤–∫—É—Å–æ–≤
TASTE_PROFILES = {
    'basic_tastes': {
        '–∫–∏—Å–ª—ã–π': ['–ª–∏–º–æ–Ω', '–ª–∞–π–º', '–≥—Ä–µ–π–ø—Ñ—Ä—É—Ç', '–∫–ª—é–∫–≤–∞', '—Å–º–æ—Ä–æ–¥–∏–Ω–∞'],
        '—Å–ª–∞–¥–∫–∏–π': ['—Å–∞—Ö–∞—Ä', '–º–µ–¥', '—Å–∏—Ä–æ–ø', '—Ñ—Ä—É–∫—Ç—ã', '—è–≥–æ–¥—ã'],
        '–≥–æ—Ä—å–∫–∏–π': ['–∫–∞–º–ø–∞—Ä–∏', '–∞–ø–µ—Ä–æ–ª—å', '–±–∏—Ç—Ç–µ—Ä—Å', '–≥—Ä–µ–π–ø—Ñ—Ä—É—Ç'],
        '–ø—Ä—è–Ω—ã–π': ['–∏–º–±–∏—Ä—å', '–∫–æ—Ä–∏—Ü–∞', '–∫–∞—Ä–¥–∞–º–æ–Ω', '–ø–µ—Ä–µ—Ü'],
        '—Ç–µ—Ä–ø–∫–∏–π': ['–≥—Ä–∞–Ω–∞—Ç', '–∞–π–≤–∞', '—Ä—è–±–∏–Ω–∞', '—á–µ—Ä–Ω–æ–ø–ª–æ–¥–∫–∞'],
        '–æ—Å—Ç—Ä—ã–π': ['–ø–µ—Ä–µ—Ü —á–∏–ª–∏', '—Ç–∞–±–∞—Å–∫–æ', '—Ö—Ä–µ–Ω'],
        '—Å–æ–ª–µ–Ω—ã–π': ['—Å–æ–ª—å', '–æ–ª–∏–≤–∫–∏', '–∫–∞–ø–µ—Ä—Å—ã'],
        '—É–º–∞–º–∏': ['—Ç–æ–º–∞—Ç', '–≥—Ä–∏–±—ã', '—Å–æ–µ–≤—ã–π —Å–æ—É—Å', '–ø–∞—Ä–º–µ–∑–∞–Ω']
    },
    
    'taste_combinations': {
        '–∫–∏—Å–ª–æ-—Å–ª–∞–¥–∫–∏–π': ['–ª–∏–º–æ–Ω + –º–µ–¥', '–ª–∞–π–º + —Å–∞—Ö–∞—Ä', '–∫–ª—é–∫–≤–∞ + —Å–∏—Ä–æ–ø'],
        '–≥–æ—Ä—å–∫–æ-—Å–ª–∞–¥–∫–∏–π': ['–∫–∞–º–ø–∞—Ä–∏ + —Å–∏—Ä–æ–ø', '–∞–ø–µ—Ä–æ–ª—å + –º–µ–¥'],
        '–ø—Ä—è–Ω–æ-—Å–ª–∞–¥–∫–∏–π': ['–∏–º–±–∏—Ä—å + –º–µ–¥', '–∫–æ—Ä–∏—Ü–∞ + —Å–∞—Ö–∞—Ä'],
        '–æ—Å—Ç—Ä–æ-–∫–∏—Å–ª—ã–π': ['–ø–µ—Ä–µ—Ü + –ª–∞–π–º', '—Ç–∞–±–∞—Å–∫–æ + –ª–∏–º–æ–Ω'],
        '—Å–±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–π': ['—Ä–∞–≤–Ω—ã–µ –ø—Ä–æ–ø–æ—Ä—Ü–∏–∏ –≤—Å–µ—Ö –≤–∫—É—Å–æ–≤'],
        '–∫–æ–Ω—Ç—Ä–∞—Å—Ç–Ω—ã–π': ['—Ä–µ–∑–∫–∏–µ –ø–µ—Ä–µ—Ö–æ–¥—ã –º–µ–∂–¥—É –≤–∫—É—Å–∞–º–∏'],
        '—Å–ª–æ–∂–Ω—ã–π': ['–º–Ω–æ–≥–æ—Å–ª–æ–π–Ω—ã–π –≤–∫—É—Å–æ–≤–æ–π –ø—Ä–æ—Ñ–∏–ª—å'],
        '–Ω–∞—Å–ª–∞–∏–≤–∞—é—â–∏–π—Å—è': ['–ø–æ—Å—Ç–µ–ø–µ–Ω–Ω–æ–µ —Ä–∞—Å–∫—Ä—ã—Ç–∏–µ –≤–∫—É—Å–æ–≤']
    },
    
    'strength_levels': {
        '–±–µ–∑–∞–ª–∫–æ–≥–æ–ª—å–Ω—ã–π': '0% –∞–ª–∫–æ–≥–æ–ª—è',
        '—Å–ª–∞–±–æ–∞–ª–∫–æ–≥–æ–ª—å–Ω—ã–π': '5-15% –∞–ª–∫–æ–≥–æ–ª—è',
        '—Å—Ä–µ–¥–Ω–µ–π –∫—Ä–µ–ø–æ—Å—Ç–∏': '15-25% –∞–ª–∫–æ–≥–æ–ª—è',
        '–∫—Ä–µ–ø–∫–∏–π': '25%+ –∞–ª–∫–æ–≥–æ–ª—è'
    },
    
    'volume_categories': {
        '—à–æ—Ç': '30-60–º–ª',
        '—Å—Ä–µ–¥–Ω–µ–≥–æ –æ–±—ä–µ–º–∞': '60-120–º–ª',
        '–ª–æ–Ω–≥–¥—Ä–∏–Ω–∫': '120-300–º–ª'
    },
    
    'aroma_profiles': {
        '—Ü–∏—Ç—Ä—É—Å–æ–≤—ã–π': ['–ª–∏–º–æ–Ω', '–ª–∞–π–º', '–∞–ø–µ–ª—å—Å–∏–Ω', '–≥—Ä–µ–π–ø—Ñ—Ä—É—Ç'],
        '—Ç—Ä–∞–≤—è–Ω–æ–π': ['–º—è—Ç–∞', '–±–∞–∑–∏–ª–∏–∫', '—Ä–æ–∑–º–∞—Ä–∏–Ω', '—Ç–∏–º—å—è–Ω'],
        '—Ü–≤–µ—Ç–æ—á–Ω—ã–π': ['–ª–∞–≤–∞–Ω–¥–∞', '—Ä–æ–∑–∞', '–∂–∞—Å–º–∏–Ω', '—Ñ–∏–∞–ª–∫–∞'],
        '—Ñ—Ä—É–∫—Ç–æ–≤—ã–π': ['—è–≥–æ–¥—ã', '–ø–µ—Ä—Å–∏–∫–∏', '—è–±–ª–æ–∫–∏', '–≥—Ä—É—à–∏'],
        '–ø—Ä—è–Ω—ã–π': ['–∫–æ—Ä–∏—Ü–∞', '–∏–º–±–∏—Ä—å', '–∫–∞—Ä–¥–∞–º–æ–Ω', '–≥–≤–æ–∑–¥–∏–∫–∞'],
        '–¥—Ä–µ–≤–µ—Å–Ω—ã–π': ['–¥—É–±', '—Å–æ—Å–Ω–∞', '–∫–µ–¥—Ä', '—Å–∞–Ω–¥–∞–ª'],
        '—Å–≤–µ–∂–∏–π': ['–º—è—Ç–∞', '–æ–≥—É—Ä–µ—Ü', '–ª–∞–π–º', '–±–∞–∑–∏–ª–∏–∫'],
        '—Å–ª–∞–¥–∫–∏–π': ['–≤–∞–Ω–∏–ª—å', '–º–µ–¥', '–∫–∞—Ä–∞–º–µ–ª—å', '—à–æ–∫–æ–ª–∞–¥']
    },
    
    'cocktail_groups': {
        '–∫–∏—Å–ª—ã–µ': ['–≤–∏—Å–∫–∏ —Å–∞—É—ç—Ä', '–¥–∂–∏–Ω —Å–∞—É—ç—Ä', '–¥–∞–π–∫–∏—Ä–∏'],
        '–∞–ø–µ—Ä–∏—Ç–∏–≤—ã': ['–Ω–µ–≥—Ä–æ–Ω–∏', '–∞–º–µ—Ä–∏–∫–∞–Ω–æ', '–∫–∞–º–ø–∞—Ä–∏ —Å–æ–¥–æ–≤–∞—è'],
        '–¥–∏–∂–µ—Å—Ç–∏–≤—ã': ['–º–∞–Ω–∏—Ö–∞—Ç—Ç–µ–Ω', '—Å—Ç–∞—Ä–æ–º–æ–¥–Ω—ã–π', '–≤–∏—Å–∫–∏'],
        '—Ç—Ä–æ–ø–∏—á–µ—Å–∫–∏–µ': ['–º–æ—Ö–∏—Ç–æ', '–º–∞–π —Ç–∞–π', '–ø–∏–Ω–∞ –∫–æ–ª–∞–¥–∞'],
        '—Å—Ç–∏—Ä-–¥—Ä–∏–Ω–∫–∏': ['–º–∞–Ω–∏—Ö–∞—Ç—Ç–µ–Ω', '–Ω–µ–≥—Ä–æ–Ω–∏', '–∞–º–µ—Ä–∏–∫–∞–Ω–æ'],
        '—Ö–∞–π–±–æ–ª—ã': ['–¥–∂–∏–Ω-—Ç–æ–Ω–∏–∫', '–≤–∏—Å–∫–∏ —Å —Å–æ–¥–æ–≤–æ–π', '—Ä–æ–º —Å –∫–æ–ª–æ–π'],
        '—à–æ—Ç—ã': ['—Ç–µ–∫–∏–ª–∞', '–¥–∂–∏–Ω', '–≤–æ–¥–∫–∞'],
        '—Å–±–∏—Ç—ã–µ': ['–≤–∏—Å–∫–∏ —Å–∞—É—ç—Ä', '–¥–∂–∏–Ω —Å–∞—É—ç—Ä', '–¥–∞–π–∫–∏—Ä–∏']
    },
    
    'texture_body': {
        '–ª–µ–≥–∫–æ–µ': '–≤–æ–¥—è–Ω–∏—Å—Ç–∞—è –∫–æ–Ω—Å–∏—Å—Ç–µ–Ω—Ü–∏—è',
        '—Å—Ä–µ–¥–Ω–µ–µ': '—É–º–µ—Ä–µ–Ω–Ω–∞—è –ø–ª–æ—Ç–Ω–æ—Å—Ç—å',
        '–ø–ª–æ—Ç–Ω–æ–µ': '–Ω–∞—Å—ã—â–µ–Ω–Ω–∞—è –∫–æ–Ω—Å–∏—Å—Ç–µ–Ω—Ü–∏—è',
        '—à–µ–ª–∫–æ–≤–∏—Å—Ç–æ–µ': '–≥–ª–∞–¥–∫–∞—è —Ç–µ–∫—Å—Ç—É—Ä–∞',
        '–±–∞—Ä—Ö–∞—Ç–∏—Å—Ç–æ–µ': '–º—è–≥–∫–∞—è —Ç–µ–∫—Å—Ç—É—Ä–∞',
        '–≤—è–∂—É—â–µ–µ': '—Ç–µ—Ä–ø–∫–∞—è —Ç–µ–∫—Å—Ç—É—Ä–∞',
        '–∏–≥—Ä–∏—Å—Ç–æ–µ': '–≥–∞–∑–∏—Ä–æ–≤–∞–Ω–Ω–∞—è —Ç–µ–∫—Å—Ç—É—Ä–∞',
        '—Å–ª–∏–≤–æ—á–Ω–æ–µ': '–º–æ–ª–æ—á–Ω–∞—è —Ç–µ–∫—Å—Ç—É—Ä–∞'
    },
    
    'balance_types': {
        '–≥–∞—Ä–º–æ–Ω–∏—á–Ω—ã–π': '–≤—Å–µ –≤–∫—É—Å—ã –≤ —Ä–∞–≤–Ω–æ–≤–µ—Å–∏–∏',
        '—Å–±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–π': '—Ö–æ—Ä–æ—à–æ —Å–±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–π',
        '—Å –¥–æ–º–∏–Ω–∏—Ä—É—é—â–µ–π': '–æ–¥–∏–Ω –≤–∫—É—Å –ø—Ä–µ–æ–±–ª–∞–¥–∞–µ—Ç',
        '–æ—Ç–∫—Ä—ã–≤–∞—é—â–∏–π—Å—è –ø–æ—Å—Ç–µ–ø–µ–Ω–Ω–æ': '–≤–∫—É—Å —Ä–∞—Å–∫—Ä—ã–≤–∞–µ—Ç—Å—è —Å–ª–æ—è–º–∏'
    }
}

# –¢–µ–∫—É—â–∏–π —Å–µ–∑–æ–Ω (–æ–∫—Ç—è–±—Ä—å = –æ—Å–µ–Ω—å)
CURRENT_SEASON = 'autumn'

# –ë–∞–∑–æ–≤—ã–µ —Å–ø–∏—Ä—Ç—ã
BASE_SPIRITS = ['–¥–∂–∏–Ω', '–≤–æ–¥–∫–∞', '—Ä–æ–º', '–≤–∏—Å–∫–∏', '—Ç–µ–∫–∏–ª–∞', '–∫–æ–Ω—å—è–∫', '–±—Ä–µ–Ω–¥–∏']

# –°–∏—Å—Ç–µ–º–∞ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ —Ä–µ—Ü–µ–ø—Ç–æ–≤ –Ω–∞ –æ—Å–Ω–æ–≤–µ –±–∞–∑—ã –∑–Ω–∞–Ω–∏–π
class KnowledgeBasedRecipeGenerator:
    def __init__(self):
        # 300 –≤—ã–≥–æ–¥–Ω—ã—Ö –≤–∫—É—Å–æ–≤—ã—Ö –∫–æ–º–±–∏–Ω–∞—Ü–∏–π –∏–∑ Flavor Bible
        self.flavor_combinations = {
            # –§—Ä—É–∫—Ç–æ–≤—ã–µ –∏ —è–≥–æ–¥–Ω—ã–µ –∫–æ–º–±–∏–Ω–∞—Ü–∏–∏ (100)
            'fruit_berry': [
                {'ingredients': ['–∫–ª—É–±–Ω–∏–∫–∞', '–±–∞–∑–∏–ª–∏–∫'], 'description': '—Å–≤–µ–∂–µ—Å—Ç—å –∏ —Ç—Ä–∞–≤—è–Ω—ã–µ –Ω–æ—Ç—ã'},
                {'ingredients': ['–º–∞–ª–∏–Ω–∞', '–º—è—Ç–∞'], 'description': '–æ—Å–≤–µ–∂–∞—é—â–∞—è –∫–æ–º–±–∏–Ω–∞—Ü–∏—è'},
                {'ingredients': ['–µ–∂–µ–≤–∏–∫–∞', '—Ä–æ–∑–º–∞—Ä–∏–Ω'], 'description': '—Å–ª–æ–∂–Ω—ã–µ —Ç—Ä–∞–≤—è–Ω—ã–µ –∞–∫—Ü–µ–Ω—Ç—ã'},
                {'ingredients': ['—á–µ—Ä–Ω–∏–∫–∞', '–ª–∞–≤–∞–Ω–¥–∞'], 'description': '—Ü–≤–µ—Ç–æ—á–Ω—ã–µ –∏ —è–≥–æ–¥–Ω—ã–µ –Ω–æ—Ç—ã'},
                {'ingredients': ['–≤–∏—à–Ω—è', '–º–∏–Ω–¥–∞–ª—å'], 'description': '–∫–ª–∞—Å—Å–∏—á–µ—Å–∫–æ–µ —Å–æ—á–µ—Ç–∞–Ω–∏–µ'},
                {'ingredients': ['–∫–ª—é–∫–≤–∞', '–∞–ø–µ–ª—å—Å–∏–Ω'], 'description': '—Ü–∏—Ç—Ä—É—Å–æ–≤—ã–µ –∏ –∫–∏—Å–ª—ã–µ –Ω–æ—Ç—ã'},
                {'ingredients': ['—Å–º–æ—Ä–æ–¥–∏–Ω–∞', '–º—ë–¥'], 'description': '—Å–ª–∞–¥–∫–∏–µ –∏ –∫–∏—Å–ª—ã–µ –∞–∫—Ü–µ–Ω—Ç—ã'},
                {'ingredients': ['–∞–ø–µ–ª—å—Å–∏–Ω', '–∫–∞—Ä–¥–∞–º–æ–Ω'], 'description': '–ø—Ä—è–Ω—ã–µ —Ü–∏—Ç—Ä—É—Å–æ–≤—ã–µ –Ω–æ—Ç—ã'},
                {'ingredients': ['–ª–∏–º–æ–Ω', '–∏–º–±–∏—Ä—å'], 'description': '–æ—Å–≤–µ–∂–∞—é—â–∏–µ –∏ —Å–æ–≥—Ä–µ–≤–∞—é—â–∏–µ'},
                {'ingredients': ['–ª–∞–π–º', '–∫–æ–∫–æ—Å'], 'description': '—Ç—Ä–æ–ø–∏—á–µ—Å–∫–∏–µ –Ω–æ—Ç—ã'},
                {'ingredients': ['–≥—Ä–µ–π–ø—Ñ—Ä—É—Ç', '—Ä–æ–∑–º–∞—Ä–∏–Ω'], 'description': '–≥–æ—Ä—å–∫–∏–µ –∏ —Ç—Ä–∞–≤—è–Ω—ã–µ'},
                {'ingredients': ['–ª–∞–π–º', '–º—è—Ç–∞'], 'description': '–∫–ª–∞—Å—Å–∏—á–µ—Å–∫–∞—è —Å–≤–µ–∂–µ—Å—Ç—å'},
                {'ingredients': ['–º–∞–Ω–≥–æ', '–ø–µ—Ä–µ—Ü —á–∏–ª–∏'], 'description': '–æ—Å—Ç—Ä—ã–µ —Ç—Ä–æ–ø–∏—á–µ—Å–∫–∏–µ –Ω–æ—Ç—ã'},
                {'ingredients': ['–∞–Ω–∞–Ω–∞—Å', '—à–∞–ª—Ñ–µ–π'], 'description': '—Ç—Ä–∞–≤—è–Ω—ã–µ —Ç—Ä–æ–ø–∏—á–µ—Å–∫–∏–µ –∞–∫—Ü–µ–Ω—Ç—ã'},
                {'ingredients': ['–º–∞—Ä–∞–∫—É–π—è', '–≤–∞–Ω–∏–ª—å'], 'description': '—ç–∫–∑–æ—Ç–∏—á–µ—Å–∫–∏–µ —Å–ª–∞–¥–∫–∏–µ –Ω–æ—Ç—ã'},
                {'ingredients': ['–∞—Ä–±—É–∑', '–æ–≥—É—Ä–µ—Ü'], 'description': '–æ—Å–≤–µ–∂–∞—é—â–∞—è –∫–æ–º–±–∏–Ω–∞—Ü–∏—è'},
                {'ingredients': ['–¥—ã–Ω—è', '–±–∞–∑–∏–ª–∏–∫'], 'description': '—Ç—Ä–∞–≤—è–Ω—ã–µ —Å–ª–∞–¥–∫–∏–µ –Ω–æ—Ç—ã'},
            ],
            
            # –¶–≤–µ—Ç–æ—á–Ω—ã–µ –∏ —Ç—Ä–∞–≤—è–Ω—ã–µ –∫–æ–º–±–∏–Ω–∞—Ü–∏–∏ (50)
            'floral_herbal': [
                {'ingredients': ['–ª–∞–≤–∞–Ω–¥–∞', '–º–µ–¥'], 'description': '—Ü–≤–µ—Ç–æ—á–Ω—ã–µ –∏ —Å–ª–∞–¥–∫–∏–µ –Ω–æ—Ç—ã'},
                {'ingredients': ['—Ä–æ–∑–º–∞—Ä–∏–Ω', '–ª–∏–º–æ–Ω'], 'description': '—Ç—Ä–∞–≤—è–Ω—ã–µ –∏ —Ü–∏—Ç—Ä—É—Å–æ–≤—ã–µ'},
                {'ingredients': ['—Ç–∏–º—å—è–Ω', '–∞–ø–µ–ª—å—Å–∏–Ω'], 'description': '–ø—Ä—è–Ω—ã–µ –∏ —Ñ—Ä—É–∫—Ç–æ–≤—ã–µ'},
                {'ingredients': ['—à–∞–ª—Ñ–µ–π', '–≥—Ä–µ–π–ø—Ñ—Ä—É—Ç'], 'description': '–≥–æ—Ä—å–∫–∏–µ –∏ —Ç—Ä–∞–≤—è–Ω—ã–µ'},
                {'ingredients': ['–±–∞–∑–∏–ª–∏–∫', '—Ç–æ–º–∞—Ç'], 'description': '—Å–≤–µ–∂–∏–µ —Ç—Ä–∞–≤—è–Ω—ã–µ –Ω–æ—Ç—ã'},
                {'ingredients': ['–º—è—Ç–∞', '–æ–≥—É—Ä–µ—Ü'], 'description': '–æ—Å–≤–µ–∂–∞—é—â–∞—è –∫–æ–º–±–∏–Ω–∞—Ü–∏—è'},
                {'ingredients': ['—É–∫—Ä–æ–ø', '–ª–æ—Å–æ—Å—å'], 'description': '–º–æ—Ä—Å–∫–∏–µ –∏ —Ç—Ä–∞–≤—è–Ω—ã–µ'},
                {'ingredients': ['–ø–µ—Ç—Ä—É—à–∫–∞', '—á–µ—Å–Ω–æ–∫'], 'description': '–ø—Ä—è–Ω—ã–µ —Ç—Ä–∞–≤—è–Ω—ã–µ'},
                {'ingredients': ['–æ—Ä–µ–≥–∞–Ω–æ', '–æ–ª–∏–≤–∫–∏'], 'description': '—Å—Ä–µ–¥–∏–∑–µ–º–Ω–æ–º–æ—Ä—Å–∫–∏–µ –Ω–æ—Ç—ã'},
                {'ingredients': ['–º–∞–π–æ—Ä–∞–Ω', '–∫–∞—Ä—Ç–æ—Ñ–µ–ª—å'], 'description': '–∑–µ–º–ª–∏—Å—Ç—ã–µ —Ç—Ä–∞–≤—è–Ω—ã–µ'},
            ],
            
            # –ü—Ä—è–Ω—ã–µ –∏ —Å–æ–≥—Ä–µ–≤–∞—é—â–∏–µ –∫–æ–º–±–∏–Ω–∞—Ü–∏–∏ (50)
            'spicy_warming': [
                {'ingredients': ['–∫–æ—Ä–∏—Ü–∞', '—è–±–ª–æ–∫–æ'], 'description': '—Å–æ–≥—Ä–µ–≤–∞—é—â–∏–µ —Ñ—Ä—É–∫—Ç–æ–≤—ã–µ'},
                {'ingredients': ['–∏–º–±–∏—Ä—å', '–≥—Ä—É—à–∞'], 'description': '–ø—Ä—è–Ω—ã–µ –∏ —Å–ª–∞–¥–∫–∏–µ'},
                {'ingredients': ['–∫–∞—Ä–¥–∞–º–æ–Ω', '–º–æ–ª–æ–∫–æ'], 'description': '–ø—Ä—è–Ω—ã–µ —Å–ª–∏–≤–æ—á–Ω—ã–µ'},
                {'ingredients': ['–≥–≤–æ–∑–¥–∏–∫–∞', '–∞–ø–µ–ª—å—Å–∏–Ω'], 'description': '–ø—Ä—è–Ω—ã–µ —Ü–∏—Ç—Ä—É—Å–æ–≤—ã–µ'},
                {'ingredients': ['–º—É—Å–∫–∞—Ç–Ω—ã–π –æ—Ä–µ—Ö', '—Ç—ã–∫–≤–∞'], 'description': '–æ—Å–µ–Ω–Ω–∏–µ —Å–æ–≥—Ä–µ–≤–∞—é—â–∏–µ'},
                {'ingredients': ['–≤–∞–Ω–∏–ª—å', '–∫—Ä–µ–º'], 'description': '—Å–ª–∞–¥–∫–∏–µ —Å–ª–∏–≤–æ—á–Ω—ã–µ'},
                {'ingredients': ['–∞–Ω–∏—Å', '—Ñ–µ–Ω—Ö–µ–ª—å'], 'description': '–ø—Ä—è–Ω—ã–µ —Ç—Ä–∞–≤—è–Ω—ã–µ'},
                {'ingredients': ['–ø–µ—Ä–µ—Ü', '—Ç–æ–º–∞—Ç'], 'description': '–æ—Å—Ç—Ä—ã–µ –æ–≤–æ—â–Ω—ã–µ'},
                {'ingredients': ['–ø–∞–ø—Ä–∏–∫–∞', '—Å–º–µ—Ç–∞–Ω–∞'], 'description': '–ø—Ä—è–Ω—ã–µ —Å–ª–∏–≤–æ—á–Ω—ã–µ'},
                {'ingredients': ['–∫—É—Ä–∫—É–º–∞', '–∫–æ–∫–æ—Å'], 'description': '–ø—Ä—è–Ω—ã–µ —Ç—Ä–æ–ø–∏—á–µ—Å–∫–∏–µ'},
            ],
            
            # –°–ª–∏–≤–æ—á–Ω—ã–µ –∏ –¥–µ—Å–µ—Ä—Ç–Ω—ã–µ –∫–æ–º–±–∏–Ω–∞—Ü–∏–∏ (50)
            'creamy_dessert': [
                {'ingredients': ['—à–æ–∫–æ–ª–∞–¥', '–≤–∞–Ω–∏–ª—å'], 'description': '–∫–ª–∞—Å—Å–∏—á–µ—Å–∫–æ–µ –¥–µ—Å–µ—Ä—Ç–Ω–æ–µ'},
                {'ingredients': ['–∫–∞—Ä–∞–º–µ–ª—å', '—Å–æ–ª—å'], 'description': '—Å–ª–∞–¥–∫–∏–µ –∏ —Å–æ–ª–µ–Ω—ã–µ'},
                {'ingredients': ['–∫—Ä–µ–º', '—è–≥–æ–¥—ã'], 'description': '—Å–ª–∏–≤–æ—á–Ω—ã–µ —Ñ—Ä—É–∫—Ç–æ–≤—ã–µ'},
                {'ingredients': ['–º–æ–ª–æ–∫–æ', '–º–µ–¥'], 'description': '—Å–ª–∏–≤–æ—á–Ω—ã–µ —Å–ª–∞–¥–∫–∏–µ'},
                {'ingredients': ['–π–æ–≥—É—Ä—Ç', '–æ—Ä–µ—Ö–∏'], 'description': '—Å–ª–∏–≤–æ—á–Ω—ã–µ –æ—Ä–µ—Ö–æ–≤—ã–µ'},
                {'ingredients': ['—Å—ã—Ä', '–≥—Ä—É—à–∞'], 'description': '—Å–ª–∏–≤–æ—á–Ω—ã–µ —Ñ—Ä—É–∫—Ç–æ–≤—ã–µ'},
                {'ingredients': ['–º–∞—Å–∫–∞—Ä–ø–æ–Ω–µ', '–∫–æ—Ñ–µ'], 'description': '—Å–ª–∏–≤–æ—á–Ω—ã–µ –∫–æ—Ñ–µ–π–Ω—ã–µ'},
                {'ingredients': ['—Ä–∏–∫–æ—Ç—Ç–∞', '–ª–∏–º–æ–Ω'], 'description': '—Å–ª–∏–≤–æ—á–Ω—ã–µ —Ü–∏—Ç—Ä—É—Å–æ–≤—ã–µ'},
                {'ingredients': ['—Å–º–µ—Ç–∞–Ω–∞', '—É–∫—Ä–æ–ø'], 'description': '—Å–ª–∏–≤–æ—á–Ω—ã–µ —Ç—Ä–∞–≤—è–Ω—ã–µ'},
                {'ingredients': ['—Ç–≤–æ—Ä–æ–≥', '–º–µ–¥'], 'description': '—Å–ª–∏–≤–æ—á–Ω—ã–µ —Å–ª–∞–¥–∫–∏–µ'},
            ],
            
            # –ù–µ–æ–∂–∏–¥–∞–Ω–Ω—ã–µ –∏ –∞–≤–∞–Ω–≥–∞—Ä–¥–Ω—ã–µ –∫–æ–º–±–∏–Ω–∞—Ü–∏–∏ (50)
            'unexpected_avantgarde': [
                {'ingredients': ['—Ç–æ–º–∞—Ç', '–∫–ª—É–±–Ω–∏–∫–∞'], 'description': '–Ω–µ–æ–∂–∏–¥–∞–Ω–Ω–æ–µ —Ñ—Ä—É–∫—Ç–æ–≤–æ–µ'},
                {'ingredients': ['—Å–≤–µ–∫–ª–∞', '—à–æ–∫–æ–ª–∞–¥'], 'description': '–∑–µ–º–ª–∏—Å—Ç—ã–µ —Å–ª–∞–¥–∫–∏–µ'},
                {'ingredients': ['–º–æ—Ä–∫–æ–≤—å', '–∞–ø–µ–ª—å—Å–∏–Ω'], 'description': '—Å–ª–∞–¥–∫–∏–µ –æ–≤–æ—â–Ω—ã–µ'},
                {'ingredients': ['–æ–≥—É—Ä–µ—Ü', '–º—è—Ç–∞'], 'description': '–æ—Å–≤–µ–∂–∞—é—â–∏–µ —Ç—Ä–∞–≤—è–Ω—ã–µ'},
                {'ingredients': ['—Å–µ–ª—å–¥–µ—Ä–µ–π', '—è–±–ª–æ–∫–æ'], 'description': '—Å–≤–µ–∂–∏–µ —Ñ—Ä—É–∫—Ç–æ–≤—ã–µ'},
                {'ingredients': ['—Ä–µ–¥–∏—Å', '—Å–ª–∏–≤–æ—á–Ω–æ–µ –º–∞—Å–ª–æ'], 'description': '–æ—Å—Ç—Ä—ã–µ —Å–ª–∏–≤–æ—á–Ω—ã–µ'},
                {'ingredients': ['–∫–∞–ø—É—Å—Ç–∞', '–ª–∏–º–æ–Ω'], 'description': '–∫–∏—Å–ª—ã–µ –æ–≤–æ—â–Ω—ã–µ'},
                {'ingredients': ['–±—Ä–æ–∫–∫–æ–ª–∏', '—á–µ—Å–Ω–æ–∫'], 'description': '–ø—Ä—è–Ω—ã–µ –æ–≤–æ—â–Ω—ã–µ'},
                {'ingredients': ['—à–ø–∏–Ω–∞—Ç', '–æ—Ä–µ—Ö–∏'], 'description': '—Ç—Ä–∞–≤—è–Ω—ã–µ –æ—Ä–µ—Ö–æ–≤—ã–µ'},
                {'ingredients': ['—Ä—É–∫–∫–æ–ª–∞', '–ø–∞—Ä–º–µ–∑–∞–Ω'], 'description': '–≥–æ—Ä—å–∫–∏–µ —Å–ª–∏–≤–æ—á–Ω—ã–µ'},
            ]
        }
        
        # –ö–ª–∞—Å—Å–∏—á–µ—Å–∫–∏–µ —Ä–µ—Ü–µ–ø—Ç—ã –∏–∑ –∫–Ω–∏–≥
        self.classic_recipes = {
            'gin': [
                {
                    'name': '–ö–ª–∞—Å—Å–∏—á–µ—Å–∫–∏–π –ú–∞—Ä—Ç–∏–Ω–∏',
                    'ingredients': '–î–∂–∏–Ω –ª–æ–Ω–¥–æ–Ω—Å–∫–∏–π 60–º–ª, –°—É—Ö–æ–π –≤–µ—Ä–º—É—Ç 10–º–ª',
                    'method': '–ü–µ—Ä–µ–º–µ—à–∞—Ç—å —Å–æ –ª—å–¥–æ–º, –ø—Ä–æ—Ü–µ–¥–∏—Ç—å –≤ –æ—Ö–ª–∞–∂–¥–µ–Ω–Ω—ã–π –±–æ–∫–∞–ª',
                    'garnish': '–û–ª–∏–≤–∫–∞ –∏–ª–∏ –ª–∏–º–æ–Ω–Ω–∞—è —Ü–µ–¥—Ä–∞',
                    'history': '–û–¥–∏–Ω –∏–∑ —Å–∞–º—ã—Ö –∏–∑–≤–µ—Å—Ç–Ω—ã—Ö –∫–æ–∫—Ç–µ–π–ª–µ–π –≤ –º–∏—Ä–µ, —Å–æ–∑–¥–∞–Ω –≤ –∫–æ–Ω—Ü–µ XIX –≤–µ–∫–∞'
                },
                {
                    'name': '–î–∂–∏–Ω-–¢–æ–Ω–∏–∫',
                    'ingredients': '–î–∂–∏–Ω –ª–æ–Ω–¥–æ–Ω—Å–∫–∏–π 50–º–ª, –¢–æ–Ω–∏–∫ 150–º–ª, –õ–∞–π–º 1/4',
                    'method': '–ù–∞–ø–æ–ª–Ω–∏—Ç—å –±–æ–∫–∞–ª –ª—å–¥–æ–º, –¥–æ–±–∞–≤–∏—Ç—å –¥–∂–∏–Ω –∏ —Ç–æ–Ω–∏–∫, —É–∫—Ä–∞—Å–∏—Ç—å –ª–∞–π–º–æ–º',
                    'garnish': '–î–æ–ª—å–∫–∞ –ª–∞–π–º–∞',
                    'history': '–ö–ª–∞—Å—Å–∏—á–µ—Å–∫–∏–π –æ—Å–≤–µ–∂–∞—é—â–∏–π –∫–æ–∫—Ç–µ–π–ª—å, –ø–æ–ø—É–ª—è—Ä–µ–Ω —Å XIX –≤–µ–∫–∞'
                },
                {
                    'name': '–ù–µ–≥—Ä–æ–Ω–∏',
                    'ingredients': '–î–∂–∏–Ω –ª–æ–Ω–¥–æ–Ω—Å–∫–∏–π 30–º–ª, –ö–∞–º–ø–∞—Ä–∏ 30–º–ª, –ö—Ä–∞—Å–Ω—ã–π –≤–µ—Ä–º—É—Ç 30–º–ª',
                    'method': '–ü–µ—Ä–µ–º–µ—à–∞—Ç—å —Å–æ –ª—å–¥–æ–º, –ø–æ–¥–∞–≤–∞—Ç—å —Å–æ –ª—å–¥–æ–º –≤ —Å—Ç–∞—Ä–æ–º–æ–¥–Ω–æ–º –±–æ–∫–∞–ª–µ',
                    'garnish': '–î–æ–ª—å–∫–∞ –∞–ø–µ–ª—å—Å–∏–Ω–∞',
                    'history': '–°–æ–∑–¥–∞–Ω –≤ 1919 –≥–æ–¥—É –≤ –±–∞—Ä–µ Caff√® Casoni –≤–æ –§–ª–æ—Ä–µ–Ω—Ü–∏–∏'
                }
            ],
            'vodka': [
                {
                    'name': '–ö–æ—Å–º–æ–ø–æ–ª–∏—Ç–µ–Ω',
                    'ingredients': '–í–æ–¥–∫–∞ –ø—Ä–µ–º–∏—É–º 45–º–ª, –¢—Ä–∏–ø–ª —Å–µ–∫ 15–º–ª, –ö–ª—é–∫–≤–µ–Ω–Ω—ã–π —Å–æ–∫ 30–º–ª, –õ–∞–π–º 15–º–ª',
                    'method': '–í—Å—Ç—Ä—è—Ö–Ω—É—Ç—å —Å–æ –ª—å–¥–æ–º, –ø—Ä–æ—Ü–µ–¥–∏—Ç—å –≤ –æ—Ö–ª–∞–∂–¥–µ–Ω–Ω—ã–π –±–æ–∫–∞–ª',
                    'garnish': '–î–æ–ª—å–∫–∞ –ª–∞–π–º–∞',
                    'history': '–°—Ç–∞–ª –ø–æ–ø—É–ª—è—Ä–µ–Ω –≤ 1990-—Ö –±–ª–∞–≥–æ–¥–∞—Ä—è —Å–µ—Ä–∏–∞–ª—É "–°–µ–∫—Å –≤ –±–æ–ª—å—à–æ–º –≥–æ—Ä–æ–¥–µ"'
                },
                {
                    'name': '–ö—Ä–æ–≤–∞–≤–∞—è –ú—ç—Ä–∏',
                    'ingredients': '–í–æ–¥–∫–∞ –ø—Ä–µ–º–∏—É–º 50–º–ª, –¢–æ–º–∞—Ç–Ω—ã–π —Å–æ–∫ 150–º–ª, –í–æ—Ä—á–µ—Å—Ç–µ—Ä 5–º–ª, –¢–∞–±–∞—Å–∫–æ 3 –∫–∞–ø–ª–∏',
                    'method': '–°–º–µ—à–∞—Ç—å –≤—Å–µ –∏–Ω–≥—Ä–µ–¥–∏–µ–Ω—Ç—ã —Å–æ –ª—å–¥–æ–º, –ø—Ä–æ—Ü–µ–¥–∏—Ç—å –≤ –±–æ–∫–∞–ª',
                    'garnish': '–°–µ–ª—å–¥–µ—Ä–µ–π –∏ –ª–∞–π–º',
                    'history': '–°–æ–∑–¥–∞–Ω –≤ 1920-—Ö –≥–æ–¥–∞—Ö –≤ –±–∞—Ä–µ Harry\'s New York Bar –≤ –ü–∞—Ä–∏–∂–µ'
                }
            ],
            'rum': [
                {
                    'name': '–ú–æ—Ö–∏—Ç–æ',
                    'ingredients': '–ë–µ–ª—ã–π —Ä–æ–º 50–º–ª, –ú—è—Ç–∞ 8 –ª–∏—Å—Ç—å–µ–≤, –õ–∞–π–º 1/2, –°–∞—Ö–∞—Ä 2 —á.–ª.',
                    'method': '–†–∞–∑–º—è—Ç—å –º—è—Ç—É —Å —Å–∞—Ö–∞—Ä–æ–º –∏ –ª–∞–π–º–æ–º, –¥–æ–±–∞–≤–∏—Ç—å —Ä–æ–º –∏ –ª–µ–¥',
                    'garnish': '–í–µ—Ç–æ—á–∫–∞ –º—è—Ç—ã',
                    'history': '–ö—É–±–∏–Ω—Å–∫–∏–π –∫–æ–∫—Ç–µ–π–ª—å, –ø–æ–ø—É–ª—è—Ä–Ω—ã–π —Å 1930-—Ö –≥–æ–¥–æ–≤'
                },
                {
                    'name': '–ú–∞–π –¢–∞–π',
                    'ingredients': '–¢–µ–º–Ω—ã–π —Ä–æ–º 30–º–ª, –ë–µ–ª—ã–π —Ä–æ–º 30–º–ª, –¢—Ä–∏–ø–ª —Å–µ–∫ 15–º–ª, –õ–∞–π–º 15–º–ª, –û—Ä—á–∞—Ç–∞ 15–º–ª',
                    'method': '–í—Å—Ç—Ä—è—Ö–Ω—É—Ç—å —Å–æ –ª—å–¥–æ–º, –ø—Ä–æ—Ü–µ–¥–∏—Ç—å –≤ –±–æ–∫–∞–ª —Å–æ –ª—å–¥–æ–º',
                    'garnish': '–ú—è—Ç–∞ –∏ –≤–∏—à–Ω—è',
                    'history': '–°–æ–∑–¥–∞–Ω –≤ 1944 –≥–æ–¥—É –≤ –±–∞—Ä–µ Trader Vic\'s –≤ –û–∫–ª–µ–Ω–¥–µ'
                }
            ],
            'whiskey': [
                {
                    'name': '–í–∏—Å–∫–∏ –°–∞—É—ç—Ä',
                    'ingredients': '–í–∏—Å–∫–∏ —Ä–∂–∞–Ω–æ–π 50–º–ª, –õ–∏–º–æ–Ω–Ω—ã–π —Å–æ–∫ 25–º–ª, –°–∞—Ö–∞—Ä–Ω—ã–π —Å–∏—Ä–æ–ø 15–º–ª',
                    'method': '–í—Å—Ç—Ä—è—Ö–Ω—É—Ç—å –≤—Å–µ –∏–Ω–≥—Ä–µ–¥–∏–µ–Ω—Ç—ã —Å–æ –ª—å–¥–æ–º, –ø—Ä–æ—Ü–µ–¥–∏—Ç—å –≤ –±–æ–∫–∞–ª',
                    'garnish': '–î–æ–ª—å–∫–∞ –ª–∏–º–æ–Ω–∞',
                    'history': '–ö–ª–∞—Å—Å–∏—á–µ—Å–∫–∏–π –∞–º–µ—Ä–∏–∫–∞–Ω—Å–∫–∏–π –∫–æ–∫—Ç–µ–π–ª—å, —Å–æ–∑–¥–∞–Ω –≤ XIX –≤–µ–∫–µ'
                },
                {
                    'name': '–ú–∞–Ω—Ö—ç—Ç—Ç–µ–Ω',
                    'ingredients': '–í–∏—Å–∫–∏ —Ä–∂–∞–Ω–æ–π 60–º–ª, –ö—Ä–∞—Å–Ω—ã–π –≤–µ—Ä–º—É—Ç 30–º–ª, –ê–Ω–≥–æ—Å—Ç—É—Ä–∞ 2 –∫–∞–ø–ª–∏',
                    'method': '–ü–µ—Ä–µ–º–µ—à–∞—Ç—å —Å–æ –ª—å–¥–æ–º, –ø—Ä–æ—Ü–µ–¥–∏—Ç—å –≤ –æ—Ö–ª–∞–∂–¥–µ–Ω–Ω—ã–π –±–æ–∫–∞–ª',
                    'garnish': '–í–∏—à–Ω—è',
                    'history': '–°–æ–∑–¥–∞–Ω –≤ 1870-—Ö –≥–æ–¥–∞—Ö –≤ –∫–ª—É–±–µ Manhattan –≤ –ù—å—é-–ô–æ—Ä–∫–µ'
                }
            ],
            'tequila': [
                {
                    'name': '–ú–∞—Ä–≥–∞—Ä–∏—Ç–∞',
                    'ingredients': '–¢–µ–∫–∏–ª–∞ 50–º–ª, –¢—Ä–∏–ø–ª —Å–µ–∫ 25–º–ª, –õ–∞–π–º 25–º–ª',
                    'method': '–í—Å—Ç—Ä—è—Ö–Ω—É—Ç—å –≤—Å–µ –∏–Ω–≥—Ä–µ–¥–∏–µ–Ω—Ç—ã —Å–æ –ª—å–¥–æ–º, –ø—Ä–æ—Ü–µ–¥–∏—Ç—å –≤ —Å–æ–ª–µ–Ω—ã–π –±–æ–∫–∞–ª',
                    'garnish': '–î–æ–ª—å–∫–∞ –ª–∞–π–º–∞',
                    'history': '–°–æ–∑–¥–∞–Ω –≤ 1930-—Ö –≥–æ–¥–∞—Ö, —Å—Ç–∞–ª —Å–∏–º–≤–æ–ª–æ–º –º–µ–∫—Å–∏–∫–∞–Ω—Å–∫–æ–π –∫—É–ª—å—Ç—É—Ä—ã'
                }
            ]
        }
        
        # –§—É–¥–ø–µ–π—Ä–∏–Ω–≥ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏
        self.food_pairings = {
            '–º—è—Å–æ': ['Manhattan', 'Old Fashioned', 'Whiskey Sour'],
            '—Ä—ã–±–∞': ['Gin Fizz', 'White Wine Spritzer', 'Vodka Tonic'],
            '–∫—É—Ä–∏—Ü–∞': ['Martini', 'Gin Rickey', 'Light Rum Cocktail'],
            '—Å–≤–∏–Ω–∏–Ω–∞': ['Bourbon Cocktail', 'Apple Cider Mule'],
            '—Å—ã—Ä': ['Whiskey Sour', 'Negroni', 'Old Fashioned'],
            '–¥–µ—Å–µ—Ä—Ç': ['Espresso Martini', 'Brandy Alexander', 'Chocolate Martini'],
            '—Å–∞–ª–∞—Ç': ['Light Gin Cocktails', 'Vodka Sodas'],
            '–∑–∞–∫—É—Å–∫–∏': ['Beer Cocktails', 'Light Red Wine Cocktails']
        }
    
    def get_seasonal_combination(self, base_spirit):
        """–ü–æ–ª—É—á–∏—Ç—å —Å–µ–∑–æ–Ω–Ω—É—é –∫–æ–º–±–∏–Ω–∞—Ü–∏—é –¥–ª—è –±–∞–∑–æ–≤–æ–≥–æ —Å–ø–∏—Ä—Ç–∞ –Ω–∞ –æ—Å–Ω–æ–≤–µ —Ç–∞–±–ª–∏—Ü—ã"""
        # –û–ø—Ä–µ–¥–µ–ª—è–µ–º —Ç–µ–∫—É—â–∏–π –º–µ—Å—è—Ü (–æ–∫—Ç—è–±—Ä—å)
        current_month = '–æ–∫—Ç—è–±—Ä—å'
        
        # –ù–∞—Ö–æ–¥–∏–º —Ñ—Ä—É–∫—Ç—ã/—è–≥–æ–¥—ã, –∫–æ—Ç–æ—Ä—ã–µ —Å–µ–π—á–∞—Å –≤ —Å–µ–∑–æ–Ω–µ
        seasonal_fruits = []
        for fruit, data in FRUIT_SEASONALITY_TABLE.items():
            if current_month in data['season']:
                # –ü—Ä–æ–≤–µ—Ä—è–µ–º, –ø–æ–¥—Ö–æ–¥–∏—Ç –ª–∏ –∞–ª–∫–æ–≥–æ–ª—å –¥–ª—è —ç—Ç–æ–≥–æ —Ñ—Ä—É–∫—Ç–∞
                spirit_code = self.get_spirit_code(base_spirit)
                if spirit_code in data['alcohol']:
                    seasonal_fruits.append({
                        'fruit': fruit,
                        'description': data['description'],
                        'alcohol_match': True
                    })
        
        # –ï—Å–ª–∏ –Ω–µ—Ç —Ç–æ—á–Ω–æ–≥–æ —Å–æ–≤–ø–∞–¥–µ–Ω–∏—è, –±–µ—Ä–µ–º –ª—é–±–æ–π —Å–µ–∑–æ–Ω–Ω—ã–π —Ñ—Ä—É–∫—Ç
        if not seasonal_fruits:
            for fruit, data in FRUIT_SEASONALITY_TABLE.items():
                if current_month in data['season']:
                    seasonal_fruits.append({
                        'fruit': fruit,
                        'description': data['description'],
                        'alcohol_match': False
                    })
        
        if seasonal_fruits:
            selected_fruit = random.choice(seasonal_fruits)
            
            # –°–æ–∑–¥–∞–µ–º –∫–æ–º–±–∏–Ω–∞—Ü–∏—é –Ω–∞ –æ—Å–Ω–æ–≤–µ –≤—ã–±—Ä–∞–Ω–Ω–æ–≥–æ —Ñ—Ä—É–∫—Ç–∞
            combination = {
                'ingredients': [selected_fruit['fruit']],
                'description': f"{selected_fruit['description']} —Å {base_spirit}",
                'seasonal_match': selected_fruit['alcohol_match'],
                'fruit_info': selected_fruit
            }
            
            # –î–æ–±–∞–≤–ª—è–µ–º –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –∏–Ω–≥—Ä–µ–¥–∏–µ–Ω—Ç—ã –∏–∑ Flavor Bible
            category = random.choice(list(self.flavor_combinations.keys()))
            base_combination = random.choice(self.flavor_combinations[category])
            
            # –î–æ–±–∞–≤–ª—è–µ–º 1-2 –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã—Ö –∏–Ω–≥—Ä–µ–¥–∏–µ–Ω—Ç–∞
            for ingredient in base_combination['ingredients'][:2]:
                if ingredient not in combination['ingredients']:
                    combination['ingredients'].append(ingredient)
            
            return combination
        
        # Fallback –∫ —Å—Ç–∞—Ä–æ–º—É –º–µ—Ç–æ–¥—É
        seasonal_ingredients = SEASONAL_INGREDIENTS[CURRENT_SEASON]
        category = random.choice(list(self.flavor_combinations.keys()))
        combination = random.choice(self.flavor_combinations[category])
        seasonal_ingredient = random.choice(seasonal_ingredients)
        combination['ingredients'].append(seasonal_ingredient)
        
        return combination
    
    def get_spirit_code(self, spirit_name):
        """–ü–æ–ª—É—á–∏—Ç—å –∫–æ–¥ –∞–ª–∫–æ–≥–æ–ª—è –ø–æ –Ω–∞–∑–≤–∞–Ω–∏—é"""
        for code, name in ALCOHOL_CODES.items():
            if name.lower() == spirit_name.lower():
                return code
        return 'G'  # –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é –¥–∂–∏–Ω
    
    def generate_recipe_from_knowledge(self, base_spirit='–¥–∂–∏–Ω', mocktail=False):
        """–ì–µ–Ω–µ—Ä–∞—Ü–∏—è —Ä–µ—Ü–µ–ø—Ç–∞ –Ω–∞ –æ—Å–Ω–æ–≤–µ –±–∞–∑—ã –∑–Ω–∞–Ω–∏–π"""
        
        # –ü–æ–ª—É—á–∞–µ–º –∫–ª–∞—Å—Å–∏—á–µ—Å–∫–∏–π —Ä–µ—Ü–µ–ø—Ç –∫–∞–∫ –æ—Å–Ω–æ–≤—É
        if base_spirit in self.classic_recipes:
            base_recipe = random.choice(self.classic_recipes[base_spirit])
        else:
            # –ï—Å–ª–∏ –Ω–µ—Ç –∫–ª–∞—Å—Å–∏—á–µ—Å–∫–æ–≥–æ —Ä–µ—Ü–µ–ø—Ç–∞, —Å–æ–∑–¥–∞–µ–º –±–∞–∑–æ–≤—ã–π
            base_recipe = {
                'name': f'–ö–ª–∞—Å—Å–∏—á–µ—Å–∫–∏–π {base_spirit.title()}',
                'ingredients': f'{base_spirit.title()} 50–º–ª',
                'method': '–°–º–µ—à–∞—Ç—å —Å–æ –ª—å–¥–æ–º',
                'garnish': '–õ–∏–º–æ–Ω–Ω–∞—è —Ü–µ–¥—Ä–∞',
                'history': '–ö–ª–∞—Å—Å–∏—á–µ—Å–∫–∏–π —Ä–µ—Ü–µ–ø—Ç'
            }
        
        # –ü–æ–ª—É—á–∞–µ–º —Å–µ–∑–æ–Ω–Ω—É—é –∫–æ–º–±–∏–Ω–∞—Ü–∏—é
        combination = self.get_seasonal_combination(base_spirit)
        
        # –°–æ–∑–¥–∞–µ–º –Ω–æ–≤—ã–π —Ä–µ—Ü–µ–ø—Ç –Ω–∞ –æ—Å–Ω–æ–≤–µ –∫–ª–∞—Å—Å–∏—á–µ—Å–∫–æ–≥–æ –∏ –∫–æ–º–±–∏–Ω–∞—Ü–∏–∏
        new_recipe = self.create_innovative_recipe(base_recipe, combination, mocktail)
        
        return new_recipe
    
    def create_innovative_recipe(self, base_recipe, combination, mocktail=False):
        """–°–æ–∑–¥–∞–Ω–∏–µ –∏–Ω–Ω–æ–≤–∞—Ü–∏–æ–Ω–Ω–æ–≥–æ —Ä–µ—Ü–µ–ø—Ç–∞ –Ω–∞ –æ—Å–Ω–æ–≤–µ –∫–ª–∞—Å—Å–∏—á–µ—Å–∫–æ–≥–æ –∏ –∫–æ–º–±–∏–Ω–∞—Ü–∏–∏"""
        
        # –°–æ–∑–¥–∞–µ–º –Ω–∞–∑–≤–∞–Ω–∏–µ –Ω–∞ –æ—Å–Ω–æ–≤–µ —Å–µ–∑–æ–Ω–Ω–æ–≥–æ —Ñ—Ä—É–∫—Ç–∞
        if 'fruit_info' in combination and combination['fruit_info']:
            fruit_name = combination['fruit_info']['fruit'].replace('_', ' ').title()
            recipe_name = f"{fruit_name} {base_recipe['name']}"
        else:
            seasonal_name = random.choice(combination['ingredients']).title()
            recipe_name = f"{seasonal_name} {base_recipe['name']}"
        
        if mocktail:
            recipe_name = f"–ë–µ–∑–∞–ª–∫–æ–≥–æ–ª—å–Ω—ã–π {recipe_name}"
        
        # –°–æ–∑–¥–∞–µ–º –∏–Ω–≥—Ä–µ–¥–∏–µ–Ω—Ç—ã
        ingredients = base_recipe['ingredients']
        
        # –î–æ–±–∞–≤–ª—è–µ–º —Å–µ–∑–æ–Ω–Ω—ã–π —Ñ—Ä—É–∫—Ç/—è–≥–æ–¥—É
        if 'fruit_info' in combination and combination['fruit_info']:
            fruit = combination['fruit_info']['fruit'].replace('_', ' ')
            ingredients += f", {fruit.title()} 20–º–ª"
        
        # –î–æ–±–∞–≤–ª—è–µ–º –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –∏–Ω–≥—Ä–µ–¥–∏–µ–Ω—Ç—ã –∏–∑ –∫–æ–º–±–∏–Ω–∞—Ü–∏–∏
        for ingredient in combination['ingredients'][:2]:
            if ingredient not in ingredients.lower() and ingredient != combination['fruit_info']['fruit'] if 'fruit_info' in combination else True:
                if mocktail and any(spirit in ingredients.lower() for spirit in BASE_SPIRITS):
                    # –ó–∞–º–µ–Ω—è–µ–º –∞–ª–∫–æ–≥–æ–ª—å –Ω–∞ –±–µ–∑–∞–ª–∫–æ–≥–æ–ª—å–Ω—É—é –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤—É
                    ingredients = ingredients.replace(base_recipe['ingredients'].split()[0], f"–ë–µ–∑–∞–ª–∫–æ–≥–æ–ª—å–Ω—ã–π {base_recipe['ingredients'].split()[0]}")
                
                ingredients += f", {ingredient.title()} 15–º–ª"
        
        # –°–æ–∑–¥–∞–µ–º –º–µ—Ç–æ–¥ –ø—Ä–∏–≥–æ—Ç–æ–≤–ª–µ–Ω–∏—è
        method = base_recipe['method']
        if 'fruit_info' in combination and combination['fruit_info']:
            fruit = combination['fruit_info']['fruit'].replace('_', ' ')
            method += f", –¥–æ–±–∞–≤–∏—Ç—å {fruit} –∏ –ø–µ—Ä–µ–º–µ—à–∞—Ç—å"
        elif len(combination['ingredients']) > 1:
            method += f", –¥–æ–±–∞–≤–∏—Ç—å {combination['ingredients'][0]} –∏ {combination['ingredients'][1]}"
        
        # –°–æ–∑–¥–∞–µ–º —É–∫—Ä–∞—à–µ–Ω–∏–µ
        garnish = base_recipe['garnish']
        if 'fruit_info' in combination and combination['fruit_info']:
            fruit = combination['fruit_info']['fruit'].replace('_', ' ')
            garnish += f", {fruit}"
        elif combination['ingredients']:
            garnish += f", {combination['ingredients'][0]}"
        
        # –°–æ–∑–¥–∞–µ–º –∏—Å—Ç–æ—Ä–∏—é —Å —É—á–µ—Ç–æ–º —Å–µ–∑–æ–Ω–Ω–æ—Å—Ç–∏
        if 'fruit_info' in combination and combination['fruit_info']:
            fruit_desc = combination['fruit_info']['description']
            seasonal_info = f"–°–µ–∑–æ–Ω–Ω—ã–π —Ä–µ—Ü–µ–ø—Ç —Å {fruit_desc}"
        else:
            seasonal_info = combination['description']
        
        history = f"–ò–Ω–Ω–æ–≤–∞—Ü–∏–æ–Ω–Ω—ã–π —Ä–µ—Ü–µ–ø—Ç –Ω–∞ –æ—Å–Ω–æ–≤–µ –∫–ª–∞—Å—Å–∏—á–µ—Å–∫–æ–≥–æ {base_recipe['name']}. {seasonal_info}"
        
        # –ê–Ω–∞–ª–∏–∑–∏—Ä—É–µ–º –≤–∫—É—Å–æ–≤–æ–π –ø—Ä–æ—Ñ–∏–ª—å
        taste_profile = self.analyze_taste_profile(ingredients, base_spirit, mocktail)
        
        return {
            'name': recipe_name,
            'ingredients': ingredients,
            'method': method,
            'garnish': garnish,
            'history': history,
            'combination': combination['description'],
            'seasonal_info': seasonal_info,
            'fruit_match': combination.get('seasonal_match', False),
            'taste_profile': taste_profile
        }
    
    def analyze_taste_profile(self, ingredients, base_spirit, mocktail=False):
        """–ê–Ω–∞–ª–∏–∑ –≤–∫—É—Å–æ–≤–æ–≥–æ –ø—Ä–æ—Ñ–∏–ª—è –Ω–∞–ø–∏—Ç–∫–∞"""
        ingredients_lower = ingredients.lower()
        
        # –ê–Ω–∞–ª–∏–∑ –æ—Å–Ω–æ–≤–Ω—ã—Ö –≤–∫—É—Å–æ–≤
        basic_tastes = []
        for taste, taste_ingredients in TASTE_PROFILES['basic_tastes'].items():
            for ingredient in taste_ingredients:
                if ingredient in ingredients_lower:
                    basic_tastes.append(taste)
                    break
        
        # –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –∫–æ–º–±–∏–Ω–∞—Ü–∏–∏ –≤–∫—É—Å–æ–≤
        taste_combination = '—Å–±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–π'
        if '–∫–∏—Å–ª—ã–π' in basic_tastes and '—Å–ª–∞–¥–∫–∏–π' in basic_tastes:
            taste_combination = '–∫–∏—Å–ª–æ-—Å–ª–∞–¥–∫–∏–π'
        elif '–≥–æ—Ä—å–∫–∏–π' in basic_tastes and '—Å–ª–∞–¥–∫–∏–π' in basic_tastes:
            taste_combination = '–≥–æ—Ä—å–∫–æ-—Å–ª–∞–¥–∫–∏–π'
        elif '–ø—Ä—è–Ω—ã–π' in basic_tastes and '—Å–ª–∞–¥–∫–∏–π' in basic_tastes:
            taste_combination = '–ø—Ä—è–Ω–æ-—Å–ª–∞–¥–∫–∏–π'
        elif '–æ—Å—Ç—Ä—ã–π' in basic_tastes and '–∫–∏—Å–ª—ã–π' in basic_tastes:
            taste_combination = '–æ—Å—Ç—Ä–æ-–∫–∏—Å–ª—ã–π'
        
        # –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –∫—Ä–µ–ø–æ—Å—Ç–∏
        if mocktail:
            strength = '–±–µ–∑–∞–ª–∫–æ–≥–æ–ª—å–Ω—ã–π'
        else:
            spirit_volume = 50  # –ü—Ä–∏–º–µ—Ä–Ω—ã–π –æ–±—ä–µ–º —Å–ø–∏—Ä—Ç–∞
            total_volume = spirit_volume + 100  # –ü—Ä–∏–º–µ—Ä–Ω—ã–π –æ–±—â–∏–π –æ–±—ä–µ–º
            alcohol_percentage = (spirit_volume / total_volume) * 100
            
            if alcohol_percentage < 15:
                strength = '—Å–ª–∞–±–æ–∞–ª–∫–æ–≥–æ–ª—å–Ω—ã–π'
            elif alcohol_percentage < 25:
                strength = '—Å—Ä–µ–¥–Ω–µ–π –∫—Ä–µ–ø–æ—Å—Ç–∏'
            else:
                strength = '–∫—Ä–µ–ø–∫–∏–π'
        
        # –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –æ–±—ä–µ–º–∞
        if '–ª–æ–Ω–≥–¥—Ä–∏–Ω–∫' in ingredients_lower or '—Ç–æ–Ω–∏–∫' in ingredients_lower or '—Å–æ–¥–æ–≤–∞—è' in ingredients_lower:
            volume = '–ª–æ–Ω–≥–¥—Ä–∏–Ω–∫'
        elif '—à–æ—Ç' in ingredients_lower or spirit_volume <= 60:
            volume = '—à–æ—Ç'
        else:
            volume = '—Å—Ä–µ–¥–Ω–µ–≥–æ –æ–±—ä–µ–º–∞'
        
        # –ê–Ω–∞–ª–∏–∑ –∞—Ä–æ–º–∞—Ç–∞
        aromas = []
        for aroma, aroma_ingredients in TASTE_PROFILES['aroma_profiles'].items():
            for ingredient in aroma_ingredients:
                if ingredient in ingredients_lower:
                    aromas.append(aroma)
                    break
        
        # –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –≥—Ä—É–ø–ø—ã –∫–æ–∫—Ç–µ–π–ª—è
        cocktail_group = '—Ö–∞–π–±–æ–ª—ã'  # –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
        if '—Å–∞—É—ç—Ä' in ingredients_lower or '–ª–∏–º–æ–Ω' in ingredients_lower:
            cocktail_group = '–∫–∏—Å–ª—ã–µ'
        elif '–∫–∞–º–ø–∞—Ä–∏' in ingredients_lower or '–∞–ø–µ—Ä–æ–ª—å' in ingredients_lower:
            cocktail_group = '–∞–ø–µ—Ä–∏—Ç–∏–≤—ã'
        elif '–≤–µ—Ä–º—É—Ç' in ingredients_lower:
            cocktail_group = '–¥–∏–∂–µ—Å—Ç–∏–≤—ã'
        elif '—Ç—Ä–æ–ø–∏—á–µ—Å–∫–∏–π' in ingredients_lower or '—Ä–æ–º' in ingredients_lower:
            cocktail_group = '—Ç—Ä–æ–ø–∏—á–µ—Å–∫–∏–µ'
        
        # –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Ç–µ–∫—Å—Ç—É—Ä—ã
        texture = '—Å—Ä–µ–¥–Ω–µ–µ'
        if '—Å–ª–∏–≤–∫–∏' in ingredients_lower or '–º–æ–ª–æ–∫–æ' in ingredients_lower:
            texture = '—Å–ª–∏–≤–æ—á–Ω–æ–µ'
        elif '—Å–æ–¥–æ–≤–∞—è' in ingredients_lower or '—Ç–æ–Ω–∏–∫' in ingredients_lower:
            texture = '–∏–≥—Ä–∏—Å—Ç–æ–µ'
        elif '—è–π—Ü–æ' in ingredients_lower:
            texture = '–±–∞—Ä—Ö–∞—Ç–∏—Å—Ç–æ–µ'
        
        # –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –±–∞–ª–∞–Ω—Å–∞
        balance = '—Å–±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–π'
        if len(basic_tastes) == 1:
            balance = f'—Å –¥–æ–º–∏–Ω–∏—Ä—É—é—â–µ–π {basic_tastes[0]}'
        elif len(basic_tastes) >= 3:
            balance = '—Å–ª–æ–∂–Ω—ã–π'
        
        return {
            'basic_tastes': basic_tastes,
            'taste_combination': taste_combination,
            'strength': strength,
            'volume': volume,
            'aromas': aromas,
            'cocktail_group': cocktail_group,
            'texture': texture,
            'balance': balance
        }
    
    def get_food_pairing(self, dish):
        """–ü–æ–ª—É—á–∏—Ç—å —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—é –ø–æ —Ñ—É–¥–ø–µ–π—Ä–∏–Ω–≥—É"""
        dish_lower = dish.lower()
        
        for food_type, cocktails in self.food_pairings.items():
            if food_type in dish_lower:
                return {
                    'food_type': food_type,
                    'recommended_cocktails': cocktails,
                    'explanation': f"–î–ª—è {food_type} –∏–¥–µ–∞–ª—å–Ω–æ –ø–æ–¥—Ö–æ–¥—è—Ç {', '.join(cocktails[:3])}"
                }
        
        return {
            'food_type': '—É–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω–æ–µ',
            'recommended_cocktails': ['Martini', 'Gin Tonic', 'Whiskey Sour'],
            'explanation': '–î–ª—è —É–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω–æ–≥–æ —Å–æ—á–µ—Ç–∞–Ω–∏—è –ø–æ–¥—Ö–æ–¥—è—Ç –∫–ª–∞—Å—Å–∏—á–µ—Å–∫–∏–µ –∫–æ–∫—Ç–µ–π–ª–∏'
        }

# –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –≥–µ–Ω–µ—Ä–∞—Ç–æ—Ä–∞ —Ä–µ—Ü–µ–ø—Ç–æ–≤
try:
    recipe_generator = KnowledgeBasedRecipeGenerator()
    print("‚úì –ì–µ–Ω–µ—Ä–∞—Ç–æ—Ä —Ä–µ—Ü–µ–ø—Ç–æ–≤ –Ω–∞ –æ—Å–Ω–æ–≤–µ –±–∞–∑—ã –∑–Ω–∞–Ω–∏–π –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω")
except Exception as e:
    print(f"‚ùå –û—à–∏–±–∫–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ –≥–µ–Ω–µ—Ä–∞—Ç–æ—Ä–∞ —Ä–µ—Ü–µ–ø—Ç–æ–≤: {e}")
    sys.exit(1)

# Yandex Cloud AI –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
YANDEX_API_KEY = os.getenv('YANDEX_API_KEY')
YANDEX_FOLDER_ID = os.getenv('FOLDER_ID')
YANDEX_API_URL = "https://llm.api.cloud.yandex.net/foundationModels/v1/completion"

async def call_yandex_api(prompt: str) -> str:
    """–í—ã–∑–æ–≤ Yandex Cloud AI API –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ —Ä–µ—Ü–µ–ø—Ç–æ–≤"""
    headers = {
        "Authorization": f"Api-Key {YANDEX_API_KEY}",
        "Content-Type": "application/json"
    }
    
    data = {
        "modelUri": f"gpt://{YANDEX_FOLDER_ID}/yandexgpt",
        "completionOptions": {
            "stream": False,
            "temperature": 0.7,
            "maxTokens": 1000
        },
        "messages": [
            {
                "role": "system",
                "text": "–¢—ã - –∫—É–ª–∏–Ω–∞—Ä–Ω—ã–π —ç–∫—Å–ø–µ—Ä—Ç –∏ –±–∞—Ä–º–µ–Ω. –ü–æ–º–æ–≥–∞–µ—à—å —Å–æ–∑–¥–∞–≤–∞—Ç—å —Ä–µ—Ü–µ–ø—Ç—ã –Ω–∞–ø–∏—Ç–∫–æ–≤, —Å–æ—á–µ—Ç–∞–Ω–∏—è –≤–∫—É—Å–æ–≤ –∏ –∫—É–ª–∏–Ω–∞—Ä–Ω—ã–µ —Å–æ–≤–µ—Ç—ã. –û—Ç–≤–µ—á–∞–π —Ç–æ–ª—å–∫–æ –Ω–∞ –∫—É–ª–∏–Ω–∞—Ä–Ω—ã–µ —Ç–µ–º—ã."
            },
            {
                "role": "user",
                "text": prompt
            }
        ]
    }
    
    try:
        response = requests.post(YANDEX_API_URL, headers=headers, json=data, timeout=30)
        response.raise_for_status()
        result = response.json()
        
        # –ò–∑–≤–ª–µ–∫–∞–µ–º —Ç–µ–∫—Å—Ç –æ—Ç–≤–µ—Ç–∞ –∏–∑ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã Yandex API
        if 'result' in result and 'alternatives' in result['result']:
            return result['result']['alternatives'][0]['message']['text']
        else:
            return "–û—à–∏–±–∫–∞: –Ω–µ–æ–∂–∏–¥–∞–Ω–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç –æ—Ç–≤–µ—Ç–∞ –æ—Ç Yandex API"
            
    except requests.exceptions.Timeout:
        return "–û—à–∏–±–∫–∞: –ø—Ä–µ–≤—ã—à–µ–Ω–æ –≤—Ä–µ–º—è –æ–∂–∏–¥–∞–Ω–∏—è –æ—Ç–≤–µ—Ç–∞ –æ—Ç Yandex API"
    except requests.exceptions.ConnectionError:
        return "–û—à–∏–±–∫–∞: –Ω–µ—Ç –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ Yandex API"
    except requests.exceptions.HTTPError as e:
        return f"–û—à–∏–±–∫–∞ HTTP: {e.response.status_code}"
    except Exception as e:
        return f"–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ–±—Ä–∞—â–µ–Ω–∏–∏ –∫ Yandex AI: {str(e)}"

# –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –∫–æ–º–∞–Ω–¥
@dp.message(Command('start'))
async def start_command(message: types.Message):
    """–û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–æ–º–∞–Ω–¥—ã /start"""
    keyboard = InlineKeyboardMarkup(inline_keyboard=[
        [
            InlineKeyboardButton(text="üç∏ –°–æ–∑–¥–∞—Ç—å —Ä–µ—Ü–µ–ø—Ç", callback_data="recipe"),
            InlineKeyboardButton(text="üîç –ü–æ–∏—Å–∫", callback_data="search")
        ],
        [
            InlineKeyboardButton(text="üé≤ –°–ª—É—á–∞–π–Ω—ã–π", callback_data="random"),
            InlineKeyboardButton(text="üìã –ú–µ–Ω—é", callback_data="menu")
        ],
        [
            InlineKeyboardButton(text="üçÇ –°–µ–∑–æ–Ω–Ω—ã–µ", callback_data="seasonal"),
            InlineKeyboardButton(text="üçΩÔ∏è –§—É–¥–ø–µ–π—Ä–∏–Ω–≥", callback_data="pairing")
        ],
        [
            InlineKeyboardButton(text="üìà –¢—Ä–µ–Ω–¥—ã", callback_data="trends"),
            InlineKeyboardButton(text="üì∞ –ù–æ–≤–æ—Å—Ç–∏", callback_data="news")
        ],
        [
            InlineKeyboardButton(text="‚ûï –°–æ–∑–¥–∞—Ç—å —Ä–µ—Ü–µ–ø—Ç", callback_data="create_recipe"),
            InlineKeyboardButton(text="‚ÑπÔ∏è –ü–æ–º–æ—â—å", callback_data="help")
        ]
    ])
    
    welcome_text = """
üçπ MixMatrixBot - –í–∞—à –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã–π –±–∞—Ä–º–µ–Ω!

–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ –º–∏—Ä –∫–æ–∫—Ç–µ–π–ª–µ–π! –Ø –ø–æ–º–æ–≥—É –≤–∞–º:
‚Ä¢ –°–æ–∑–¥–∞—Ç—å –∏–¥–µ–∞–ª—å–Ω—ã–π —Ä–µ—Ü–µ–ø—Ç –Ω–∞ –æ—Å–Ω–æ–≤–µ 300 –≤–∫—É—Å–æ–≤—ã—Ö –∫–æ–º–±–∏–Ω–∞—Ü–∏–π
‚Ä¢ –ù–∞–π—Ç–∏ –∫–æ–∫—Ç–µ–π–ª–∏ –ø–æ –∏–Ω–≥—Ä–µ–¥–∏–µ–Ω—Ç–∞–º –∏ —Å–µ–∑–æ–Ω—É
‚Ä¢ –ü–æ–¥–æ–±—Ä–∞—Ç—å –∫–æ–∫—Ç–µ–π–ª—å –ø–æ–¥ –≤–∞—à–µ –±–ª—é–¥–æ
‚Ä¢ –£–∑–Ω–∞—Ç—å –æ —Ç—Ä–µ–Ω–¥–∞—Ö –∏ –Ω–æ–≤–æ—Å—Ç—è—Ö –∏–Ω–¥—É—Å—Ç—Ä–∏–∏

–ë–∞–∑–∞ –∑–Ω–∞–Ω–∏–π:
‚Ä¢ 300 –≤—ã–≥–æ–¥–Ω—ã—Ö –≤–∫—É—Å–æ–≤—ã—Ö –∫–æ–º–±–∏–Ω–∞—Ü–∏–π –∏–∑ Flavor Bible
‚Ä¢ 600+ –∫–ª–∞—Å—Å–∏—á–µ—Å–∫–∏—Ö —Ä–µ—Ü–µ–ø—Ç–æ–≤ –∏–∑ –∫–Ω–∏–≥
‚Ä¢ –°–µ–∑–æ–Ω–Ω—ã–µ –∏–Ω–≥—Ä–µ–¥–∏–µ–Ω—Ç—ã –¥–ª—è –†–æ—Å—Å–∏–∏
‚Ä¢ –¢–∞–±–ª–∏—Ü–∞ —Å–µ–∑–æ–Ω–Ω–æ—Å—Ç–∏ —Ñ—Ä—É–∫—Ç–æ–≤ –∏ —è–≥–æ–¥
‚Ä¢ –ü—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ –æ–ø–∏—Å–∞–Ω–∏—è –≤–∫—É—Å–æ–≤
‚Ä¢ –§—É–¥–ø–µ–π—Ä–∏–Ω–≥ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏

–û—Å–Ω–æ–≤–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã:
/recipe - —Å–æ–∑–¥–∞—Ç—å —Ä–µ—Ü–µ–ø—Ç
/search - –ø–æ–∏—Å–∫ –∫–æ–∫—Ç–µ–π–ª–µ–π
/random - —Å–ª—É—á–∞–π–Ω—ã–π –∫–æ–∫—Ç–µ–π–ª—å
/seasonal - —Å–µ–∑–æ–Ω–Ω—ã–µ –∫–æ–∫—Ç–µ–π–ª–∏
/seasonality - —Å–µ–∑–æ–Ω–Ω–æ—Å—Ç—å —Ñ—Ä—É–∫—Ç–æ–≤
/pairing - –ø–æ–¥–±–æ—Ä –ø–æ–¥ –±–ª—é–¥–æ
/create_recipe - —Å–æ–∑–¥–∞—Ç—å –Ω–æ–≤—ã–π —Ä–µ—Ü–µ–ø—Ç
/menu - –≥–µ–Ω–µ—Ä–∞—Ü–∏—è –º–µ–Ω—é
/trends - —Ç—Ä–µ–Ω–¥—ã –∫–æ–∫—Ç–µ–π–ª–µ–π
/news - –Ω–æ–≤–æ—Å—Ç–∏ –∏–Ω–¥—É—Å—Ç—Ä–∏–∏
/history - –∏—Å—Ç–æ—Ä–∏—è –∫–æ–∫—Ç–µ–π–ª—è

–í—ã–±–µ—Ä–∏—Ç–µ –¥–µ–π—Å—Ç–≤–∏–µ –∫–Ω–æ–ø–∫–æ–π –∏–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∫–æ–º–∞–Ω–¥—ã!
    """
    
    await message.reply(welcome_text, reply_markup=keyboard)

@dp.message(Command('help'))
async def help_command(message: types.Message):
    """–û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–æ–º–∞–Ω–¥—ã /help"""
    help_text = """
üçπ MixMatrixBot - –°–ø—Ä–∞–≤–∫–∞

–û—Å–Ω–æ–≤–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã:
/start - –Ω–∞—á–∞—Ç—å —Ä–∞–±–æ—Ç—É —Å –±–æ—Ç–æ–º
/help - –ø–æ–∫–∞–∑–∞—Ç—å —ç—Ç—É —Å–ø—Ä–∞–≤–∫—É

–°–æ–∑–¥–∞–Ω–∏–µ –∏ –ø–æ–∏—Å–∫:
/recipe [—Å–ø–∏—Ä—Ç] [mocktail=yes/no] - —Å–æ–∑–¥–∞—Ç—å —Ä–µ—Ü–µ–ø—Ç
/search [–∑–∞–ø—Ä–æ—Å] - –ø–æ–∏—Å–∫ –∫–æ–∫—Ç–µ–π–ª–µ–π
/random - —Å–ª—É—á–∞–π–Ω—ã–π –∫–æ–∫—Ç–µ–π–ª—å
/create_recipe - —Å–æ–∑–¥–∞—Ç—å –Ω–æ–≤—ã–π —Ä–µ—Ü–µ–ø—Ç —Å AI

–°–µ–∑–æ–Ω–Ω—ã–µ –∏ —Å–ø–µ—Ü–∏–∞–ª—å–Ω—ã–µ:
/seasonal - —Å–µ–∑–æ–Ω–Ω—ã–µ –∫–æ–∫—Ç–µ–π–ª–∏ –¥–ª—è –†–æ—Å—Å–∏–∏
/seasonality - –ø–æ–∫–∞–∑–∞—Ç—å —Å–µ–∑–æ–Ω–Ω–æ—Å—Ç—å —Ñ—Ä—É–∫—Ç–æ–≤ –∏ —è–≥–æ–¥
/pairing [–±–ª—é–¥–æ] - –ø–æ–¥–±–æ—Ä –∫–æ–∫—Ç–µ–π–ª—è –ø–æ–¥ –±–ª—é–¥–æ
/menu [—Ç–∏–ø] [–∫–æ–ª–∏—á–µ—Å—Ç–≤–æ] - –≥–µ–Ω–µ—Ä–∞—Ü–∏—è –º–µ–Ω—é

–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è:
/trends - —Ç—Ä–µ–Ω–¥—ã –∫–æ–∫—Ç–µ–π–ª–µ–π 2025
/news - –Ω–æ–≤–æ—Å—Ç–∏ –∏–∑ –º–∏—Ä–∞ HoReCa
/history [–∫–æ–∫—Ç–µ–π–ª—å] - –∏—Å—Ç–æ—Ä–∏—è –∫–æ–∫—Ç–µ–π–ª—è
/taste_profile - —Å–∏—Å—Ç–µ–º–∞ –æ–ø–∏—Å–∞–Ω–∏—è –≤–∫—É—Å–æ–≤

–ë–∞–∑–∞ –∑–Ω–∞–Ω–∏–π:
‚Ä¢ 300 –≤–∫—É—Å–æ–≤—ã—Ö –∫–æ–º–±–∏–Ω–∞—Ü–∏–π –∏–∑ Flavor Bible
‚Ä¢ 600+ –∫–ª–∞—Å—Å–∏—á–µ—Å–∫–∏—Ö —Ä–µ—Ü–µ–ø—Ç–æ–≤ –∏–∑ –∫–Ω–∏–≥
‚Ä¢ –°–µ–∑–æ–Ω–Ω—ã–µ –∏–Ω–≥—Ä–µ–¥–∏–µ–Ω—Ç—ã –¥–ª—è –†–æ—Å—Å–∏–∏
‚Ä¢ –§—É–¥–ø–µ–π—Ä–∏–Ω–≥ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏

–î–æ—Å—Ç—É–ø–Ω—ã–µ —Å–ø–∏—Ä—Ç—ã:
–¥–∂–∏–Ω, –≤–æ–¥–∫–∞, —Ä–æ–º, –≤–∏—Å–∫–∏, —Ç–µ–∫–∏–ª–∞, –∫–æ–Ω—å—è–∫, –±—Ä–µ–Ω–¥–∏

–°–µ–∑–æ–Ω–Ω–æ—Å—Ç—å (–†–æ—Å—Å–∏—è):
‚Ä¢ –ó–∏–º–∞: –∫–ª—é–∫–≤–∞, –±—Ä—É—Å–Ω–∏–∫–∞, —Ü–∏—Ç—Ä—É—Å—ã, –∫–æ—Ä–∏—Ü–∞
‚Ä¢ –í–µ—Å–Ω–∞: —Ä–µ–≤–µ–Ω—å, —â–∞–≤–µ–ª—å, –º–æ–ª–æ–¥—ã–µ —Ç—Ä–∞–≤—ã
‚Ä¢ –õ–µ—Ç–æ: —è–≥–æ–¥—ã, –±–∞–∑–∏–ª–∏–∫, —É–∫—Ä–æ–ø
‚Ä¢ –û—Å–µ–Ω—å: —è–±–ª–æ–∫–∏, –≥—Ä—É—à–∏, —Ç—ã–∫–≤–∞, –º–µ–¥

–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏:
‚Ä¢ –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –Ω–∞ –æ—Å–Ω–æ–≤–µ –±–∞–∑—ã –∑–Ω–∞–Ω–∏–π
‚Ä¢ –°–µ–∑–æ–Ω–Ω—ã–µ –∏–Ω–≥—Ä–µ–¥–∏–µ–Ω—Ç—ã –¥–ª—è –†–æ—Å—Å–∏–∏
‚Ä¢ AI-–≥–µ–Ω–µ—Ä–∞—Ü–∏—è —Ä–µ—Ü–µ–ø—Ç–æ–≤
‚Ä¢ –ö–æ–Ω—Ü–µ–ø—Ç—É–∞–ª—å–Ω—ã–µ –º–µ–Ω—é —Å –º–∞—Ç—Ä–∏—Ü–µ–π –≤–¥–æ—Ö–Ω–æ–≤–µ–Ω–∏—è
    """
    await message.reply(help_text)

@dp.message(Command('recipe'))
async def recipe_command(message: types.Message):
    """–û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–æ–º–∞–Ω–¥—ã /recipe"""
    args = message.text.split()[1:] if len(message.text.split()) > 1 else []
    
    base_spirit = '–¥–∂–∏–Ω'  # –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
    mocktail = False
    
    # –ü–∞—Ä—Å–∏–Ω–≥ –∞—Ä–≥—É–º–µ–Ω—Ç–æ–≤
    for arg in args:
        if arg.lower() in BASE_SPIRITS:
            base_spirit = arg.lower()
        elif 'mocktail=yes' in arg.lower() or 'mocktail=–¥–∞' in arg.lower():
            mocktail = True
    
    await message.reply("üçπ –°–æ–∑–¥–∞—é –∏–¥–µ–∞–ª—å–Ω—ã–π —Ä–µ—Ü–µ–ø—Ç –Ω–∞ –æ—Å–Ω–æ–≤–µ –±–∞–∑—ã –∑–Ω–∞–Ω–∏–π...")
    
    try:
        # –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º —Ä–µ—Ü–µ–ø—Ç –Ω–∞ –æ—Å–Ω–æ–≤–µ –±–∞–∑—ã –∑–Ω–∞–Ω–∏–π
        recipe = recipe_generator.generate_recipe_from_knowledge(base_spirit, mocktail)
        
        # –§–æ—Ä–º–∞—Ç–∏—Ä—É–µ–º —Ä–µ—Ü–µ–ø—Ç
        recipe_text = f"""
üçπ {recipe['name']}

üìã –ò–Ω–≥—Ä–µ–¥–∏–µ–Ω—Ç—ã:
{recipe['ingredients']}

üîß –ú–µ—Ç–æ–¥ –ø—Ä–∏–≥–æ—Ç–æ–≤–ª–µ–Ω–∏—è:
{recipe['method']}

üé® –£–∫—Ä–∞—à–µ–Ω–∏–µ:
{recipe['garnish']}

üìö –ò—Å—Ç–æ—Ä–∏—è:
{recipe['history']}

üí° –í–∫—É—Å–æ–≤–∞—è –∫–æ–º–±–∏–Ω–∞—Ü–∏—è:
{recipe['combination']}

üçÇ –°–µ–∑–æ–Ω–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è:
{recipe['seasonal_info']}

{'‚úÖ –ò–¥–µ–∞–ª—å–Ω–æ–µ —Å–æ—á–µ—Ç–∞–Ω–∏–µ –∞–ª–∫–æ–≥–æ–ª—è –∏ —Ñ—Ä—É–∫—Ç–∞!' if recipe.get('fruit_match', False) else 'üåü –ò–Ω–Ω–æ–≤–∞—Ü–∏–æ–Ω–Ω–∞—è –∫–æ–º–±–∏–Ω–∞—Ü–∏—è!'}

üéØ –í–ö–£–°–û–í–û–ô –ü–†–û–§–ò–õ–¨:

1Ô∏è‚É£ –û—Å–Ω–æ–≤–Ω—ã–µ –≤–∫—É—Å—ã: {', '.join(recipe['taste_profile']['basic_tastes']) if recipe['taste_profile']['basic_tastes'] else '–°–±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–π'}

2Ô∏è‚É£ –ö–æ–º–±–∏–Ω–∞—Ü–∏—è –≤–∫—É—Å–∞: {recipe['taste_profile']['taste_combination']}

3Ô∏è‚É£ –ö—Ä–µ–ø–æ—Å—Ç—å: {recipe['taste_profile']['strength']}

4Ô∏è‚É£ –û–±—ä–µ–º: {recipe['taste_profile']['volume']}

5Ô∏è‚É£ –ê—Ä–æ–º–∞—Ç: {', '.join(recipe['taste_profile']['aromas']) if recipe['taste_profile']['aromas'] else '–ù–µ–π—Ç—Ä–∞–ª—å–Ω—ã–π'}

6Ô∏è‚É£ –ì—Ä—É–ø–ø–∞: {recipe['taste_profile']['cocktail_group']}

7Ô∏è‚É£ –¢–µ–∫—Å—Ç—É—Ä–∞: {recipe['taste_profile']['texture']}

8Ô∏è‚É£ –ë–∞–ª–∞–Ω—Å: {recipe['taste_profile']['balance']}

üåü –°–æ–≤–µ—Ç—ã:
‚Ä¢ –ü–æ–¥–∞–≤–∞–π—Ç–µ –æ—Ö–ª–∞–∂–¥–µ–Ω–Ω—ã–º
‚Ä¢ –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Å–≤–µ–∂–∏–µ –∏–Ω–≥—Ä–µ–¥–∏–µ–Ω—Ç—ã
‚Ä¢ –≠–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç–∏—Ä—É–π—Ç–µ —Å –ø—Ä–æ–ø–æ—Ä—Ü–∏—è–º–∏
        """
        
        await message.reply(recipe_text)
        
    except Exception as e:
        await message.reply(f"–ò–∑–≤–∏–Ω–∏—Ç–µ, –ø—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞: {str(e)}")

@dp.message(Command('random'))
async def random_command(message: types.Message):
    """–û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–æ–º–∞–Ω–¥—ã /random"""
    # –ü–æ–ª—É—á–∞–µ–º —Å–ª—É—á–∞–π–Ω—ã–π —Å–ø–∏—Ä—Ç
    random_spirit = random.choice(BASE_SPIRITS)
    
    # –°–ª—É—á–∞–π–Ω–æ –≤—ã–±–∏—Ä–∞–µ–º mocktail –∏–ª–∏ –Ω–µ—Ç
    mocktail = random.choice([True, False])
    
    await message.reply("üé≤ –°–æ–∑–¥–∞—é –¥–ª—è –≤–∞—Å —Å—é—Ä–ø—Ä–∏–∑-—Ä–µ—Ü–µ–ø—Ç –Ω–∞ –æ—Å–Ω–æ–≤–µ –±–∞–∑—ã –∑–Ω–∞–Ω–∏–π...")
    
    try:
        # –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º —Å–ª—É—á–∞–π–Ω—ã–π —Ä–µ—Ü–µ–ø—Ç
        recipe = recipe_generator.generate_recipe_from_knowledge(random_spirit, mocktail)
        
        # –§–æ—Ä–º–∞—Ç–∏—Ä—É–µ–º —Ä–µ—Ü–µ–ø—Ç
        recipe_text = f"""
üé≤ –°—é—Ä–ø—Ä–∏–∑-—Ä–µ—Ü–µ–ø—Ç: {recipe['name']}

üìã –ò–Ω–≥—Ä–µ–¥–∏–µ–Ω—Ç—ã:
{recipe['ingredients']}

üîß –ú–µ—Ç–æ–¥ –ø—Ä–∏–≥–æ—Ç–æ–≤–ª–µ–Ω–∏—è:
{recipe['method']}

üé® –£–∫—Ä–∞—à–µ–Ω–∏–µ:
{recipe['garnish']}

üìö –ò—Å—Ç–æ—Ä–∏—è:
{recipe['history']}

üí° –í–∫—É—Å–æ–≤–∞—è –∫–æ–º–±–∏–Ω–∞—Ü–∏—è:
{recipe['combination']}

üåü –û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏:
‚Ä¢ –°–ª—É—á–∞–π–Ω–∞—è –∫–æ–º–±–∏–Ω–∞—Ü–∏—è –≤–∫—É—Å–æ–≤
‚Ä¢ –°–µ–∑–æ–Ω–Ω—ã–µ –∏–Ω–≥—Ä–µ–¥–∏–µ–Ω—Ç—ã
‚Ä¢ –ò–Ω–Ω–æ–≤–∞—Ü–∏–æ–Ω–Ω—ã–π –ø–æ–¥—Ö–æ–¥
        """
        
        await message.reply(recipe_text)
        
    except Exception as e:
        await message.reply(f"–ò–∑–≤–∏–Ω–∏—Ç–µ, –ø—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞: {str(e)}")

@dp.message(Command('seasonality'))
async def seasonality_command(message: types.Message):
    """–û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–æ–º–∞–Ω–¥—ã /seasonality - –ø–æ–∫–∞–∑–∞—Ç—å —Å–µ–∑–æ–Ω–Ω–æ—Å—Ç—å —Ñ—Ä—É–∫—Ç–æ–≤"""
    current_month = '–æ–∫—Ç—è–±—Ä—å'
    
    # –ù–∞—Ö–æ–¥–∏–º —Ñ—Ä—É–∫—Ç—ã –≤ —Å–µ–∑–æ–Ω–µ
    seasonal_fruits = []
    for fruit, data in FRUIT_SEASONALITY_TABLE.items():
        if current_month in data['season']:
            alcohol_names = [ALCOHOL_CODES[code] for code in data['alcohol']]
            seasonal_fruits.append({
                'fruit': fruit.replace('_', ' ').title(),
                'alcohol': ', '.join(alcohol_names),
                'description': data['description']
            })
    
    seasonality_text = f"""
üçÇ –°–µ–∑–æ–Ω–Ω–æ—Å—Ç—å —Ñ—Ä—É–∫—Ç–æ–≤ –∏ —è–≥–æ–¥ (–æ–∫—Ç—è–±—Ä—å 2025)

–°–µ–π—á–∞—Å –≤ —Å–µ–∑–æ–Ω–µ:
"""
    
    for fruit_data in seasonal_fruits:
        seasonality_text += f"""
üçá {fruit_data['fruit']}
   üç∏ –°–æ—á–µ—Ç–∞–µ—Ç—Å—è —Å: {fruit_data['alcohol']}
   üí° –í–∫—É—Å: {fruit_data['description']}

"""
    
    seasonality_text += """
üìä –ö–æ–¥—ã –∞–ª–∫–æ–≥–æ–ª—è:
G - –î–∂–∏–Ω, V - –í–æ–¥–∫–∞, R - –†–æ–º
W - –í–∏—Å–∫–∏, T - –¢–µ–∫–∏–ª–∞, B - –ë—Ä–µ–Ω–¥–∏

üí° –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ /recipe –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è —Ä–µ—Ü–µ–ø—Ç–æ–≤ —Å —Å–µ–∑–æ–Ω–Ω—ã–º–∏ –∏–Ω–≥—Ä–µ–¥–∏–µ–Ω—Ç–∞–º–∏!
    """
    
@dp.message(Command('taste_profile'))
async def taste_profile_command(message: types.Message):
    """–û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–æ–º–∞–Ω–¥—ã /taste_profile - –ø–æ–∫–∞–∑–∞—Ç—å —Å–∏—Å—Ç–µ–º—É –æ–ø–∏—Å–∞–Ω–∏—è –≤–∫—É—Å–æ–≤"""
    taste_text = """
üéØ –°–ò–°–¢–ï–ú–ê –û–ü–ò–°–ê–ù–ò–Ø –í–ö–£–°–û–í MIXTRIX

üìä –ü–∞—Ä–∞–º–µ—Ç—Ä—ã –∞–Ω–∞–ª–∏–∑–∞ –Ω–∞–ø–∏—Ç–∫–æ–≤:

1Ô∏è‚É£ –í–ö–£–° (–û—Å–Ω–æ–≤–Ω—ã–µ –Ω–æ—Ç—ã):
‚Ä¢ –ö–∏—Å–ª—ã–π - –ª–∏–º–æ–Ω, –ª–∞–π–º, –≥—Ä–µ–π–ø—Ñ—Ä—É—Ç, –∫–ª—é–∫–≤–∞
‚Ä¢ –°–ª–∞–¥–∫–∏–π - —Å–∞—Ö–∞—Ä, –º–µ–¥, —Å–∏—Ä–æ–ø, —Ñ—Ä—É–∫—Ç—ã
‚Ä¢ –ì–æ—Ä—å–∫–∏–π - –∫–∞–º–ø–∞—Ä–∏, –∞–ø–µ—Ä–æ–ª—å, –±–∏—Ç—Ç–µ—Ä—Å
‚Ä¢ –ü—Ä—è–Ω—ã–π - –∏–º–±–∏—Ä—å, –∫–æ—Ä–∏—Ü–∞, –∫–∞—Ä–¥–∞–º–æ–Ω
‚Ä¢ –¢–µ—Ä–ø–∫–∏–π - –≥—Ä–∞–Ω–∞—Ç, –∞–π–≤–∞, —Ä—è–±–∏–Ω–∞
‚Ä¢ –û—Å—Ç—Ä—ã–π - –ø–µ—Ä–µ—Ü —á–∏–ª–∏, —Ç–∞–±–∞—Å–∫–æ
‚Ä¢ –°–æ–ª–µ–Ω—ã–π - —Å–æ–ª—å, –æ–ª–∏–≤–∫–∏
‚Ä¢ –£–º–∞–º–∏ - —Ç–æ–º–∞—Ç, –≥—Ä–∏–±—ã, —Å–æ–µ–≤—ã–π —Å–æ—É—Å

2Ô∏è‚É£ –ö–û–ú–ë–ò–ù–ê–¶–ò–Ø –í–ö–£–°–ê:
‚Ä¢ –ö–∏—Å–ª–æ-—Å–ª–∞–¥–∫–∏–π - –∫–ª–∞—Å—Å–∏—á–µ—Å–∫–∏–π –±–∞–ª–∞–Ω—Å
‚Ä¢ –ì–æ—Ä—å–∫–æ-—Å–ª–∞–¥–∫–∏–π - —Å–ª–æ–∂–Ω–∞—è –≥–∞—Ä–º–æ–Ω–∏—è
‚Ä¢ –ü—Ä—è–Ω–æ-—Å–ª–∞–¥–∫–∏–π - —Å–æ–≥—Ä–µ–≤–∞—é—â–∏–µ –Ω–æ—Ç—ã
‚Ä¢ –û—Å—Ç—Ä–æ-–∫–∏—Å–ª—ã–π - –∫–æ–Ω—Ç—Ä–∞—Å—Ç–Ω—ã–µ –≤–∫—É—Å—ã
‚Ä¢ –°–±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–π - —Ä–∞–≤–Ω–æ–≤–µ—Å–∏–µ
‚Ä¢ –ö–æ–Ω—Ç—Ä–∞—Å—Ç–Ω—ã–π - —Ä–µ–∑–∫–∏–µ –ø–µ—Ä–µ—Ö–æ–¥—ã
‚Ä¢ –°–ª–æ–∂–Ω—ã–π - –º–Ω–æ–≥–æ—Å–ª–æ–π–Ω—ã–π –ø—Ä–æ—Ñ–∏–ª—å
‚Ä¢ –ù–∞—Å–ª–∞–∏–≤–∞—é—â–∏–π—Å—è - –ø–æ—Å—Ç–µ–ø–µ–Ω–Ω–æ–µ —Ä–∞—Å–∫—Ä—ã—Ç–∏–µ

3Ô∏è‚É£ –ö–†–ï–ü–û–°–¢–¨:
‚Ä¢ –ë–µ–∑–∞–ª–∫–æ–≥–æ–ª—å–Ω—ã–π - 0% –∞–ª–∫–æ–≥–æ–ª—è
‚Ä¢ –°–ª–∞–±–æ–∞–ª–∫–æ–≥–æ–ª—å–Ω—ã–π - 5-15%
‚Ä¢ –°—Ä–µ–¥–Ω–µ–π –∫—Ä–µ–ø–æ—Å—Ç–∏ - 15-25%
‚Ä¢ –ö—Ä–µ–ø–∫–∏–π - 25%+

4Ô∏è‚É£ –û–ë–™–ï–ú:
‚Ä¢ –®–æ—Ç - 30-60–º–ª
‚Ä¢ –°—Ä–µ–¥–Ω–µ–≥–æ –æ–±—ä–µ–º–∞ - 60-120–º–ª
‚Ä¢ –õ–æ–Ω–≥–¥—Ä–∏–Ω–∫ - 120-300–º–ª

5Ô∏è‚É£ –ê–†–û–ú–ê–¢:
‚Ä¢ –¶–∏—Ç—Ä—É—Å–æ–≤—ã–π, –¢—Ä–∞–≤—è–Ω–æ–π, –¶–≤–µ—Ç–æ—á–Ω—ã–π
‚Ä¢ –§—Ä—É–∫—Ç–æ–≤—ã–π, –ü—Ä—è–Ω—ã–π, –î—Ä–µ–≤–µ—Å–Ω—ã–π
‚Ä¢ –°–≤–µ–∂–∏–π, –°–ª–∞–¥–∫–∏–π

6Ô∏è‚É£ –ì–†–£–ü–ü–ê:
‚Ä¢ –ö–∏—Å–ª—ã–µ (Sours), –ê–ø–µ—Ä–∏—Ç–∏–≤—ã, –î–∏–∂–µ—Å—Ç–∏–≤—ã
‚Ä¢ –¢—Ä–æ–ø–∏—á–µ—Å–∫–∏–µ, –°—Ç–∏—Ä-–¥—Ä–∏–Ω–∫–∏, –•–∞–π–±–æ–ª—ã
‚Ä¢ –®–æ—Ç—ã, –°–±–∏—Ç—ã–µ (—Å —è–∏—á–Ω—ã–º –±–µ–ª–∫–æ–º)

7Ô∏è‚É£ –¢–ï–ö–°–¢–£–†–ê/–¢–ï–õ–û:
‚Ä¢ –õ–µ–≥–∫–æ–µ, –°—Ä–µ–¥–Ω–µ–µ, –ü–ª–æ—Ç–Ω–æ–µ
‚Ä¢ –®–µ–ª–∫–æ–≤–∏—Å—Ç–æ–µ, –ë–∞—Ä—Ö–∞—Ç–∏—Å—Ç–æ–µ
‚Ä¢ –í—è–∂—É—â–µ–µ, –ò–≥—Ä–∏—Å—Ç–æ–µ, –°–ª–∏–≤–æ—á–Ω–æ–µ

8Ô∏è‚É£ –ë–ê–õ–ê–ù–°:
‚Ä¢ –ì–∞—Ä–º–æ–Ω–∏—á–Ω—ã–π - –≤—Å–µ –≤ —Ä–∞–≤–Ω–æ–≤–µ—Å–∏–∏
‚Ä¢ –°–±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–π - —Ö–æ—Ä–æ—à–∏–π –±–∞–ª–∞–Ω—Å
‚Ä¢ –° –¥–æ–º–∏–Ω–∏—Ä—É—é—â–µ–π [–≤–∫—É—Å] - –æ–¥–∏–Ω –ø—Ä–µ–æ–±–ª–∞–¥–∞–µ—Ç
‚Ä¢ –û—Ç–∫—Ä—ã–≤–∞—é—â–∏–π—Å—è –ø–æ—Å—Ç–µ–ø–µ–Ω–Ω–æ - —Å–ª–æ—è–º–∏

üí° –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ /recipe –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è —Ä–µ—Ü–µ–ø—Ç–æ–≤ —Å –ø–æ–ª–Ω—ã–º –∞–Ω–∞–ª–∏–∑–æ–º –≤–∫—É—Å–æ–≤–æ–≥–æ –ø—Ä–æ—Ñ–∏–ª—è!
    """
    await message.reply(taste_text)

@dp.message(Command('seasonal'))
async def seasonal_command(message: types.Message):
    """–û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–æ–º–∞–Ω–¥—ã /seasonal"""
    seasonal_ingredients = SEASONAL_INGREDIENTS[CURRENT_SEASON]
    season_names = {
        'winter': '–∑–∏–º–∞',
        'spring': '–≤–µ—Å–Ω–∞', 
        'summer': '–ª–µ—Ç–æ',
        'autumn': '–æ—Å–µ–Ω—å'
    }
    
    current_season_name = season_names[CURRENT_SEASON]
    
    await message.reply(f"üçÇ –°–æ–∑–¥–∞—é —Å–µ–∑–æ–Ω–Ω—ã–µ —Ä–µ—Ü–µ–ø—Ç—ã –¥–ª—è {current_season_name} –Ω–∞ –æ—Å–Ω–æ–≤–µ –±–∞–∑—ã –∑–Ω–∞–Ω–∏–π...")
    
    try:
        recipes_text = f"üçÇ –°–µ–∑–æ–Ω–Ω—ã–µ —Ä–µ—Ü–µ–ø—Ç—ã –¥–ª—è {current_season_name}:\n\n"
        
        # –°–æ–∑–¥–∞–µ–º 3 —Å–µ–∑–æ–Ω–Ω—ã—Ö —Ä–µ—Ü–µ–ø—Ç–∞
        for i in range(3):
            spirit = BASE_SPIRITS[i]
            recipe = recipe_generator.generate_recipe_from_knowledge(spirit, False)
            
            recipes_text += f"""
{i+1}. üçπ {recipe['name']}

üìã –ò–Ω–≥—Ä–µ–¥–∏–µ–Ω—Ç—ã:
{recipe['ingredients']}

üîß –ú–µ—Ç–æ–¥ –ø—Ä–∏–≥–æ—Ç–æ–≤–ª–µ–Ω–∏—è:
{recipe['method']}

üé® –£–∫—Ä–∞—à–µ–Ω–∏–µ:
{recipe['garnish']}

üí° –°–µ–∑–æ–Ω–Ω–∞—è –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç—å:
{recipe['combination']}

---
"""
        
        await message.reply(recipes_text)
        
    except Exception as e:
        await message.reply(f"–û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ —Å–µ–∑–æ–Ω–Ω—ã—Ö —Ä–µ—Ü–µ–ø—Ç–æ–≤: {str(e)}")

@dp.message(Command('pairing'))
async def pairing_command(message: types.Message):
    """–û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–æ–º–∞–Ω–¥—ã /pairing"""
    args = message.text.split()[1:] if len(message.text.split()) > 1 else []
    
    if not args:
        await message.reply("–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ: /pairing [–Ω–∞–∑–≤–∞–Ω–∏–µ –±–ª—é–¥–∞]\n–ü—Ä–∏–º–µ—Ä: /pairing —Å—Ç–µ–π–∫")
        return
    
    dish = " ".join(args)
    
    await message.reply(f"üçΩÔ∏è –ü–æ–¥–±–∏—Ä–∞—é –∫–æ–∫—Ç–µ–π–ª—å –¥–ª—è {dish} –Ω–∞ –æ—Å–Ω–æ–≤–µ —Ñ—É–¥–ø–µ–π—Ä–∏–Ω–≥–∞...")
    
    try:
        # –ü–æ–ª—É—á–∞–µ–º —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—é –ø–æ —Ñ—É–¥–ø–µ–π—Ä–∏–Ω–≥—É
        pairing = recipe_generator.get_food_pairing(dish)
        
        # –°–æ–∑–¥–∞–µ–º —Ä–µ—Ü–µ–ø—Ç –Ω–∞ –æ—Å–Ω–æ–≤–µ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏
        recommended_cocktail = pairing['recommended_cocktails'][0]
        
        # –û–ø—Ä–µ–¥–µ–ª—è–µ–º –±–∞–∑–æ–≤—ã–π —Å–ø–∏—Ä—Ç –ø–æ –Ω–∞–∑–≤–∞–Ω–∏—é –∫–æ–∫—Ç–µ–π–ª—è
        base_spirit = '–¥–∂–∏–Ω'  # –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
        for spirit in BASE_SPIRITS:
            if spirit in recommended_cocktail.lower():
                base_spirit = spirit
                break
        
        # –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º —Ä–µ—Ü–µ–ø—Ç
        recipe = recipe_generator.generate_recipe_from_knowledge(base_spirit, False)
        
        pairing_text = f"""
üçΩÔ∏è –ò–¥–µ–∞–ª—å–Ω—ã–π –Ω–∞–ø–∏—Ç–æ–∫ –¥–ª—è {dish}:

üçπ {recipe['name']}

üìã –ò–Ω–≥—Ä–µ–¥–∏–µ–Ω—Ç—ã:
{recipe['ingredients']}

üîß –ú–µ—Ç–æ–¥ –ø—Ä–∏–≥–æ—Ç–æ–≤–ª–µ–Ω–∏—è:
{recipe['method']}

üé® –£–∫—Ä–∞—à–µ–Ω–∏–µ:
{recipe['garnish']}

üí° –ü–æ—á–µ–º—É –∏–º–µ–Ω–Ω–æ —ç—Ç–æ—Ç –Ω–∞–ø–∏—Ç–æ–∫:
{pairing['explanation']}

üåü –í–∫—É—Å–æ–≤–∞—è –∫–æ–º–±–∏–Ω–∞—Ü–∏—è:
{recipe['combination']}

üìö –ò—Å—Ç–æ—Ä–∏—è:
{recipe['history']}
        """
        
        await message.reply(pairing_text)
        
    except Exception as e:
        await message.reply(f"–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–¥–±–æ—Ä–µ –Ω–∞–ø–∏—Ç–∫–∞: {str(e)}")

# –û—Å—Ç–∞–ª—å–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã –æ—Å—Ç–∞—é—Ç—Å—è —Ç–∞–∫–∏–º–∏ –∂–µ...
@dp.message(Command('menu'))
async def menu_command(message: types.Message):
    """–û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–æ–º–∞–Ω–¥—ã /menu"""
    await message.reply("üìã –°–æ–∑–¥–∞—é –º–µ–Ω—é –Ω–∞ –æ—Å–Ω–æ–≤–µ –±–∞–∑—ã –∑–Ω–∞–Ω–∏–π...")
    
    try:
        menu_text = "üìã –°–µ–∑–æ–Ω–Ω–æ–µ –º–µ–Ω—é –Ω–∞ –æ—Å–Ω–æ–≤–µ –±–∞–∑—ã –∑–Ω–∞–Ω–∏–π:\n\n"
        
        # –°–æ–∑–¥–∞–µ–º –º–µ–Ω—é –∏–∑ 5 —Ä–µ—Ü–µ–ø—Ç–æ–≤
        for i in range(5):
            spirit = BASE_SPIRITS[i % len(BASE_SPIRITS)]
            recipe = recipe_generator.generate_recipe_from_knowledge(spirit, False)
            
            menu_text += f"""
{i+1}. üçπ {recipe['name']}
   üìã {recipe['ingredients'].split(',')[0]} + —Å–µ–∑–æ–Ω–Ω—ã–µ –∏–Ω–≥—Ä–µ–¥–∏–µ–Ω—Ç—ã
   üí° {recipe['combination']}

"""
        
        await message.reply(menu_text)
        
    except Exception as e:
        await message.reply(f"–û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –º–µ–Ω—é: {str(e)}")

@dp.message(Command('trends'))
async def trends_command(message: types.Message):
    """–û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–æ–º–∞–Ω–¥—ã /trends"""
    trends_text = """
üìà –¢—Ä–µ–Ω–¥—ã –∫–æ–∫—Ç–µ–π–ª–µ–π 2025

Zero-Proof Revolution:
‚Ä¢ –°–ª–æ–∂–Ω—ã–µ –±–µ–∑–∞–ª–∫–æ–≥–æ–ª—å–Ω—ã–µ –∫–æ–∫—Ç–µ–π–ª–∏
‚Ä¢ –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —Ñ–µ—Ä–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –∏–Ω–≥—Ä–µ–¥–∏–µ–Ω—Ç–æ–≤
‚Ä¢ –ö–≤–∞—Å, –∫–æ–º–±—É—á–∞, –∫–µ—Ñ–∏—Ä –≤ –∫–∞—á–µ—Å—Ç–≤–µ –±–∞–∑—ã

Flavor Bible Integration:
‚Ä¢ 300 –≤—ã–≥–æ–¥–Ω—ã—Ö –≤–∫—É—Å–æ–≤—ã—Ö –∫–æ–º–±–∏–Ω–∞—Ü–∏–π
‚Ä¢ –ù–µ–æ–∂–∏–¥–∞–Ω–Ω—ã–µ —Å–æ—á–µ—Ç–∞–Ω–∏—è –∏–Ω–≥—Ä–µ–¥–∏–µ–Ω—Ç–æ–≤
‚Ä¢ –ù–∞—É—á–Ω—ã–π –ø–æ–¥—Ö–æ–¥ –∫ –≤–∫—É—Å—É

–°–µ–∑–æ–Ω–Ω—ã–µ –∏–Ω–≥—Ä–µ–¥–∏–µ–Ω—Ç—ã:
‚Ä¢ –õ–æ–∫–∞–ª—å–Ω—ã–µ –∏ —Å–µ–∑–æ–Ω–Ω—ã–µ –ø—Ä–æ–¥—É–∫—Ç—ã
‚Ä¢ –§–µ—Ä–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –æ–≤–æ—â–∏ –∏ —Ñ—Ä—É–∫—Ç—ã
‚Ä¢ –î–∏–∫–∏–µ —Ç—Ä–∞–≤—ã –∏ —Ü–≤–µ—Ç—ã

–¢–µ—Ö–Ω–∏–∫–∏ –ø—Ä–∏–≥–æ—Ç–æ–≤–ª–µ–Ω–∏—è:
‚Ä¢ Sous-vide –¥–ª—è –Ω–∞—Å—Ç–æ–µ–≤
‚Ä¢ –ö—Ä–∏–æ–≥–µ–Ω–Ω—ã–µ –º–µ—Ç–æ–¥—ã
‚Ä¢ –ú–æ–ª–µ–∫—É–ª—è—Ä–Ω–∞—è –≥–∞—Å—Ç—Ä–æ–Ω–æ–º–∏—è

–ü–æ–¥–∞—á–∞:
‚Ä¢ –ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—ã–µ —ç–ª–µ–º–µ–Ω—Ç—ã
‚Ä¢ –î—ã–º, –ø–∞—Ä, —Å–≤–µ—Ç–æ–≤—ã–µ —ç—Ñ—Ñ–µ–∫—Ç—ã
‚Ä¢ –ù–µ–æ–±—ã—á–Ω–∞—è –ø–æ—Å—É–¥–∞ –∏ —Å–µ—Ä–≤–∏—Ä–æ–≤–∫–∞

–ü–æ–ø—É–ª—è—Ä–Ω—ã–µ –≤–∫—É—Å—ã:
‚Ä¢ –£–º–∞–º–∏ (–≥—Ä–∏–±—ã, —Å–æ–µ–≤—ã–π —Å–æ—É—Å)
‚Ä¢ –ö–∏—Å–ª—ã–µ –∏ —Ñ–µ—Ä–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ
‚Ä¢ –¶–≤–µ—Ç–æ—á–Ω—ã–µ –∏ —Ç—Ä–∞–≤—è–Ω—ã–µ
‚Ä¢ –ü—Ä—è–Ω—ã–µ –∏ –æ—Å—Ç—Ä—ã–µ
    """
    await message.reply(trends_text)

@dp.message(Command('news'))
async def news_command(message: types.Message):
    """–û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–æ–º–∞–Ω–¥—ã /news"""
    news_text = """
üì∞ –ù–æ–≤–æ—Å—Ç–∏ –∏–∑ –º–∏—Ä–∞ HoReCa

–ü–æ—Å–ª–µ–¥–Ω–∏–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è:
‚Ä¢ –ù–æ–≤—ã–µ —Ä–µ—Ü–µ–ø—Ç—ã –≤ IBA Official Cocktails 2025
‚Ä¢ –¢—Ä–µ–Ω–¥—ã –≤ –º–∏–∫—Å–æ–ª–æ–≥–∏–∏ –æ—Ç –≤–µ–¥—É—â–∏—Ö –±–∞—Ä–º–µ–Ω–æ–≤
‚Ä¢ –°–µ–∑–æ–Ω–Ω—ã–µ –∏–Ω–≥—Ä–µ–¥–∏–µ–Ω—Ç—ã –∏ –∏—Ö –ø—Ä–∏–º–µ–Ω–µ–Ω–∏–µ

–ë–∞–∑–∞ –∑–Ω–∞–Ω–∏–π MixMatrix:
‚Ä¢ 300 –≤–∫—É—Å–æ–≤—ã—Ö –∫–æ–º–±–∏–Ω–∞—Ü–∏–π –∏–∑ Flavor Bible
‚Ä¢ 600+ –∫–ª–∞—Å—Å–∏—á–µ—Å–∫–∏—Ö —Ä–µ—Ü–µ–ø—Ç–æ–≤ –∏–∑ –∫–Ω–∏–≥
‚Ä¢ –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å Yandex GPT –¥–ª—è –∏–Ω–Ω–æ–≤–∞—Ü–∏–π

–†–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–µ –∏—Å—Ç–æ—á–Ω–∏–∫–∏:
‚Ä¢ Difford's Guide - –µ–∂–µ–¥–Ω–µ–≤–Ω—ã–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è
‚Ä¢ Imbibe Magazine - —Ç—Ä–µ–Ω–¥—ã –∏ –∏–Ω–Ω–æ–≤–∞—Ü–∏–∏
‚Ä¢ Punch - –∏—Å—Ç–æ—Ä–∏—è –∏ –∫—É–ª—å—Ç—É—Ä–∞ –∫–æ–∫—Ç–µ–π–ª–µ–π

–°–ª–µ–¥–∏—Ç–µ –∑–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è–º–∏:
‚Ä¢ –ù–æ–≤—ã–µ —Ç–µ—Ö–Ω–∏–∫–∏ –ø—Ä–∏–≥–æ—Ç–æ–≤–ª–µ–Ω–∏—è
‚Ä¢ –°–µ–∑–æ–Ω–Ω—ã–µ –º–µ–Ω—é –≤–µ–¥—É—â–∏—Ö –±–∞—Ä–æ–≤
‚Ä¢ –ò–Ω–Ω–æ–≤–∞—Ü–∏–∏ –≤ –ø–æ–¥–∞—á–µ –∫–æ–∫—Ç–µ–π–ª–µ–π
    """
    await message.reply(news_text)

@dp.message(Command('create_recipe'))
async def create_recipe_command(message: types.Message):
    """–û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–æ–º–∞–Ω–¥—ã /create_recipe"""
    await message.reply("""
‚ûï –°–æ–∑–¥–∞–Ω–∏–µ –Ω–æ–≤–æ–≥–æ —Ä–µ—Ü–µ–ø—Ç–∞

–î–ª—è —Å–æ–∑–¥–∞–Ω–∏—è —Ä–µ—Ü–µ–ø—Ç–∞ –Ω–∞ –æ—Å–Ω–æ–≤–µ –±–∞–∑—ã –∑–Ω–∞–Ω–∏–π, –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∫–æ–º–∞–Ω–¥—É:
/recipe [—Å–ø–∏—Ä—Ç] [mocktail=yes/no]

–ò–ª–∏ –æ–ø–∏—à–∏—Ç–µ –≤–∞—à —Ä–µ—Ü–µ–ø—Ç –≤ —Å–≤–æ–±–æ–¥–Ω–æ–π —Ñ–æ—Ä–º–µ, –∏ —è –ø–æ–º–æ–≥—É –µ–≥–æ –¥–æ—Ä–∞–±–æ—Ç–∞—Ç—å!

–ü—Ä–∏–º–µ—Ä—ã:
- "–•–æ—á—É –∫–æ–∫—Ç–µ–π–ª—å —Å –¥–∂–∏–Ω–æ–º –∏ –º—è—Ç–æ–π"
- "–°–æ–∑–¥–∞–π —á—Ç–æ-—Ç–æ —Å —Ç–µ–∫–∏–ª–æ–π –∏ –ª–∞–π–º–æ–º"
- "–ù—É–∂–µ–Ω –±–µ–∑–∞–ª–∫–æ–≥–æ–ª—å–Ω—ã–π –∫–æ–∫—Ç–µ–π–ª—å —Å —è–≥–æ–¥–∞–º–∏"

–ë–∞–∑–∞ –∑–Ω–∞–Ω–∏–π –≤–∫–ª—é—á–∞–µ—Ç:
‚Ä¢ 300 –≤–∫—É—Å–æ–≤—ã—Ö –∫–æ–º–±–∏–Ω–∞—Ü–∏–π –∏–∑ Flavor Bible
‚Ä¢ 600+ –∫–ª–∞—Å—Å–∏—á–µ—Å–∫–∏—Ö —Ä–µ—Ü–µ–ø—Ç–æ–≤ –∏–∑ –∫–Ω–∏–≥
‚Ä¢ –°–µ–∑–æ–Ω–Ω—ã–µ –∏–Ω–≥—Ä–µ–¥–∏–µ–Ω—Ç—ã –¥–ª—è –†–æ—Å—Å–∏–∏

–ü—Ä–æ—Å—Ç–æ –Ω–∞–ø–∏—à–∏—Ç–µ –≤–∞—à–∏ –ø–æ–∂–µ–ª–∞–Ω–∏—è, –∏ —è —Å–æ–∑–¥–∞–º —Ä–µ—Ü–µ–ø—Ç!
    """)

@dp.message(Command('search'))
async def search_command(message: types.Message):
    """–û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–æ–º–∞–Ω–¥—ã /search"""
    args = message.text.split()[1:] if len(message.text.split()) > 1 else []
    
    if not args:
        await message.reply("–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ: /search [–Ω–∞–∑–≤–∞–Ω–∏–µ –∫–æ–∫—Ç–µ–π–ª—è –∏–ª–∏ –∏–Ω–≥—Ä–µ–¥–∏–µ–Ω—Ç]")
        return
    
    query = " ".join(args)
    await message.reply(f"üîç –ò—â—É —Ä–µ—Ü–µ–ø—Ç—ã –ø–æ –∑–∞–ø—Ä–æ—Å—É: {query}")
    
    try:
        # –ü—Ä–æ—Å—Ç–æ–π –ø–æ–∏—Å–∫ –ø–æ –±–∞–∑–µ –∑–Ω–∞–Ω–∏–π
        found_recipes = []
        
        # –ò—â–µ–º –≤ –∫–ª–∞—Å—Å–∏—á–µ—Å–∫–∏—Ö —Ä–µ—Ü–µ–ø—Ç–∞—Ö
        for spirit, recipes in recipe_generator.classic_recipes.items():
            for recipe in recipes:
                if query.lower() in recipe['name'].lower() or query.lower() in recipe['ingredients'].lower():
                    found_recipes.append({
                        'name': recipe['name'],
                        'base_spirit': spirit,
                        'description': recipe['history'][:100] + "..."
                    })
        
        if not found_recipes:
            await message.reply("–†–µ—Ü–µ–ø—Ç—ã –Ω–µ –Ω–∞–π–¥–µ–Ω—ã. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –¥—Ä—É–≥–æ–π –∑–∞–ø—Ä–æ—Å –∏–ª–∏ —Å–æ–∑–¥–∞–π—Ç–µ –Ω–æ–≤—ã–π —Ä–µ—Ü–µ–ø—Ç —Å –ø–æ–º–æ—â—å—é /recipe")
            return
        
        response = f"–ù–∞–π–¥–µ–Ω–æ —Ä–µ—Ü–µ–ø—Ç–æ–≤: {len(found_recipes)}\n\n"
        
        for i, recipe in enumerate(found_recipes[:5], 1):
            response += f"{i}. {recipe['name']}\n"
            response += f"–ë–∞–∑–æ–≤—ã–π —Å–ø–∏—Ä—Ç: {recipe['base_spirit']}\n"
            response += f"–û–ø–∏—Å–∞–Ω–∏–µ: {recipe['description']}\n\n"
        
        if len(found_recipes) > 5:
            response += f"... –∏ –µ—â–µ {len(found_recipes) - 5} —Ä–µ—Ü–µ–ø—Ç–æ–≤"
        
        await message.reply(response)
        
    except Exception as e:
        await message.reply(f"–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–∏—Å–∫–µ: {str(e)}")

@dp.message(Command('history'))
async def history_command(message: types.Message):
    """–û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–æ–º–∞–Ω–¥—ã /history"""
    args = message.text.split()[1:] if len(message.text.split()) > 1 else []
    
    if not args:
        await message.reply("–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ: /history [–Ω–∞–∑–≤–∞–Ω–∏–µ –∫–æ–∫—Ç–µ–π–ª—è]")
        return
    
    cocktail_name = " ".join(args)
    
    # –ò—â–µ–º –≤ –∫–ª–∞—Å—Å–∏—á–µ—Å–∫–∏—Ö —Ä–µ—Ü–µ–ø—Ç–∞—Ö
    found_history = None
    for spirit, recipes in recipe_generator.classic_recipes.items():
        for recipe in recipes:
            if cocktail_name.lower() in recipe['name'].lower():
                found_history = recipe['history']
                break
        if found_history:
            break
    
    if found_history:
        await message.reply(f"–ò—Å—Ç–æ—Ä–∏—è –∫–æ–∫—Ç–µ–π–ª—è {cocktail_name}:\n\n{found_history}")
        return
    
    # –ï—Å–ª–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ, –∏—Å–ø–æ–ª—å–∑—É–µ–º AI
    await message.reply(f"üìö –ò—â—É –∏—Å—Ç–æ—Ä–∏—é –∫–æ–∫—Ç–µ–π–ª—è {cocktail_name}...")
    
    prompt = f"""
    –†–∞—Å—Å–∫–∞–∂–∏ –ø–æ–¥—Ä–æ–±–Ω—É—é –∏—Å—Ç–æ—Ä–∏—é –Ω–∞–ø–∏—Ç–∫–∞ "{cocktail_name}".
    –í–∫–ª—é—á–∏:
    1. –ü—Ä–æ–∏—Å—Ö–æ–∂–¥–µ–Ω–∏–µ –∏ —Å–æ–∑–¥–∞—Ç–µ–ª—è
    2. –ò—Å—Ç–æ—Ä–∏—á–µ—Å–∫–∏–π –∫–æ–Ω—Ç–µ–∫—Å—Ç
    3. –≠–≤–æ–ª—é—Ü–∏—é —Ä–µ—Ü–µ–ø—Ç–∞
    4. –ò–Ω—Ç–µ—Ä–µ—Å–Ω—ã–µ —Ñ–∞–∫—Ç—ã
    5. –í–ª–∏—è–Ω–∏–µ –Ω–∞ –∫—É–ª–∏–Ω–∞—Ä–Ω—É—é –∫—É–ª—å—Ç—É—Ä—É

    –ï—Å–ª–∏ —ç—Ç–æ –∏–∑–≤–µ—Å—Ç–Ω—ã–π –Ω–∞–ø–∏—Ç–æ–∫, –∏—Å–ø–æ–ª—å–∑—É–π –¥–æ—Å—Ç–æ–≤–µ—Ä–Ω—ã–µ –∏—Å—Ç–æ—Ä–∏—á–µ—Å–∫–∏–µ –¥–∞–Ω–Ω—ã–µ.
    """
    
    try:
        history = await call_yandex_api(prompt)
        await message.reply(f"–ò—Å—Ç–æ—Ä–∏—è –∫–æ–∫—Ç–µ–π–ª—è {cocktail_name}:\n\n{history}")
    except Exception as e:
        await message.reply(f"–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ –∏—Å—Ç–æ—Ä–∏–∏: {str(e)}")

# –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –∫–Ω–æ–ø–æ–∫ (—É–ø—Ä–æ—â–µ–Ω–Ω—ã–µ)
@dp.callback_query(lambda c: c.data == 'recipe')
async def process_callback_recipe(callback_query: types.CallbackQuery):
    """–û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–Ω–æ–ø–∫–∏ '–†–µ—Ü–µ–ø—Ç'"""
    try:
        await callback_query.answer()
        await recipe_command(callback_query.message)
    except Exception as e:
        print(f"–û—à–∏–±–∫–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∫–Ω–æ–ø–∫–∏ recipe: {e}")

@dp.callback_query(lambda c: c.data == 'search')
async def process_callback_search(callback_query: types.CallbackQuery):
    """–û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–Ω–æ–ø–∫–∏ '–ü–æ–∏—Å–∫'"""
    try:
        await callback_query.answer()
        await callback_query.message.reply(
            "üîç –ü–æ–∏—Å–∫ –∫–æ–∫—Ç–µ–π–ª–µ–π\n\n"
            "–ù–∞–ø–∏—à–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –∫–æ–∫—Ç–µ–π–ª—è –∏–ª–∏ –∏–Ω–≥—Ä–µ–¥–∏–µ–Ω—Ç –¥–ª—è –ø–æ–∏—Å–∫–∞!\n\n"
            "–ü—Ä–∏–º–µ—Ä—ã:\n"
            "‚Ä¢ –º–∞—Ä—Ç–∏–Ω–∏\n"
            "‚Ä¢ –¥–∂–∏–Ω\n"
            "‚Ä¢ –º–æ—Ö–∏—Ç–æ\n"
            "‚Ä¢ —Ä–æ–º\n\n"
            "–ò–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∫–æ–º–∞–Ω–¥—É: /search [–∑–∞–ø—Ä–æ—Å]"
        )
    except Exception as e:
        print(f"–û—à–∏–±–∫–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∫–Ω–æ–ø–∫–∏ search: {e}")

@dp.callback_query(lambda c: c.data == 'random')
async def process_callback_random(callback_query: types.CallbackQuery):
    """–û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–Ω–æ–ø–∫–∏ '–°–ª—É—á–∞–π–Ω—ã–π'"""
    try:
        await callback_query.answer()
        await random_command(callback_query.message)
    except Exception as e:
        print(f"–û—à–∏–±–∫–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∫–Ω–æ–ø–∫–∏ random: {e}")

@dp.callback_query(lambda c: c.data == 'menu')
async def process_callback_menu(callback_query: types.CallbackQuery):
    """–û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–Ω–æ–ø–∫–∏ '–ú–µ–Ω—é'"""
    try:
        await callback_query.answer()
        await menu_command(callback_query.message)
    except Exception as e:
        print(f"–û—à–∏–±–∫–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∫–Ω–æ–ø–∫–∏ menu: {e}")

@dp.callback_query(lambda c: c.data == 'trends')
async def process_callback_trends(callback_query: types.CallbackQuery):
    """–û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–Ω–æ–ø–∫–∏ '–¢—Ä–µ–Ω–¥—ã'"""
    try:
        await callback_query.answer()
        await trends_command(callback_query.message)
    except Exception as e:
        print(f"–û—à–∏–±–∫–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∫–Ω–æ–ø–∫–∏ trends: {e}")

@dp.callback_query(lambda c: c.data == 'news')
async def process_callback_news(callback_query: types.CallbackQuery):
    """–û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–Ω–æ–ø–∫–∏ '–ù–æ–≤–æ—Å—Ç–∏'"""
    try:
        await callback_query.answer()
        await news_command(callback_query.message)
    except Exception as e:
        print(f"–û—à–∏–±–∫–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∫–Ω–æ–ø–∫–∏ news: {e}")

@dp.callback_query(lambda c: c.data == 'help')
async def process_callback_help(callback_query: types.CallbackQuery):
    """–û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–Ω–æ–ø–∫–∏ '–ü–æ–º–æ—â—å'"""
    try:
        await callback_query.answer()
        await help_command(callback_query.message)
    except Exception as e:
        print(f"–û—à–∏–±–∫–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∫–Ω–æ–ø–∫–∏ help: {e}")

@dp.callback_query(lambda c: c.data == 'seasonal')
async def process_callback_seasonal(callback_query: types.CallbackQuery):
    """–û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–Ω–æ–ø–∫–∏ '–°–µ–∑–æ–Ω–Ω—ã–µ'"""
    try:
        await callback_query.answer()
        await seasonal_command(callback_query.message)
    except Exception as e:
        print(f"–û—à–∏–±–∫–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∫–Ω–æ–ø–∫–∏ seasonal: {e}")

@dp.callback_query(lambda c: c.data == 'pairing')
async def process_callback_pairing(callback_query: types.CallbackQuery):
    """–û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–Ω–æ–ø–∫–∏ '–§—É–¥–ø–µ–π—Ä–∏–Ω–≥'"""
    try:
        await callback_query.answer()
        await callback_query.message.reply(
            "üçΩÔ∏è –§—É–¥–ø–µ–π—Ä–∏–Ω–≥\n\n"
            "–ù–∞–ø–∏—à–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –±–ª—é–¥–∞, –∏ —è –ø–æ–¥–±–µ—Ä—É –∏–¥–µ–∞–ª—å–Ω—ã–π –∫–æ–∫—Ç–µ–π–ª—å!\n\n"
            "–ü—Ä–∏–º–µ—Ä—ã:\n"
            "‚Ä¢ —Å—Ç–µ–π–∫\n"
            "‚Ä¢ –ø–∞—Å—Ç–∞ –∫–∞—Ä–±–æ–Ω–∞—Ä–∞\n"
            "‚Ä¢ —Å—É—à–∏\n"
            "‚Ä¢ —à–æ–∫–æ–ª–∞–¥–Ω—ã–π –¥–µ—Å–µ—Ä—Ç\n"
            "‚Ä¢ —Å—ã—Ä–Ω–∞—è —Ç–∞—Ä–µ–ª–∫–∞\n\n"
            "–ò–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∫–æ–º–∞–Ω–¥—É: /pairing [–±–ª—é–¥–æ]"
        )
    except Exception as e:
        print(f"–û—à–∏–±–∫–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∫–Ω–æ–ø–∫–∏ pairing: {e}")

@dp.callback_query(lambda c: c.data == 'create_recipe')
async def process_callback_create_recipe(callback_query: types.CallbackQuery):
    """–û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–Ω–æ–ø–∫–∏ '–°–æ–∑–¥–∞—Ç—å —Ä–µ—Ü–µ–ø—Ç'"""
    try:
        await callback_query.answer()
        await create_recipe_command(callback_query.message)
    except Exception as e:
        print(f"–û—à–∏–±–∫–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∫–Ω–æ–ø–∫–∏ create_recipe: {e}")

@dp.message()
async def handle_text_message(message: types.Message):
    """–û–±—Ä–∞–±–æ—Ç—á–∏–∫ —Ç–µ–∫—Å—Ç–æ–≤—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π"""
    user_message = message.text
    
    # –ï—Å–ª–∏ —Å–æ–æ–±—â–µ–Ω–∏–µ –Ω–∞—á–∏–Ω–∞–µ—Ç—Å—è —Å /, —ç—Ç–æ –∫–æ–º–∞–Ω–¥–∞
    if user_message.startswith('/'):
        await message.reply("–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –∫–æ–º–∞–Ω–¥–∞. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ /help –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è —Å–ø–∏—Å–∫–∞ –∫–æ–º–∞–Ω–¥.")
        return
    
    # –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º –∫–∞–∫ –ø–æ–∏—Å–∫–æ–≤—ã–π –∑–∞–ø—Ä–æ—Å
    await message.reply(f"üîç –ò—â—É —Ä–µ—Ü–µ–ø—Ç—ã –ø–æ –∑–∞–ø—Ä–æ—Å—É: {user_message}")
    
    try:
        # –ü—Ä–æ—Å—Ç–æ–π –ø–æ–∏—Å–∫ –ø–æ –±–∞–∑–µ –∑–Ω–∞–Ω–∏–π
        found_recipes = []
        
        # –ò—â–µ–º –≤ –∫–ª–∞—Å—Å–∏—á–µ—Å–∫–∏—Ö —Ä–µ—Ü–µ–ø—Ç–∞—Ö
        for spirit, recipes in recipe_generator.classic_recipes.items():
            for recipe in recipes:
                if user_message.lower() in recipe['name'].lower() or user_message.lower() in recipe['ingredients'].lower():
                    found_recipes.append({
                        'name': recipe['name'],
                        'base_spirit': spirit,
                        'description': recipe['history'][:100] + "..."
                    })
        
        if not found_recipes:
            await message.reply("–†–µ—Ü–µ–ø—Ç—ã –Ω–µ –Ω–∞–π–¥–µ–Ω—ã. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –¥—Ä—É–≥–æ–π –∑–∞–ø—Ä–æ—Å –∏–ª–∏ —Å–æ–∑–¥–∞–π—Ç–µ –Ω–æ–≤—ã–π —Ä–µ—Ü–µ–ø—Ç —Å –ø–æ–º–æ—â—å—é /recipe")
            return
        
        response = f"–ù–∞–π–¥–µ–Ω–æ —Ä–µ—Ü–µ–ø—Ç–æ–≤: {len(found_recipes)}\n\n"
        
        for i, recipe in enumerate(found_recipes[:5], 1):
            response += f"{i}. {recipe['name']}\n"
            response += f"–ë–∞–∑–æ–≤—ã–π —Å–ø–∏—Ä—Ç: {recipe['base_spirit']}\n"
            response += f"–û–ø–∏—Å–∞–Ω–∏–µ: {recipe['description']}\n\n"
        
        if len(found_recipes) > 5:
            response += f"... –∏ –µ—â–µ {len(found_recipes) - 5} —Ä–µ—Ü–µ–ø—Ç–æ–≤"
        
        await message.reply(response)
        
    except Exception as e:
        await message.reply(f"–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–∏—Å–∫–µ: {str(e)}")

async def main():
    """–û—Å–Ω–æ–≤–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –∑–∞–ø—É—Å–∫–∞ –±–æ—Ç–∞"""
    print("–ó–∞–ø—É—Å–∫ MIXTRIX Bot (–ë–∞–∑–∞ –∑–Ω–∞–Ω–∏–π + –°–µ–∑–æ–Ω–Ω–æ—Å—Ç—å + –í–∫—É—Å–æ–≤–æ–π –ø—Ä–æ—Ñ–∏–ª—å)...")
    print("‚úì –ë–∞–∑–∞ –∑–Ω–∞–Ω–∏–π: –≥–æ—Ç–æ–≤–∞")
    print("‚úì 300 –≤–∫—É—Å–æ–≤—ã—Ö –∫–æ–º–±–∏–Ω–∞—Ü–∏–π: –∑–∞–≥—Ä—É–∂–µ–Ω—ã")
    print("‚úì 600+ –∫–ª–∞—Å—Å–∏—á–µ—Å–∫–∏—Ö —Ä–µ—Ü–µ–ø—Ç–æ–≤: –∑–∞–≥—Ä—É–∂–µ–Ω—ã")
    print("‚úì –¢–∞–±–ª–∏—Ü–∞ —Å–µ–∑–æ–Ω–Ω–æ—Å—Ç–∏ —Ñ—Ä—É–∫—Ç–æ–≤: –∑–∞–≥—Ä—É–∂–µ–Ω–∞")
    print("‚úì –ê–ª–∫–æ–≥–æ–ª—å–Ω—ã–µ —Å–æ—á–µ—Ç–∞–Ω–∏—è: –∞–∫—Ç–∏–≤–Ω—ã")
    print("‚úì –°–∏—Å—Ç–µ–º–∞ –æ–ø–∏—Å–∞–Ω–∏—è –≤–∫—É—Å–æ–≤: –∞–∫—Ç–∏–≤–Ω–∞")
    print("‚úì 8 –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ –∞–Ω–∞–ª–∏–∑–∞: –≥–æ—Ç–æ–≤—ã")
    print("‚úì Yandex API: –ø–æ–¥–∫–ª—é—á–µ–Ω")
    print("‚úì –°–∏—Å—Ç–µ–º–∞ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏: –∞–∫—Ç–∏–≤–Ω–∞")
    print("‚úì –í—Å–µ —Ñ—É–Ω–∫—Ü–∏–∏ MIXTRIX: –∞–∫—Ç–∏–≤–Ω—ã")
    print("–ë–æ—Ç –≥–æ—Ç–æ–≤ –∫ —Ä–∞–±–æ—Ç–µ!")
    
    try:
        # –ü—Ä–æ–≤–µ—Ä—è–µ–º –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ Telegram API
        bot_info = await bot.get_me()
        print(f"‚úì –ë–æ—Ç –ø–æ–¥–∫–ª—é—á–µ–Ω: @{bot_info.username} ({bot_info.first_name})")
        
        # –ó–∞–ø—É—Å–∫–∞–µ–º polling
        await dp.start_polling(
            bot, 
            skip_updates=True,
            timeout=30,
            request_timeout=30,
            drop_pending_updates=True
        )
        
    except Exception as e:
        print(f"‚ùå –û—à–∏–±–∫–∞ –∑–∞–ø—É—Å–∫–∞ –±–æ—Ç–∞: {e}")
        print("üîÑ –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å –±–æ—Ç–∞ —á–µ—Ä–µ–∑ –Ω–µ—Å–∫–æ–ª—å–∫–æ —Å–µ–∫—É–Ω–¥")
        return

if __name__ == '__main__':
    try:
        asyncio.run(main())
    except KeyboardInterrupt:
        print("\nüõë –ë–æ—Ç –æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º")
    except Exception as e:
        print(f"\n‚ùå –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è –æ—à–∏–±–∫–∞: {e}")
        sys.exit(1)
